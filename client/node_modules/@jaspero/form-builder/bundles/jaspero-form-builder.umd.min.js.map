{"version":3,"sources":["../../../../projects/form-builder/src/lib/enums/segment-type.enum.ts","../../../../projects/form-builder/src/lib/enums/state.enum.ts","../../../../projects/form-builder/src/lib/form-builder.service.ts","../../../../projects/form-builder/src/lib/utils/custom-fields.ts","../../../../node_modules/tslib/tslib.es6.js","../../../../projects/form-builder/src/lib/utils/create-segment-injector.ts","../../../../projects/form-builder/src/lib/segment/segment.component.ts","../../../../projects/form-builder/src/lib/segments/accordion/accordion.component.ts","../../../../projects/form-builder/src/lib/segments/card/card.component.ts","../../../../projects/form-builder/src/lib/segments/empty/empty.component.ts","../../../../projects/form-builder/src/lib/segments/stepper/stepper.component.ts","../../../../projects/form-builder/src/lib/utils/safe-eval.ts","../../../../projects/form-builder/src/lib/segments/tabs/tabs.component.ts","../../../../projects/form-builder/src/lib/consts/segment-type-component-map.const.ts","../../../../projects/form-builder/src/lib/interfaces/condition.interface.ts","../../../../projects/form-builder/src/lib/enums/component-type.enum.ts","../../../../projects/form-builder/src/lib/utils/compile-segment.ts","../../../../projects/form-builder/src/lib/utils/filter-and-compile-segments.ts","../../../../projects/form-builder/src/lib/services/db.service.ts","../../../../projects/form-builder/src/lib/utils/create-component-injector.ts","../../../../projects/form-builder/src/lib/field/field.component.ts","../../../../projects/form-builder/src/lib/utils/get-hsd.ts","../../../../projects/form-builder/src/lib/fields/autocomplete/autocomplete.component.ts","../../../../projects/form-builder/src/lib/fields/checkbox/checkbox.component.ts","../../../../projects/form-builder/src/lib/fields/chips/chips.component.ts","../../../../projects/form-builder/src/lib/utils/clone-abstract-control.ts","../../../../projects/form-builder/src/lib/fields/date-field/date-field.component.ts","../../../../projects/form-builder/src/lib/fields/draggable-list/draggable-list.component.ts","../../../../projects/form-builder/src/lib/services/storage.service.ts","../../../../projects/form-builder/src/lib/utils/format-file-name.ts","../../../../projects/form-builder/src/lib/utils/parse-size.ts","../../../../projects/form-builder/src/lib/fields/file/file.component.ts","../../../../projects/form-builder/src/lib/utils/format-generated-images.ts","../../../../projects/form-builder/src/lib/utils/storage-url.ts","../../../../projects/form-builder/src/lib/utils/switch-item-locations.ts","../../../../projects/form-builder/src/lib/fields/gallery/read-file.ts","../../../../projects/form-builder/src/lib/fields/gallery/gallery.component.ts","../../../../projects/form-builder/src/lib/fields/image/image.component.ts","../../../../projects/form-builder/src/lib/fields/input/input.component.ts","../../../../projects/form-builder/src/lib/fields/radio/radio.component.ts","../../../../projects/form-builder/src/lib/fields/range/range.component.ts","../../../../projects/form-builder/src/lib/utils/additional-context.ts","../../../../projects/form-builder/src/lib/utils/parse-template.ts","../../../../projects/form-builder/src/lib/utils/role.ts","../../../../projects/form-builder/src/lib/fields/select/select.component.ts","../../../../projects/form-builder/src/lib/fields/slider/slider.component.ts","../../../../projects/form-builder/src/lib/fields/textarea/textarea.component.ts","../../../../projects/form-builder/src/lib/fields/toggle/toggle.component.ts","../../../../projects/form-builder/src/lib/fields/wysiwyg/wysiwyg.component.ts","../../../../projects/form-builder/src/lib/consts/component-type-component-map.const.ts","../../../../projects/form-builder/src/lib/enums/schema-type.enum.ts","../../../../projects/form-builder/src/lib/validators/schema-validators.class.ts","../../../../projects/form-builder/src/lib/utils/schema-to-component.ts","../../../../projects/form-builder/src/lib/utils/parser.ts","../../../../projects/form-builder/src/lib/form-builder.component.ts","../../../../projects/form-builder/src/lib/directives/dropzone/dropzone.directive.ts","../../../../projects/form-builder/src/lib/pipes/show-field/show-field.pipe.ts","../../../../projects/form-builder/src/lib/form-builder.module.ts"],"names":["SegmentType","State","FormBuilderService","transloco","snackBar","this","saveComponents","prototype","notify","options","_this","finalOptions","Object","assign","success","error","source$","pipe","tap","open","translate","duration","catchError","err","panelClass","console","throwError","Injectable","TranslocoService","MatSnackBar","CUSTOM_FIELDS","InjectionToken","extendStatics","d","b","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","constructor","create","__assign","t","s","i","n","arguments","length","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__decorate","decorators","target","key","desc","c","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","__param","paramIndex","decorator","__metadata","metadataKey","metadataValue","metadata","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","__createBinding","o","m","k","k2","undefined","enumerable","get","__exportStar","exports","__values","__read","ar","__spread","concat","__spreadArrays","il","a","j","jl","__await","__asyncGenerator","asyncIterator","q","resume","fulfill","settle","shift","__asyncDelegator","__asyncValues","__makeTemplateObject","cooked","raw","__setModuleDefault","__importStar","mod","__esModule","__importDefault","default","__classPrivateFieldGet","receiver","privateMap","has","__classPrivateFieldSet","set","SEGMENT_DATA","createSegmentInjector","injector","dataToPass","injectorTokens","WeakMap","PortalInjector","SegmentComponent","sData","nestedArraySegments","arrayFields","ngOnInit","segment","classes","join","pointers","parser","id","nestedSegments","filterAndCompileSegments","definitions","entryValue","array","values","forEach","addArrayItem","control","patchValue","loadHooks","arrayPointers","loadHook","fields","parent","pointer","index","map","field","unshift","moveArray","up","fromIndex","toIndex","moveItemInArray","moveArrayItem","removeArrayItem","splice","Component","args","selector","template","Inject","Injector","HostBinding","AccordionComponent","_super","accordions","configuration","accord","title","changeDetection","ChangeDetectionStrategy","OnPush","CardComponent","EmptyComponent","StepperComponent","safeEval","method","final","eval","TabsComponent","selectedTabChange","tabs","tab","tabChange","event","SEGMENT_TYPE_COMPONENT_MAP","_a","Empty","Card","Accordion","Tabs","Stepper","ConditionType","ConditionAction","ConditionEvaluate","ComponentType","compileSegment","columnsDesktop","columnsTablet","columnsMobile","fi","reduce","acc","definition","getFromDefinitions","roles","role","includes","compiledSegment","conditions","valToPass","_b","_c","cur","condition","type","Function","action","Show","evaluateOn","OnLoad","evaluateStates","Hide","data","component","ComponentPortal","segments","authorization","compiled","DbService","getDocuments","moduleId","pageSize","sort","cursor","filters","of","getDocumentsSimple","orderBy","filter","getStateChanges","getDocument","documentId","stream","setDocument","removeDocument","createUserAccount","email","password","removeUserAccount","COMPONENT_DATA","createComponentInjector","cData","class","getHsd","item_1","form","valueChanges","getRawValue","AutocompleteComponent","dbService","loading$","BehaviorSubject","dataSet$","prefix$","suffix$","populate","populate_1","collection","docs","doc","valueKey","name","nameKey","dataSet","filteredSet$","switchMap","startWith","toLowerCase","item","FieldComponent","CheckboxComponent","ChipsComponent","removable","add","trim","input","unique","setValue","remove","chip","cloneAbstractControl","newControl","FormGroup","formGroup_1","validator","asyncValidator","controls_1","controls","keys","addControl","FormArray","formArray_1","formControl","FormControl","Error","disabled","disable","emitEvent","DateFieldComponent","cdr","formBuilderService","startDate","startAt","Date","date","entryControl","hoursControl","getHours","Validators","min","max","minutesControl","getMinutes","save","includeTime","setHours","setMinutes","format","getTime","DatePipe","transform","ChangeDetectorRef","DraggableListComponent","optionOne","optionTwo","indexOne","drop","previousIndex","currentIndex","val","StorageService","upload","path","formatFileName","extension","slice","lastIndexOf","match","Math","floor","random","pow","parseSize","size","MB","num","parseFloat","replace","FileComponent","storage","emptyLabel","allowedFileTypes","forbiddenFileTypes","minSizeBytes","minSize","maxSizeBytes","maxSize","errorSnack","message","dismiss","fileChange","ev","el","file","from","files","writable","clear","contentType","customMetadata","res","ref","getDownloadURL","url","formatGeneratedImages","entries","generated","ViewChild","static","STORAGE_URL","switchItemLocations","items","itemOne","itemTwo","readFile","blob","Observable","obs","Blob","reader","FileReader","onerror","onabort","onload","onloadend","complete","readAsDataURL","GalleryComponent","storageUrl","dialog","http","viewportRuler","toRemove","allowedImageTypes","forbiddenImageTypes","ngAfterViewInit","phElement","placeholder","element","nativeElement","parentElement","style","display","removeChild","openUploadDialog","modalTemplate","width","addImage","image","withCredentials","responseType","split","subscribe","urlCreator","window","URL","webkitURL","createObjectURL","live","detectChanges","openFileUpload","fileEl","click","openSortImages","imagesSort","move","filesUploaded","FileList","files_1","files_1_1","forkJoin","pushToLive","fls","removeImage","sortDrop","dragMoved","point","getPointerPositionOnPage","listGroup","_items","dropList","__isInsideDropListClientRect","x","activeContainer","dropListDropped","source","appendChild","insertBefore","children","sourceIndex","targetIndex","__isTouchEvent","touches","changedTouches","scrollPosition","getViewportScrollPosition","pageX","left","pageY","top","find","refFromURL","delete","generatedImages","task","__indexOf","node","startsWith","getBoundingClientRect","bottom","right","Optional","MatDialog","HttpClient","ViewportRuler","CdkDropListGroup","CdkDropList","ImageComponent","domSanitizer","disInput","imageUrl","filesImage","imageSrc","bypassSecurityTrustResourceUrl","DomSanitizer","InputComponent","RadioComponent","RangeComponent","now","start","end","ADDITIONAL_CONTEXT","parseTemplate","obj","lookUp","RegExp","test","ROLE","SelectComponent","additionalContext","mapResults_1","mapResults","documentsMethod_1","query","it","fieldData","dependency","gm_1","dynamicFilter","SliderComponent","starAt","validation","minimum","endAt","maximum","TextareaComponent","ToggleComponent","WysiwygComponent","fb","formBuilderComponent","ytDefault","fullWidth","showPlayerControls","privacyEnhancedMode","align","ytForm","group","required","statusChanges","tinymce","activeEditor","getBody","setAttribute","registerTiny","init","textarea","branding","height","plugins","menubar","image_advtab","default_link_target","readonly","toolbar","images_upload_handler","blobInfo","failure","filename","catch","toString","setup","editor","on","tinyContent","getContent","ui","registry","addButton","icon","tooltip","onAction","reset","youTubeDialogTemplate","afterClosed","take","iframe","insertContent","FormBuilder","FormBuilderComponent","COMPONENT_TYPE_COMPONENT_MAP","_a$1","Input","Toggle","Select","File","Image","Gallery","Checkbox","Autocomplete","Range","Slider","Wysiwyg","Draggable","Radio","Chips","Textarea","SchemaType","SchemaValidators","multipleOf","schemaToComponent","schemaType","String","Number","Integer","Boolean","Parser","schema","state","customFields","standardizeKey","stringControl","controlValidation","maxLength","minLength","pattern","patter","numberControl","exclusiveMinimum","exclusiveMaximum","booleanControl","buildForm","base","addId","properties","buildProperties","parsed","isRequired","objectProperties","added","buildArray","pointerKey","formatOnLoad","formatOnSave","formatOnCreate","formatOnEdit","single","arrayRoot","log","disableOn","isArray","disableForRoles","portal","onlyOn","parentArray","arrayType","cont","removeAt","entry","adjustedValue","preSaveHooks","currentState","statesToProcess","Create","Edit","preSaveData","service","EventEmitter","validityChanges","ngOnChanges","changes","render","currentValue","ngOnDestroy","changeSubscription","unsubscribe","statusSubscription","process","collectionId","toExec","comp","saveAndProcess","emit","markForCheck","providers","Output","DropzoneDirective","renderer","hoverClass","dropped","hovered","onDrop","$event","preventDefault","dataTransfer","removeClass","onDragOver","addClass","onDragLeave","Directive","ElementRef","Renderer2","HostListener","ShowFieldPipe","Pipe","NgModule","declarations","imports","CommonModule","ReactiveFormsModule","MatFormFieldModule","MatInputModule","MatButtonModule","MatAutocompleteModule","MatSelectModule","MatSliderModule","MatSlideToggleModule","MatCheckboxModule","MatChipsModule","MatIconModule","MatDatepickerModule","MatNativeDateModule","DragDropModule","MatDialogModule","MatTooltipModule","MatProgressSpinnerModule","MatExpansionModule","MatDividerModule","PortalModule","MatCardModule","MatTabsModule","MatRadioModule","SanitizeModule","TranslocoModule"],"mappings":"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","sourcesContent":["export enum SegmentType {\n  Empty = 'empty',\n  Card = 'card',\n  Accordion = 'accordion',\n  Tabs = 'tabs',\n  Stepper = 'stepper'\n}\n","export enum State {\n  Create = 'create',\n  Edit = 'edit'\n}\n","import {Injectable} from '@angular/core';\nimport {MatSnackBar} from '@angular/material/snack-bar';\nimport {TranslocoService} from '@ngneat/transloco';\nimport {Observable, throwError} from 'rxjs';\nimport {catchError, tap} from 'rxjs/operators';\n\n@Injectable()\nexport class FormBuilderService {\n  constructor(\n    private transloco: TranslocoService,\n    private snackBar: MatSnackBar\n  ) {\n  }\n\n  /**\n   * Array of components that need to\n   * run save() methods on single instance\n   */\n  saveComponents: any[] = [];\n\n  notify(\n    options: {\n      success?: string | null;\n      error?: string;\n    } = {}\n  ): <T>(source$: Observable<T>) => Observable<T> {\n    const finalOptions = {\n      success: 'GENERAL.OPERATION_COMPLETED',\n      error: 'GENERAL.OPERATION_FAILED',\n      ...options\n    };\n\n    return <T>(source$: Observable<T>) => {\n      return source$.pipe(\n        tap(() => {\n          if (finalOptions.success) {\n            this.snackBar.open(\n              this.transloco.translate(finalOptions.success),\n              this.transloco.translate('GENERAL.DISMISS'),\n              {\n                duration: 5000\n              }\n            );\n          }\n        }),\n        catchError(err => {\n          if (finalOptions.error) {\n            this.snackBar.open(\n              this.transloco.translate(finalOptions.error),\n              this.transloco.translate('GENERAL.DISMISS'),\n              {\n                panelClass: 'snack-bar-error',\n                duration: 5000\n              }\n            );\n          }\n\n          console.error(err);\n          return throwError(err);\n        })\n      );\n    };\n  }\n}\n","import {Component, InjectionToken} from '@angular/core';\n\nexport interface CustomFields {\n  [key: string]: Component;\n}\n\nexport const CUSTOM_FIELDS = new InjectionToken<{}>('CUSTOM_FIELDS');\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) __createBinding(exports, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import {PortalInjector} from '@angular/cdk/portal';\nimport {InjectionToken} from '@angular/core';\n\nexport const SEGMENT_DATA = new InjectionToken<{}>('SEGMENT_DATA');\n\nexport function createSegmentInjector(injector, dataToPass): PortalInjector {\n  const injectorTokens = new WeakMap();\n  injectorTokens.set(SEGMENT_DATA, dataToPass);\n  return new PortalInjector(injector, injectorTokens);\n}\n","import {moveItemInArray} from '@angular/cdk/drag-drop';\nimport {Component, HostBinding, Inject, Injector, OnInit} from '@angular/core';\nimport {FormControl} from '@angular/forms';\nimport {get} from 'json-pointer';\nimport {CompiledField} from '../interfaces/compiled-field.interface';\nimport {CompiledSegment} from '../interfaces/compiled-segment.interface';\nimport {Definitions} from '../interfaces/definitions.interface';\nimport {SEGMENT_DATA} from '../utils/create-segment-injector';\nimport {filterAndCompileSegments} from '../utils/filter-and-compile-segments';\nimport {Parser, Pointers} from '../utils/parser';\n\nexport interface SegmentData {\n  segment: CompiledSegment;\n  parser: Parser;\n  definitions: Definitions;\n  parent?: string;\n}\n\n@Component({\n  selector: 'fb-segment',\n  template: ''\n})\nexport class SegmentComponent<T = any> implements OnInit {\n  constructor(\n    @Inject(SEGMENT_DATA) public sData: SegmentData,\n    public injector: Injector\n  ) {}\n\n  segment: CompiledSegment<T>;\n  pointers: Pointers;\n  nestedSegments: CompiledSegment<T>[];\n  nestedArraySegments: Array<CompiledSegment[]> = [];\n  arrayFields: Array<CompiledField[]> = [];\n\n  @HostBinding('class')\n  classes: string;\n\n  @HostBinding('id')\n  id: string;\n\n  ngOnInit() {\n    this.segment = this.sData.segment;\n    this.classes = this.sData.segment.classes.join(' ');\n    this.pointers = this.sData.parser.pointers;\n    this.id = this.sData.segment.id || '';\n\n    /**\n     * Each segment compiles all nested segments\n     */\n    this.nestedSegments = filterAndCompileSegments(\n      this.sData.segment.nestedSegments || [],\n      this.sData.parser,\n      this.sData.definitions,\n      this.injector,\n      this.segment.entryValue\n    );\n\n    const array = this.segment.array as string;\n\n    /**\n     * Add array items if necessary\n     */\n    if (array && this.segment.entryValue) {\n      let values;\n\n      try {\n        values = get(this.segment.entryValue, array);\n      } catch (e) {}\n\n      if (values) {\n        values.forEach(() => this.addArrayItem(false));\n\n        (this.pointers[array].control as FormControl).patchValue(\n          values\n        );\n\n        for (let i = 0; i < values.length; i++) {\n          // @ts-ignore\n          this.sData.parser.loadHooks(this.pointers[array].arrayPointers[i]);\n        }\n      }\n    }\n  }\n\n  addArrayItem(loadHook = true) {\n    const array = this.segment.array as string;\n    const pointers: any = this.sData.parser.addArrayItem(\n      (this.sData.parent || '') + array,\n      loadHook,\n      this.sData.parent ? {\n        pointer: this.sData.parent,\n        index: 0\n      } : undefined\n    );\n\n    let fields: CompiledField[];\n\n    if (this.segment.fields && this.segment.fields.length) {\n      fields = (this.segment.fields as string[]).map(key => {\n\n        key = (this.sData.parent || '') + key;\n\n        return this.sData.parser.field(\n          key,\n          pointers[key],\n          this.sData.definitions,\n          true,\n          array\n        );\n      });\n    } else {\n      fields = [this.sData.parser.field(\n        array,\n        {\n          ...this.pointers[array],\n          control: pointers\n        },\n        this.sData.definitions\n      )];\n    }\n\n    this.arrayFields.unshift(\n      fields\n    );\n\n    this.nestedArraySegments.unshift(\n      this.nestedSegments = filterAndCompileSegments(\n        this.sData.segment.nestedSegments || [],\n        this.sData.parser,\n        this.sData.definitions,\n        this.injector,\n        this.segment.entryValue,\n        this.segment.array\n      )\n    );\n  }\n\n  moveArray(up: boolean, fromIndex: number) {\n    let toIndex: number;\n\n    if (up) {\n      toIndex = fromIndex === 0 ? this.arrayFields.length - 1 : fromIndex - 1;\n    } else {\n      toIndex = fromIndex === (this.arrayFields.length - 1) ? 0 : fromIndex + 1;\n    }\n\n    moveItemInArray(\n      this.arrayFields,\n      fromIndex,\n      toIndex\n    );\n\n    moveItemInArray(\n      this.nestedArraySegments,\n      fromIndex,\n      toIndex\n    );\n\n    this.sData.parser.moveArrayItem(\n      (this.sData.parent || '') + this.segment.array as string,\n      fromIndex,\n      toIndex,\n      this.sData.parent ? {\n        pointer: this.sData.parent,\n        index: 0\n      } : undefined\n    );\n  }\n\n  removeArrayItem(index: number) {\n    this.sData.parser.removeArrayItem(\n      (this.sData.parent || '') + this.segment.array as string,\n      index,\n      this.sData.parent ? {\n        pointer: this.sData.parent,\n        index: 0\n      } : undefined\n    );\n    this.nestedArraySegments.splice(index, 1);\n    this.arrayFields.splice(index, 1);\n  }\n}\n","import {ChangeDetectionStrategy, Component, OnInit} from '@angular/core';\nimport {CompiledField} from '../../interfaces/compiled-field.interface';\nimport {CompiledSegment} from '../../interfaces/compiled-segment.interface';\nimport {Segment} from '../../interfaces/segment.interface';\nimport {SegmentComponent} from '../../segment/segment.component';\nimport {filterAndCompileSegments} from '../../utils/filter-and-compile-segments';\n\ninterface SegmentAccord {\n  title?: string;\n  description?: string;\n  fields?: string[];\n  nestedSegments?: Segment[];\n  expanded?: boolean;\n}\n\ninterface CompiledSegmentAccord {\n  title?: string;\n  description?: string;\n  fields?: CompiledField[];\n  nestedSegments?: CompiledSegment[];\n  expanded?: boolean;\n}\n\n@Component({\n  selector: 'fb-accordion',\n  templateUrl: './accordion.component.html',\n  styleUrls: ['./accordion.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AccordionComponent extends SegmentComponent implements OnInit {\n\n  accordions: CompiledSegmentAccord[];\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    this.accordions = (this.sData.segment.configuration || []).map(\n      (accord: SegmentAccord) => ({\n        title: accord.title,\n        fields: (accord.fields || []).map(key =>\n          this.sData.parser.field(\n            key,\n            this.pointers[key],\n            this.sData.definitions\n          )\n        ),\n        nestedSegments: filterAndCompileSegments(\n          accord.nestedSegments || [],\n          this.sData.parser,\n          this.sData.definitions,\n          this.injector,\n          this.segment.entryValue\n        )\n      })\n    );\n  }\n}\n","import {ChangeDetectionStrategy, Component} from '@angular/core';\nimport {CompiledField} from '../../interfaces/compiled-field.interface';\nimport {SegmentComponent} from '../../segment/segment.component';\n\n@Component({\n  selector: 'fb-card',\n  templateUrl: './card.component.html',\n  styleUrls: ['./card.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CardComponent extends SegmentComponent {\n  get fields() {\n    return this.segment.fields as CompiledField[];\n  }\n}\n","import {ChangeDetectionStrategy, Component} from '@angular/core';\nimport {CompiledField} from '../../interfaces/compiled-field.interface';\nimport {SegmentComponent} from '../../segment/segment.component';\n\n@Component({\n  selector: 'fb-empty',\n  templateUrl: './empty.component.html',\n  styleUrls: ['./empty.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class EmptyComponent extends SegmentComponent {\n  get fields() {\n    return this.segment.fields as CompiledField[];\n  }\n}\n","import {ChangeDetectionStrategy, Component} from '@angular/core';\nimport {SegmentComponent} from '../../segment/segment.component';\n\n@Component({\n  selector: 'fb-stepper',\n  templateUrl: './stepper.component.html',\n  styleUrls: ['./stepper.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class StepperComponent extends SegmentComponent {}\n","export function safeEval(method: string) {\n  let final: any;\n\n  try {\n    // tslint:disable-next-line:no-eval\n    final = eval(method);\n  } catch (e) {}\n\n  return final;\n}\n","import {ChangeDetectionStrategy, Component, OnInit} from '@angular/core';\nimport {MatTabChangeEvent} from '@angular/material/tabs';\nimport {CompiledField} from '../../interfaces/compiled-field.interface';\nimport {CompiledSegment} from '../../interfaces/compiled-segment.interface';\nimport {Segment} from '../../interfaces/segment.interface';\nimport {SegmentComponent, SegmentData} from '../../segment/segment.component';\nimport {filterAndCompileSegments} from '../../utils/filter-and-compile-segments';\nimport {safeEval} from '../../utils/safe-eval';\n\ntype SelectedTabChange = (event: MatTabChangeEvent, sData: SegmentData) => void;\n\ninterface TabsConfiguration {\n  selectedIndex?: number;\n  dynamicHeight?: boolean;\n  disableRipple?: boolean;\n  selectedTabChange?: string | SelectedTabChange;\n  alignment?: 'start' | 'center' | 'end';\n  tabs: SegmentTab[];\n}\n\ninterface SegmentTabShared {\n  title?: string;\n  disabled?: boolean;\n}\n\ninterface SegmentTab extends SegmentTabShared {\n  fields?: string[];\n  nestedSegments?: Segment[];\n}\n\ninterface CompiledSegmentTab extends SegmentTabShared {\n  fields?: CompiledField[];\n  nestedSegments?: CompiledSegment[];\n}\n\n@Component({\n  selector: 'fb-tabs',\n  templateUrl: './tabs.component.html',\n  styleUrls: ['./tabs.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TabsComponent extends SegmentComponent<TabsConfiguration> implements OnInit {\n\n  tabs: CompiledSegmentTab[];\n  selectedTabChange?: SelectedTabChange;\n\n  get configuration() {\n    return this.segment.configuration as TabsConfiguration;\n  }\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    if (this.configuration.selectedTabChange) {\n      this.selectedTabChange = safeEval(\n        this.configuration.selectedTabChange as string\n      );\n    }\n\n    this.tabs = this.configuration.tabs.map(\n      tab => ({\n        ...tab,\n        fields: (tab.fields || []).map(key =>\n          this.sData.parser.field(\n            key,\n            this.pointers[key],\n            this.sData.definitions\n          )\n        ),\n        nestedSegments: filterAndCompileSegments(\n          tab.nestedSegments || [],\n          this.sData.parser,\n          this.sData.definitions,\n          this.injector,\n          this.segment.entryValue\n        )\n      })\n    );\n  }\n\n  tabChange(event: MatTabChangeEvent) {\n    if (this.selectedTabChange) {\n      this.selectedTabChange(\n        event,\n        this.sData\n      );\n    }\n  }\n}\n\n","import {SegmentType} from '../enums/segment-type.enum';\nimport {AccordionComponent} from '../segments/accordion/accordion.component';\nimport {CardComponent} from '../segments/card/card.component';\nimport {EmptyComponent} from '../segments/empty/empty.component';\nimport {StepperComponent} from '../segments/stepper/stepper.component';\nimport {TabsComponent} from '../segments/tabs/tabs.component';\n\nexport const SEGMENT_TYPE_COMPONENT_MAP: {[key: string]: any} = {\n  [SegmentType.Empty]: EmptyComponent,\n  [SegmentType.Card]: CardComponent,\n  [SegmentType.Accordion]: AccordionComponent,\n  [SegmentType.Tabs]: TabsComponent,\n  [SegmentType.Stepper]: StepperComponent\n};\n","\n\nexport enum ConditionType {\n  Function = 'function',\n  Statement = 'statement'\n}\n\nexport enum ConditionAction {\n  Show = 'show',\n  Hide = 'hide'\n}\n\nexport enum ConditionEvaluate {\n  OnLoad = 'onLoad',\n  OnChange = 'onChange'\n}\n\nexport interface Condition {\n\n  /**\n   * Defaults to function\n   */\n  type?: ConditionType;\n\n  /**\n   * Stringified condition that could\n   * later also be an object representing\n   * a more complex statement\n   */\n  condition?: string;\n\n  /**\n   * Defaults to show\n   */\n  action?: ConditionAction;\n\n  /**\n   * Not always required; depends on\n   * condition type\n   */\n  data?: any;\n\n  /**\n   * Empty or undefined means evaluate always\n   */\n  evaluateStates?: number[];\n\n  /**\n   * Defaults to OnLoad\n   */\n  evaluateOn?: ConditionEvaluate;\n}\n\nexport interface CompiledCondition {\n  type: ConditionType;\n  action: ConditionAction;\n  condition: (data?: any) => any;\n  evaluateStates: number[];\n  evaluateOn: ConditionEvaluate;\n  data?: any;\n}\n","export enum ComponentType {\n  Input = 'input',\n  Select = 'select',\n  File = 'file',\n  Image = 'image',\n  Gallery = 'gallery',\n  Toggle = 'toggle',\n  Checkbox = 'checkbox',\n  Date = 'date',\n  Range = 'range',\n  Radio = 'radio',\n  Slider = 'slider',\n  Autocomplete = 'autocomplete',\n  Wysiwyg = 'wysiwyg',\n  Chips = 'chips',\n  Draggable = 'draggable',\n  Textarea = 'textarea'\n}\n","import {ComponentPortal} from '@angular/cdk/portal';\nimport {Injector} from '@angular/core';\nimport {SEGMENT_TYPE_COMPONENT_MAP} from '../consts/segment-type-component-map.const';\nimport {SegmentType} from '../enums/segment-type.enum';\nimport {CompiledField} from '../interfaces/compiled-field.interface';\nimport {CompiledSegment} from '../interfaces/compiled-segment.interface';\nimport {CompiledCondition, ConditionAction, ConditionEvaluate, ConditionType} from '../interfaces/condition.interface';\nimport {Definitions} from '../interfaces/definitions.interface';\nimport {Segment} from '../interfaces/segment.interface';\nimport {SegmentComponent} from '../segment/segment.component';\nimport {createSegmentInjector} from './create-segment-injector';\nimport {Parser} from './parser';\nimport {safeEval} from './safe-eval';\n\nexport function compileSegment(\n  segment: Segment,\n  parser: Parser,\n  definitions: Definitions,\n  injector: Injector,\n  entryValue: any,\n  parent = ''\n) {\n  const classes: string[] = [];\n\n  let fields: CompiledField[] | string[] = [];\n\n  if (segment.columnsDesktop) {\n    classes.push(`col-${segment.columnsDesktop}`);\n  }\n\n  if (segment.columnsTablet) {\n    classes.push(`col-m-${segment.columnsTablet}`);\n  }\n\n  if (segment.columnsMobile) {\n    classes.push(`col-s-${segment.columnsMobile}`);\n  }\n\n  /**\n   * If there aren't any column definitions\n   * default to full width\n   */\n  if (!classes.length) {\n    classes.push('col-12');\n  }\n\n  if (segment.classes) {\n    classes.push(...segment.classes);\n  }\n\n  if (segment.fields) {\n\n    /**\n     * If it's an array fields aren' parsed\n     */\n    if (segment.array) {\n      // @ts-ignore\n      fields = (segment.fields || []).map(fi => segment.array + fi);\n    } else {\n      fields = (segment.fields || [])\n        // @ts-ignore\n        .reduce((acc: CompiledField[], key: string) => {\n          const definition = parser.getFromDefinitions(key, definitions);\n\n          if (\n            !definition ||\n            !definition.roles ||\n            (\n              typeof definition.roles === 'string' ?\n                definition.roles === parser.role :\n                definition.roles.includes(parser.role)\n            )\n          ) {\n            acc.push(\n              parser.field(key, parser.pointers[key], definitions)\n            );\n          }\n\n          return acc;\n        }, []);\n    }\n  }\n\n  const compiledSegment = {\n    ...segment,\n    classes,\n    fields,\n    entryValue\n  } as CompiledSegment;\n\n  /**\n   * TODO:\n   * Statement support\n   */\n  if (segment.conditions) {\n\n    compiledSegment.conditions = [];\n    const valToPass = entryValue || {};\n\n    for (const cur of segment.conditions) {\n      let condition;\n\n      const type = cur.type || ConditionType.Function;\n      const action = cur.action || ConditionAction.Show;\n      const evaluateOn = cur.evaluateOn || ConditionEvaluate.OnLoad;\n      const evaluateStates = cur.evaluateStates || [0, 1, 2];\n\n      if (cur.condition) {\n        condition = safeEval(cur.condition as string);\n      }\n\n      if (condition) {\n\n        /**\n         * Evaluate on load conditions\n         */\n        if (evaluateOn === ConditionEvaluate.OnLoad) {\n\n          /**\n           * Check if items should be excluded right away\n           */\n          if (\n            (action === ConditionAction.Show && !condition(valToPass)) ||\n            (action === ConditionAction.Hide && condition(valToPass))\n          ) {\n            return null;\n          }\n        }\n\n        compiledSegment.conditions.push({\n          condition,\n          type,\n          action,\n          evaluateStates,\n          evaluateOn,\n          ...cur.data && {\n            data: cur.data\n          }\n        } as CompiledCondition);\n      }\n    }\n  }\n\n  return {\n    component: new ComponentPortal<SegmentComponent>(\n      SEGMENT_TYPE_COMPONENT_MAP[segment.type || SegmentType.Card],\n      null,\n      createSegmentInjector(injector, {\n        segment: compiledSegment,\n        parser,\n        definitions,\n        ...parent && {parent},\n      })\n    ),\n    ...compiledSegment\n  } as CompiledSegment;\n}\n","import {Injector} from '@angular/core';\nimport {Definitions} from '../interfaces/definitions.interface';\nimport {Segment} from '../interfaces/segment.interface';\nimport {compileSegment} from './compile-segment';\nimport {Parser} from './parser';\n\nexport function filterAndCompileSegments(\n  segments: Segment[],\n  parser: Parser,\n  definitions: Definitions,\n  injector: Injector,\n  value: any,\n  parent?: string\n) {\n  return segments.reduce((acc, cur) => {\n    if (!cur.authorization || cur.authorization.includes(parser.role)) {\n\n      const compiled = compileSegment(\n        cur,\n        parser,\n        definitions,\n        injector,\n        value,\n        parent\n      );\n\n      if (compiled) {\n        acc.push(\n          // @ts-ignore\n          compiled\n        );\n      }\n    }\n\n    return acc;\n  }, []);\n}\n","import {Observable, of} from 'rxjs';\nimport {WhereFilter} from '../interfaces/where-filter.interface';\n\nexport abstract class DbService {\n\n  getDocuments(\n    moduleId: string,\n    pageSize?: number,\n    sort?: {\n      active: string;\n      direction: string;\n    },\n    cursor?: any,\n    filters?: WhereFilter[]\n  ): Observable<any[]> {\n    return of([]);\n  }\n\n  getDocumentsSimple(\n    moduleId: string,\n    orderBy?: string,\n    filter?: WhereFilter\n  ): Observable<any[]> {\n    return of([]);\n  }\n\n  getStateChanges(\n    moduleId: string,\n    pageSize?: number,\n    sort?: {\n      active: string;\n      direction: string;\n    },\n    cursor?: any,\n    filters?: WhereFilter[],\n  ): Observable<any[]> {\n    return of([]);\n  }\n\n  getDocument<T = any>(\n    moduleId: string,\n    documentId: string,\n    stream = false\n  ): Observable<T> {\n    return of();\n  }\n\n  setDocument(\n    moduleId: string,\n    documentId: string,\n    data: any,\n    options?: any\n  ): Observable<void> {\n    return of();\n  }\n\n  removeDocument(moduleId: string, documentId: string): Observable<void> {\n    return of();\n  }\n\n  createUserAccount(email: string, password: string): Observable<{id: string}> {\n    return of();\n  }\n\n  removeUserAccount(id: string): Observable<any> {\n    return of();\n  }\n}\n","import {PortalInjector} from '@angular/cdk/portal';\nimport {InjectionToken, Injector} from '@angular/core';\n\nexport const COMPONENT_DATA = new InjectionToken<{}>('COMPONENT_DATA');\n\nexport function createComponentInjector(injector: Injector, dataToPass: any): PortalInjector {\n  const injectorTokens = new WeakMap();\n  injectorTokens.set(COMPONENT_DATA, dataToPass);\n  return new PortalInjector(injector, injectorTokens);\n}\n","import {Component, HostBinding, Inject} from '@angular/core';\nimport {FieldData} from '../interfaces/field-data.interface';\nimport {COMPONENT_DATA} from '../utils/create-component-injector';\n\n// @dynamic\n@Component({\n  selector: 'fb-field',\n  template: ''\n})\nexport class FieldComponent<T extends FieldData> {\n  constructor(\n    @Inject(COMPONENT_DATA) public cData: T\n  ) {\n\n    const classes = [\n      `fb-field-${this.cData.columnsDesktop || 12}`\n    ];\n\n    if (this.cData.columnsTablet) {\n      classes.push(`m-fb-field-${this.cData.columnsTablet}`);\n    }\n\n    if (this.cData.columnsMobile) {\n      classes.push(`s-fb-field-${this.cData.columnsMobile}`);\n    }\n\n    if (this.cData.class) {\n      classes.push(this.cData.class);\n    }\n\n    this.class = classes.join(' ');\n  }\n\n  @HostBinding('class')\n  class: string;\n}\n","import {Observable, of} from 'rxjs';\nimport {map} from 'rxjs/operators';\nimport {FieldData} from '../interfaces/field-data.interface';\nimport {safeEval} from './safe-eval';\n\nexport interface HSD {\n  type?: 'html' | 'static' | 'dynamic';\n  value: string;\n}\n\nexport function getHsd(\n  key: string,\n  data: FieldData\n): Observable<string> {\n  if (data[key]) {\n\n    let item: any;\n\n    switch (data[key].type) {\n      case 'dynamic':\n        item = safeEval(data[key].value);\n\n        if (item) {\n          return data.form.valueChanges\n            .pipe(\n              map(value =>\n                item(\n                  data.control.value,\n                  value\n                )\n              )\n            );\n        }\n\n        break;\n      case 'static':\n        item = safeEval(data[key].value);\n\n        if (item) {\n          return of(item(\n            data.control.value,\n            data.form.getRawValue()\n          ));\n        }\n        break;\n      case 'html':\n      default:\n        return of(data[key].value);\n    }\n  }\n\n  return of('');\n}\n","import {\n  ChangeDetectionStrategy,\n  Component,\n  Inject,\n  OnInit\n} from '@angular/core';\nimport {BehaviorSubject, Observable, of} from 'rxjs';\nimport {map, startWith, switchMap, tap} from 'rxjs/operators';\nimport {DbService} from '../../services/db.service';\nimport {FieldComponent} from '../../field/field.component';\nimport {FieldData} from '../../interfaces/field-data.interface';\nimport {WhereFilter} from '../../interfaces/where-filter.interface';\nimport {COMPONENT_DATA} from '../../utils/create-component-injector';\nimport {getHsd, HSD} from '../../utils/get-hsd';\n\ninterface AutocompleteData extends FieldData {\n  dataSet: Array<{name: string; value: any}>;\n  populate?: {\n    collection: string;\n    nameKey: string;\n    valueKey?: string;\n    orderBy?: string;\n    filter?: WhereFilter;\n  };\n  autocomplete?: string;\n  suffix?: HSD;\n  prefix?: HSD;\n}\n\n@Component({\n  selector: 'fb-autocomplete',\n  templateUrl: './autocomplete.component.html',\n  styleUrls: ['./autocomplete.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AutocompleteComponent extends FieldComponent<AutocompleteData>\n  implements OnInit {\n  constructor(\n    @Inject(COMPONENT_DATA) public cData: AutocompleteData,\n    private dbService: DbService\n  ) {\n    super(cData);\n  }\n\n  filteredSet$: Observable<Array<{name: string; value: string}>>;\n  loading$ = new BehaviorSubject(true);\n  prefix$: Observable<string>;\n  suffix$: Observable<string>;\n\n  ngOnInit() {\n\n    this.prefix$ = getHsd('prefix', this.cData);\n    this.suffix$ = getHsd('suffix', this.cData);\n\n    let dataSet$: Observable<Array<{name: string; value: string}>>;\n\n    if (this.cData.populate) {\n\n      const {populate} = this.cData;\n\n      dataSet$ = this.dbService\n        .getDocumentsSimple(\n          this.cData.populate.collection,\n          this.cData.populate.orderBy,\n          this.cData.populate.filter\n        )\n        .pipe(\n          map(docs =>\n            docs.map(doc => ({\n              value: doc[populate.valueKey || 'id'],\n              name: doc[populate.nameKey]\n            }))\n          ),\n          tap(() => this.loading$.next(false))\n        );\n    } else {\n      dataSet$ = of(this.cData.dataSet);\n    }\n\n    this.filteredSet$ = dataSet$.pipe(\n      switchMap(dataSet =>\n        this.cData.control.valueChanges.pipe(\n          startWith(this.cData.control.value),\n          map(value => {\n            if (!value) {\n              return dataSet;\n            }\n\n            value = value.toLowerCase();\n\n            return dataSet.filter(item =>\n              item.name.toLowerCase().includes(value)\n            );\n          })\n        )\n      )\n    );\n  }\n}\n","import {Component, ChangeDetectionStrategy} from '@angular/core';\nimport {FieldComponent} from '../../field/field.component';\nimport {FieldData} from '../../interfaces/field-data.interface';\n\n@Component({\n  selector: 'fb-checkbox',\n  templateUrl: './checkbox.component.html',\n  styleUrls: ['./checkbox.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CheckboxComponent extends FieldComponent<FieldData> {}\n","import {ChangeDetectionStrategy, Component, OnInit} from '@angular/core';\nimport {MatChipInputEvent} from '@angular/material/chips';\nimport {Observable} from 'rxjs';\nimport {FieldComponent} from '../../field/field.component';\nimport {FieldData} from '../../interfaces/field-data.interface';\nimport {getHsd, HSD} from '../../utils/get-hsd';\n\ninterface ChipsData extends FieldData {\n  selectable: boolean;\n  removable: boolean;\n  addOnBlur: boolean;\n  unique: boolean;\n  autocomplete?: string;\n  suffix?: HSD;\n  prefix?: HSD;\n}\n\n@Component({\n  selector: 'fb-chips',\n  templateUrl: './chips.component.html',\n  styleUrls: ['./chips.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ChipsComponent extends FieldComponent<ChipsData>\n  implements OnInit {\n\n  data: string[] = [];\n  removable: boolean;\n  prefix$: Observable<string>;\n  suffix$: Observable<string>;\n\n  ngOnInit() {\n    this.data = this.cData.control.value;\n    this.removable = this.cData.hasOwnProperty('removable') ? this.cData.removable : true;\n    this.prefix$ = getHsd('prefix', this.cData);\n    this.suffix$ = getHsd('suffix', this.cData);\n  }\n\n  add(event: MatChipInputEvent) {\n    const value = (event.value || '').trim();\n    const input = event.input;\n\n    if (value && (this.cData.unique ? !this.data.includes(value) : true)) {\n      this.data.push(value);\n      this.cData.control.setValue(this.data);\n    }\n\n    if (input) {\n      input.value = '';\n    }\n  }\n\n  remove(chip: string) {\n    const index = this.cData.control.value.indexOf(chip);\n\n    if (index >= 0) {\n      this.data.splice(index, 1);\n      this.cData.control.setValue(this.data);\n    }\n  }\n}\n","import {\n  AbstractControl,\n  FormArray,\n  FormControl,\n  FormGroup\n} from '@angular/forms';\n\n/**\n * Deep clones the given AbstractControl, preserving values, validators, async validators, and disabled status.\n * @param control AbstractControl\n * @returns AbstractControl\n */\nexport function cloneAbstractControl<T extends AbstractControl>(control: T): T {\n  let newControl: T;\n\n  if (control instanceof FormGroup) {\n    const formGroup = new FormGroup(\n      {},\n      control.validator,\n      control.asyncValidator\n    );\n    const controls = control.controls;\n\n    Object.keys(controls).forEach(key => {\n      formGroup.addControl(key, cloneAbstractControl(controls[key]));\n    });\n\n    newControl = formGroup as any;\n  } else if (control instanceof FormArray) {\n    const formArray = new FormArray(\n      [],\n      control.validator,\n      control.asyncValidator\n    );\n\n    control.controls.forEach(formControl =>\n      formArray.push(cloneAbstractControl(formControl))\n    );\n\n    newControl = formArray as any;\n  } else if (control instanceof FormControl) {\n    newControl = new FormControl(\n      control.value,\n      control.validator,\n      control.asyncValidator\n    ) as any;\n  } else {\n    throw new Error('Error: unexpected control value');\n  }\n\n  if (control.disabled) {\n    newControl.disable({emitEvent: false});\n  }\n\n  return newControl;\n}\n","import {DatePipe} from '@angular/common';\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, Inject, OnInit} from '@angular/core';\nimport {FormControl, FormGroup, Validators} from '@angular/forms';\nimport {of} from 'rxjs';\nimport {tap} from 'rxjs/operators';\nimport {FieldComponent} from '../../field/field.component';\nimport {FormBuilderService} from '../../form-builder.service';\nimport {FieldData} from '../../interfaces/field-data.interface';\nimport {COMPONENT_DATA} from '../../utils/create-component-injector';\nimport {cloneAbstractControl} from '../../utils/clone-abstract-control';\n\ninterface DateData extends FieldData {\n  startYear?: number;\n  startAt?: number;\n  touchUi?: boolean;\n  startView?: 'month' | 'year' | 'multi-year';\n  format?: 'number' | string;\n  autocomplete?: string;\n  includeTime?: boolean;\n  labelHours?: string;\n  labelMinutes?: string;\n  placeholderHours?: string;\n  placeholderMinutes?: string;\n}\n\n@Component({\n  selector: 'fb-date-field',\n  templateUrl: './date-field.component.html',\n  styleUrls: ['./date-field.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DateFieldComponent extends FieldComponent<DateData>\n  implements OnInit {\n  constructor(\n    @Inject(COMPONENT_DATA) public cData: DateData,\n    private cdr: ChangeDetectorRef,\n    private formBuilderService: FormBuilderService\n  ) {\n    super(cData);\n  }\n\n  form: FormGroup;\n  startDate: Date;\n  entryControl: FormControl;\n  hoursControl: FormControl;\n  minutesControl: FormControl;\n\n  ngOnInit() {\n    this.formBuilderService.saveComponents.push(this);\n    this.startDate = this.cData.startAt\n      ? new Date(this.cData.startAt)\n      : new Date();\n\n    const date = new Date(this.cData.control.value);\n\n    this.entryControl = cloneAbstractControl(this.cData.control);\n    this.hoursControl = new FormControl(\n      {value: date.getHours() || 0, disabled: this.cData.control.disabled},\n      [Validators.min(0), Validators.max(23)]\n    );\n    this.minutesControl = new FormControl(\n      {value: date.getMinutes() || 0, disabled: this.cData.control.disabled},\n      [Validators.min(0), Validators.max(59)]\n    );\n\n    /**\n     * Dirty hack for getting numbers to display properly might need revisiting\n     */\n    if (\n      typeof this.entryControl.value === 'number' ||\n      typeof this.entryControl.value === 'string'\n    ) {\n      this.entryControl.setValue(new Date(this.entryControl.value));\n    }\n  }\n\n  save() {\n    return of({}).pipe(\n      tap(() => {\n        let value = this.entryControl.value;\n\n        if (value) {\n          if (this.cData.includeTime) {\n            value.setHours(this.hoursControl.value || 0);\n            value.setMinutes(this.minutesControl.value || 0);\n          }\n\n          if (this.cData.format) {\n            if (this.cData.format === 'number') {\n              value = value.getTime();\n            } else {\n              const pipe = new DatePipe('en');\n\n              value = pipe.transform(value, this.cData.format);\n            }\n          }\n        }\n\n        this.cData.control.setValue(value);\n      })\n    );\n  }\n}\n","import {CdkDragDrop, moveItemInArray} from '@angular/cdk/drag-drop';\nimport {ChangeDetectionStrategy, Component, OnInit} from '@angular/core';\nimport {FieldComponent} from '../../field/field.component';\nimport {FieldData} from '../../interfaces/field-data.interface';\nimport {Option} from '../../interfaces/option.interface';\n\ninterface DragData extends FieldData {\n  options: Option[];\n}\n\n@Component({\n  selector: 'fb-draggable-list',\n  templateUrl: './draggable-list.component.html',\n  styleUrls: ['./draggable-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DraggableListComponent extends FieldComponent<DragData>\n  implements OnInit {\n  ngOnInit() {\n    if (this.cData.control.value.length) {\n      this.cData.options.sort((optionOne, optionTwo) => {\n        const indexOne = this.cData.control.value.indexOf(optionOne);\n        const indexTwo = this.cData.control.value.indexOf(optionTwo);\n        return indexTwo - indexOne;\n      });\n    }\n  }\n\n  drop(event: CdkDragDrop<string[]>) {\n    moveItemInArray(\n      this.cData.options,\n      event.previousIndex,\n      event.currentIndex\n    );\n\n    this.cData.control.setValue(\n      this.cData.options.map(val => {\n        return val.value;\n      })\n    );\n  }\n}\n","export abstract class StorageService {\n  storage: any;\n\n  upload(path: string, data: any, metadata?: any): any {}\n}\n","/**\n * Remove all characters that are not alphanumeric.\n *\n * In case of not finding any alphanumeric characters\n * return string `file-{random number}`\n *\n * @param name\n * File name to format\n */\nexport const formatFileName = (name: string): string => {\n  const extension = name.slice(name.lastIndexOf('.'));\n  name = name.slice(0, name.lastIndexOf('.'));\n  name = (name.match(/[a-zA-Z\\d.]/g) || []).join('');\n  return !!name.length ? name + extension : `file-${Math.floor(Math.random() * 10 ** 5) + 1}${extension}`;\n};\n","export const parseSize = (size: string | number): number => {\n  if (typeof size === 'number') {\n    return size;\n  }\n\n  const KB = 1024;\n  const MB = KB ** 2;\n\n  const num = parseFloat(size);\n  const unit = size.replace(/[0-9]/g, '').toLowerCase();\n\n  switch (unit) {\n    case 'kb': {\n      return num * KB;\n    }\n    case 'mb': {\n      return num * MB;\n    }\n    default: {\n      return 0;\n    }\n  }\n};\n","import {ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, Inject, OnInit, ViewChild} from '@angular/core';\nimport {MatSnackBar} from '@angular/material/snack-bar';\nimport {TranslocoService} from '@ngneat/transloco';\nimport {from, of, throwError} from 'rxjs';\nimport {switchMap, tap} from 'rxjs/operators';\nimport {FieldComponent} from '../../field/field.component';\nimport {FormBuilderService} from '../../form-builder.service';\nimport {FieldData} from '../../interfaces/field-data.interface';\nimport {StorageService} from '../../services/storage.service';\nimport {COMPONENT_DATA} from '../../utils/create-component-injector';\nimport {formatFileName} from '../../utils/format-file-name';\nimport {parseSize} from '../../utils/parse-size';\n\ninterface FileData extends FieldData {\n  emptyLabel?: string;\n  preventClear?: boolean;\n  allowedFileTypes?: string[];\n  forbiddenFileTypes?: string[];\n  minSize?: string | number;\n  maxSize?: string | number;\n}\n\n@Component({\n  selector: 'fb-file',\n  templateUrl: './file.component.html',\n  styleUrls: ['./file.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FileComponent extends FieldComponent<FileData> implements OnInit {\n  @ViewChild('file', {static: true})\n  fileEl: ElementRef<HTMLInputElement>;\n  value: File;\n  name: string;\n  emptyLabel: string;\n\n  allowedFileTypes: string[];\n  forbiddenFileTypes: string[];\n  minSizeBytes: number;\n  maxSizeBytes: number;\n\n  constructor(\n    @Inject(COMPONENT_DATA) public cData: FileData,\n    private storage: StorageService,\n    private cdr: ChangeDetectorRef,\n    private formBuilderService: FormBuilderService,\n    private transloco: TranslocoService,\n    private snackBar: MatSnackBar\n  ) {\n    super(cData);\n  }\n\n  ngOnInit() {\n    if (this.cData.control.value) {\n      this.name = this.cData.control.value;\n    }\n\n    this.emptyLabel = (this.cData.hasOwnProperty('emptyLabel') ? this.cData.emptyLabel : 'FIELDS.FILE.EMPTY') as string;\n\n    this.formBuilderService.saveComponents.push(this);\n\n    this.allowedFileTypes = this.cData.allowedFileTypes || [];\n    this.forbiddenFileTypes = this.cData.forbiddenFileTypes || [];\n    this.minSizeBytes = this.cData.minSize ? parseSize(this.cData.minSize) : 0;\n    this.maxSizeBytes = this.cData.maxSize ? parseSize(this.cData.maxSize) : 0;\n  }\n\n  errorSnack(message: string = 'GENERAL.ERROR', dismiss: string = 'GENERAL.DISMISS') {\n    this.snackBar.open(\n      this.transloco.translate(message),\n      this.transloco.translate(dismiss),\n      {\n        panelClass: 'snack-bar-error',\n        duration: 5000\n      }\n    );\n  }\n\n  fileChange(ev: Event) {\n    const el = ev.target as HTMLInputElement;\n    const file = Array.from(el.files as FileList)[0] as File;\n\n    Object.defineProperty(file, 'name', {\n      writable: true,\n      value: formatFileName(file.name)\n    });\n\n    if (!this.allowedFileTypes.includes(file.type) && !!this.allowedFileTypes.length) {\n      this.errorSnack('FIELDS.FILE.INVALID_FILE_FORMAT');\n      return throwError('Invalid File Format');\n    }\n\n    if (this.forbiddenFileTypes.includes(file.type)) {\n      this.errorSnack('FIELDS.FILE.FORBIDDEN_FILE_FORMAT');\n      return throwError('Forbidden File Format');\n    }\n\n    if (file.size < this.minSizeBytes) {\n      this.errorSnack('FIELDS.FILE.BELOW_SIZE');\n      return throwError('File below minimal allowed size');\n    }\n\n    if (file.size > this.maxSizeBytes && !!this.maxSizeBytes) {\n      this.errorSnack('FIELDS.FILE.EXCEED_SIZE');\n      return throwError('File exceeding allowed size');\n    }\n\n    this.value = file;\n    if (this.value) {\n      this.name = this.value.name;\n    }\n    el.value = '';\n  }\n\n  clear() {\n    this.name = '';\n    this.cData.control.setValue('');\n  }\n\n  save(moduleId: string, documentId: string) {\n    if (this.value) {\n      const name = [\n        moduleId,\n        documentId,\n        this.value.name\n      ]\n        .join('-');\n\n      return from(\n        this.storage.upload(name, this.value, {\n          contentType: this.value.type,\n          customMetadata: {\n            moduleId,\n            documentId\n          }\n        })\n      ).pipe(\n        switchMap((res: any) => res.ref.getDownloadURL()),\n        tap(url => this.cData.control.setValue(url))\n      );\n    } else {\n      return of({});\n    }\n  }\n}\n","import {GeneratedImage} from '../interfaces/generated-image.interface';\n\nexport function formatGeneratedImages(data: GeneratedImage[]) {\n  return data.reduce((acc, cur, index) => {\n    acc[`generate_${index + 1}`] = Object.entries(cur).reduce((generated, [key, value]) => {\n      generated += `----${key}:${value}`;\n      return generated;\n    }, '');\n    return acc;\n  }, {}) as {\n    [key: string]: string;\n  };\n}\n","import {InjectionToken} from '@angular/core';\n\nexport const STORAGE_URL = new InjectionToken<{}>('STORAGE_URL');\n","/**\n * Switches the location of two items\n * in an array\n */\nexport function switchItemLocations(\n  items: any[],\n  previousIndex: number,\n  currentIndex: number\n) {\n  const itemOne = items[previousIndex];\n  const itemTwo = items[currentIndex];\n\n  items[currentIndex] = itemOne;\n  items[previousIndex] = itemTwo;\n}\n","import {Observable} from 'rxjs';\n\nexport function readFile(blob: Blob): Observable<string> {\n  return new Observable(obs => {\n    if (!(blob instanceof Blob)) {\n      obs.error(new Error('`blob` must be an instance of File or Blob.'));\n      return;\n    }\n\n    const reader = new FileReader();\n\n    reader.onerror = err => obs.error(err);\n    reader.onabort = err => obs.error(err);\n    reader.onload = () => obs.next(reader.result as string);\n    reader.onloadend = () => obs.complete();\n\n    return reader.readAsDataURL(blob);\n  });\n}\n","import {CdkDrag, CdkDragDrop, CdkDragMove, CdkDropList, CdkDropListGroup, moveItemInArray} from '@angular/cdk/drag-drop';\nimport {ViewportRuler} from '@angular/cdk/overlay';\nimport {HttpClient} from '@angular/common/http';\nimport {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Inject,\n  OnInit,\n  Optional,\n  TemplateRef,\n  ViewChild\n} from '@angular/core';\nimport {MatDialog} from '@angular/material/dialog';\nimport {MatSnackBar} from '@angular/material/snack-bar';\nimport {TranslocoService} from '@ngneat/transloco';\nimport {forkJoin, from, of, throwError} from 'rxjs';\nimport {catchError, map, switchMap, tap} from 'rxjs/operators';\nimport {FieldComponent} from '../../field/field.component';\nimport {FormBuilderService} from '../../form-builder.service';\nimport {FieldData} from '../../interfaces/field-data.interface';\nimport {GeneratedImage} from '../../interfaces/generated-image.interface';\nimport {StorageService} from '../../services/storage.service';\nimport {COMPONENT_DATA} from '../../utils/create-component-injector';\nimport {formatFileName} from '../../utils/format-file-name';\nimport {formatGeneratedImages} from '../../utils/format-generated-images';\nimport {parseSize} from '../../utils/parse-size';\nimport {STORAGE_URL} from '../../utils/storage-url';\nimport {switchItemLocations} from '../../utils/switch-item-locations';\nimport {readFile} from './read-file';\n\ninterface GalleryData extends FieldData {\n  allowUrl?: boolean;\n  allowServerUpload?: boolean;\n  generatedImages?: GeneratedImage[];\n  allowedImageTypes?: string[];\n  forbiddenImageTypes?: string[];\n  minSize?: string | number;\n  maxSize?: string | number;\n}\n\n@Component({\n  selector: 'fb-gallery',\n  templateUrl: './gallery.component.html',\n  styleUrls: ['./gallery.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class GalleryComponent extends FieldComponent<GalleryData>\n  implements OnInit, AfterViewInit {\n  constructor(\n    @Inject(COMPONENT_DATA)\n    public cData: GalleryData,\n    @Optional()\n    @Inject(STORAGE_URL)\n    private storageUrl: string,\n    private dialog: MatDialog,\n    private cdr: ChangeDetectorRef,\n    private http: HttpClient,\n    private storage: StorageService,\n    private formBuilderService: FormBuilderService,\n    private viewportRuler: ViewportRuler,\n    private transloco: TranslocoService,\n    private snackBar: MatSnackBar\n  ) {\n    super(cData);\n  }\n\n  @ViewChild(CdkDropListGroup, {static: true})\n  listGroup: CdkDropListGroup<CdkDropList>;\n  @ViewChild(CdkDropList, {static: true})\n  placeholder: CdkDropList;\n  @ViewChild('modal', {static: true})\n  modalTemplate: TemplateRef<any>;\n  @ViewChild('imagesSort', {static: true})\n  imagesSort: TemplateRef<any>;\n  @ViewChild('file', {static: true})\n  fileEl: ElementRef<HTMLInputElement>;\n  target: CdkDropList | null;\n  targetIndex: number;\n  source: CdkDropList | null;\n  sourceIndex: number;\n  activeContainer: any;\n  files: File[] = [];\n  toRemove: any[] = [];\n\n  allowedImageTypes: string[];\n  forbiddenImageTypes: string[];\n  minSizeBytes: number;\n  maxSizeBytes: number;\n\n  ngOnInit() {\n    this.formBuilderService.saveComponents.push(this);\n\n    this.allowedImageTypes = this.cData.allowedImageTypes || [];\n    this.forbiddenImageTypes = this.cData.forbiddenImageTypes || [];\n    this.minSizeBytes = this.cData.minSize ? parseSize(this.cData.minSize) : 0;\n    this.maxSizeBytes = this.cData.maxSize ? parseSize(this.cData.maxSize) : 0;\n  }\n\n  ngAfterViewInit() {\n    const phElement = this.placeholder.element.nativeElement;\n    const {parentElement} = phElement as any;\n\n    phElement.style.display = 'none';\n    parentElement.removeChild(phElement);\n  }\n\n  openUploadDialog() {\n    this.dialog.open(this.modalTemplate, {\n      width: '420px'\n    });\n  }\n\n  addImage(image: string) {\n    this.http\n      .get(image, {\n        withCredentials: false,\n        responseType: 'blob'\n      })\n      .pipe(\n        switchMap((blob: Blob) => {\n          const type = blob.type.split('/')[1].toLowerCase();\n          if (!this.allowedImageTypes.includes(type) && !!this.allowedImageTypes.length) {\n            return throwError('Invalid Image Format');\n          }\n\n          if (this.forbiddenImageTypes.includes(type)) {\n            return throwError('Forbidden Image Format');\n          }\n\n          if (blob.size < this.minSizeBytes) {\n            return throwError('Image below minimal allowed size');\n          }\n\n          if (blob.size > this.maxSizeBytes && !!this.maxSizeBytes) {\n            return throwError('Image exceeding allowed size');\n          }\n\n          return of(blob);\n        }),\n        this.formBuilderService.notify({\n          error: 'FIELDS.GALLERY.UPLOAD_ERROR',\n          success: null\n        }))\n      .subscribe(res => {\n        const urlCreator = window.URL || (window as any).webkitURL;\n        const value = this.cData.control.value;\n\n        value.push({\n          data: urlCreator.createObjectURL(res),\n          live: true\n        });\n\n        this.cData.control.setValue(value);\n        this.cdr.detectChanges();\n      });\n  }\n\n  openFileUpload() {\n    this.fileEl.nativeElement.click();\n  }\n\n  openSortImages() {\n    this.dialog.open(this.imagesSort, {\n      width: '800px'\n    });\n  }\n\n  drop(event: CdkDragDrop<string[]>) {\n    const value = this.cData.control.value;\n    switchItemLocations(value, event.previousIndex, event.currentIndex);\n    this.cData.control.setValue(value);\n    this.cdr.detectChanges();\n  }\n\n  move(up = false, index: number) {\n    const currentIndex = up ? index - 1 : index + 1;\n    const value = this.cData.control.value;\n    moveItemInArray(value, index, currentIndex);\n    this.cData.control.setValue(value);\n    this.cdr.detectChanges();\n  }\n\n  errorSnack(message: string = 'GENERAL.ERROR', dismiss: string = 'GENERAL.DISMISS') {\n    this.snackBar.open(\n      this.transloco.translate(message),\n      this.transloco.translate(dismiss),\n      {\n        panelClass: 'snack-bar-error',\n        duration: 5000\n      }\n    );\n  }\n\n  filesUploaded(el: HTMLInputElement | FileList) {\n    const files = Array.from((el instanceof FileList ? el : el.files) as FileList);\n    for (const file of files) {\n      Object.defineProperty(file, 'name', {\n        writable: true,\n        value: formatFileName(file.name)\n      });\n\n      const type = file.type.split('/')[1].toLowerCase();\n\n      if (!this.allowedImageTypes.includes(type) && !!this.allowedImageTypes.length) {\n        this.errorSnack('FIELDS.GALLERY.INVALID_IMAGE_FORMAT');\n        return throwError('Invalid Image Format');\n      }\n\n      if (this.forbiddenImageTypes.includes(type)) {\n        this.errorSnack('FIELDS.GALLERY.FORBIDDEN_IMAGE_FORMAT');\n        return throwError('Forbidden Image Format');\n      }\n\n      if (file.size < this.minSizeBytes) {\n        this.errorSnack('FIELDS.GALLERY.BELOW_SIZE');\n        return throwError('Image below minimal allowed size');\n      }\n\n      if (file.size > this.maxSizeBytes && !!this.maxSizeBytes) {\n        this.errorSnack('FIELDS.GALLERY.EXCEED_SIZE');\n        return throwError('Image exceeding allowed size');\n      }\n    }\n\n    forkJoin(\n      files.map(file =>\n        readFile(file).pipe(\n          map(data => ({\n            data,\n            pushToLive: file,\n            live: false\n          }))\n        )\n      )\n    ).subscribe(\n      fls => {\n        const value = this.cData.control.value;\n        value.push(...fls);\n        this.cData.control.setValue(value);\n\n        if (!(el instanceof FileList)) {\n          el.value = '';\n        }\n\n        this.cdr.detectChanges();\n      },\n      () => {\n        if (!(el instanceof FileList)) {\n          el.value = '';\n        }\n      }\n    );\n  }\n\n  removeImage(index: number, item: any) {\n    if (item.live && item.data.includes(this.storageUrl)) {\n      this.toRemove.push(item.data);\n    }\n\n    this.cData.control.value.splice(index, 1);\n  }\n\n  sortDrop(event: CdkDragDrop<string[]>) {\n    const value = this.cData.control.value;\n    moveItemInArray(value, event.previousIndex, event.currentIndex);\n    this.cData.control.setValue(value);\n  }\n\n  /**\n   * Drag and Drop\n   */\n  dragMoved(e: CdkDragMove) {\n    const point = this.getPointerPositionOnPage(e.event);\n\n    this.listGroup._items.forEach(dropList => {\n      if (__isInsideDropListClientRect(dropList, point.x, point.y)) {\n        this.activeContainer = dropList;\n        return;\n      }\n    });\n  }\n\n  dropListDropped() {\n    if (!this.target) {\n      return;\n    }\n\n    const phElement = this.placeholder.element.nativeElement;\n    const parent: any = phElement.parentElement;\n\n    phElement.style.display = 'none';\n\n    const {element} = this.source as any;\n\n    parent.removeChild(phElement);\n    parent.appendChild(phElement);\n    parent.insertBefore(element.nativeElement, parent.children[this.sourceIndex]);\n\n    this.target = null;\n    this.source = null;\n\n    if (this.sourceIndex !== this.targetIndex) {\n      const value = this.cData.control.value;\n      moveItemInArray(value, this.sourceIndex, this.targetIndex);\n      this.cData.control.setValue(value);\n    }\n  }\n\n  /** Determines the point of the page that was touched by the user. */\n  getPointerPositionOnPage(event: MouseEvent | TouchEvent) {\n    // `touches` will be empty for start/end events so we have to fall back to `changedTouches`.\n    const point = __isTouchEvent(event) ? (event.touches[0] || event.changedTouches[0]) : event;\n    const scrollPosition = this.viewportRuler.getViewportScrollPosition();\n\n    return {\n      x: point.pageX - scrollPosition.left,\n      y: point.pageY - scrollPosition.top\n    };\n  }\n\n  /**\n   * Executes all uploads/removes to persist\n   * the changes on server\n   */\n  save(moduleId: string, documentId: string) {\n    if (\n      !this.toRemove.length &&\n      !this.cData.control.value ||\n      !this.cData.control.value.find((val: any) => !val.live)\n    ) {\n      return of([]);\n    }\n\n    return forkJoin([\n      ...this.toRemove.map(file =>\n        from(this.storage.storage.refFromURL(file).delete()).pipe(\n          /**\n           * Dont' fail if files didn't delete\n           */\n          catchError(() => of([]))\n        )\n      ),\n      ...this.cData.control.value.reduce((acc: any[], cur: any) => {\n        if (cur.live !== undefined && !cur.live) {\n\n          const name = [\n            moduleId,\n            documentId,\n            cur.pushToLive.name\n          ]\n            .join('-');\n\n          acc.push(\n            from(\n              this.storage.upload(name, cur.pushToLive, {\n                contentType: cur.pushToLive.type,\n                customMetadata: {\n                  moduleId,\n                  documentId,\n                  ...this.cData.generatedImages &&\n                  formatGeneratedImages(this.cData.generatedImages)\n                }\n              })\n            ).pipe(\n              switchMap((task: any) => task.ref.getDownloadURL()),\n              tap(url => {\n                cur.data = url;\n              })\n            )\n          );\n        } else {\n          acc.push(cur);\n        }\n\n        return acc;\n      }, [])\n    ]).pipe(\n      tap(() =>\n        this.cData.control.setValue(\n          this.cData.control.value.map((item: any) => (item.data ? item.data : item))\n        )\n      )\n    );\n  }\n}\n\nfunction __indexOf(collection: any, node: any) {\n  return Array.prototype.indexOf.call(collection, node);\n}\n\n/** Determines whether an event is a touch event. */\nfunction __isTouchEvent(event: MouseEvent | TouchEvent): event is TouchEvent {\n  return event.type.startsWith('touch');\n}\n\nfunction __isInsideDropListClientRect(dropList: CdkDropList, x: number, y: number) {\n  const {top, bottom, left, right} = dropList.element.nativeElement.getBoundingClientRect();\n  return y >= top && y <= bottom && x >= left && x <= right;\n}\n","import {ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, Inject, OnInit, ViewChild} from '@angular/core';\nimport {FormControl} from '@angular/forms';\nimport {MatSnackBar} from '@angular/material/snack-bar';\nimport {DomSanitizer, SafeResourceUrl} from '@angular/platform-browser';\nimport {TranslocoService} from '@ngneat/transloco';\nimport {from, of, throwError} from 'rxjs';\nimport {switchMap, tap} from 'rxjs/operators';\nimport {FieldComponent} from '../../field/field.component';\nimport {FormBuilderService} from '../../form-builder.service';\nimport {FieldData} from '../../interfaces/field-data.interface';\nimport {GeneratedImage} from '../../interfaces/generated-image.interface';\nimport {StorageService} from '../../services/storage.service';\nimport {COMPONENT_DATA} from '../../utils/create-component-injector';\nimport {formatFileName} from '../../utils/format-file-name';\nimport {formatGeneratedImages} from '../../utils/format-generated-images';\nimport {parseSize} from '../../utils/parse-size';\n\ninterface ImageData extends FieldData {\n  preventServerUpload?: boolean;\n  generatedImages?: GeneratedImage[];\n  allowedImageTypes?: string[];\n  forbiddenImageTypes?: string[];\n  minSize?: string | number;\n  maxSize?: string | number;\n}\n\n@Component({\n  selector: 'fb-image',\n  templateUrl: './image.component.html',\n  styleUrls: ['./image.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ImageComponent extends FieldComponent<ImageData>\n  implements OnInit {\n  constructor(\n    @Inject(COMPONENT_DATA) public cData: ImageData,\n    private storage: StorageService,\n    private cdr: ChangeDetectorRef,\n    private formBuilderService: FormBuilderService,\n    private transloco: TranslocoService,\n    private snackBar: MatSnackBar,\n    private domSanitizer: DomSanitizer\n  ) {\n    super(cData);\n  }\n\n  @ViewChild('file', {static: true})\n  fileEl: ElementRef<HTMLInputElement>;\n  value: File | null;\n  imageUrl: FormControl;\n  disInput = false;\n  imageSrc: SafeResourceUrl;\n\n  allowedImageTypes: string[];\n  forbiddenImageTypes: string[];\n  minSizeBytes: number;\n  maxSizeBytes: number;\n\n  ngOnInit() {\n    this.imageUrl = new FormControl(this.cData.control.value);\n    this.formBuilderService.saveComponents.push(this);\n\n    this.allowedImageTypes = this.cData.allowedImageTypes || [];\n    this.forbiddenImageTypes = this.cData.forbiddenImageTypes || [];\n    this.minSizeBytes = this.cData.minSize ? parseSize(this.cData.minSize) : 0;\n    this.maxSizeBytes = this.cData.maxSize ? parseSize(this.cData.maxSize) : 0;\n  }\n\n  errorSnack(message: string = 'GENERAL.ERROR', dismiss: string = 'GENERAL.DISMISS') {\n    this.snackBar.open(\n      this.transloco.translate(message),\n      this.transloco.translate(dismiss),\n      {\n        panelClass: 'snack-bar-error',\n        duration: 5000\n      }\n    );\n  }\n\n  openFileUpload() {\n    this.fileEl.nativeElement.click();\n  }\n\n  filesImage(event: Event) {\n    const el = event.target as HTMLInputElement;\n    const image = Array.from(el.files as FileList)[0] as File;\n\n    Object.defineProperty(image, 'name', {\n      writable: true,\n      value: formatFileName(image.name)\n    });\n\n    if (!this.allowedImageTypes.includes(image.type) && !!this.allowedImageTypes.length) {\n      this.errorSnack('FIELDS.GALLERY.INVALID_IMAGE_FORMAT');\n      return throwError('Invalid Image Format');\n    }\n\n    if (this.forbiddenImageTypes.includes(image.type)) {\n      this.errorSnack('FIELDS.GALLERY.FORBIDDEN_IMAGE_FORMAT');\n      return throwError('Forbidden Image Format');\n    }\n\n    if (image.size < this.minSizeBytes) {\n      this.errorSnack('FIELDS.GALLERY.BELOW_SIZE');\n      return throwError('Image below minimal allowed size');\n    }\n\n    if (image.size > this.maxSizeBytes && !!this.maxSizeBytes) {\n      this.errorSnack('FIELDS.GALLERY.EXCEED_SIZE');\n      return throwError('Image exceeding allowed size');\n    }\n\n    this.value = image;\n    this.disInput = true;\n    this.imageUrl.setValue(this.value.name);\n\n    const reader = new FileReader();\n    reader.onload = () => {\n      this.imageSrc = this.domSanitizer.bypassSecurityTrustResourceUrl(\n        reader.result as string\n      );\n      this.cdr.detectChanges();\n    };\n    reader.readAsDataURL(this.value);\n    el.value = '';\n  }\n\n  remove() {\n    this.imageUrl.setValue('');\n    this.value = null;\n    this.disInput = false;\n    this.cdr.detectChanges();\n  }\n\n  save(moduleId: string, documentId: string) {\n    if (this.value) {\n      if (this.imageUrl.value && this.imageUrl.value !== this.value.name) {\n        return of(this.imageUrl.value).pipe(\n          tap(() => this.cData.control.setValue(this.imageUrl.value))\n        );\n      } else {\n\n        const name = [\n          moduleId,\n          documentId,\n          this.value.name\n        ]\n          .join('-');\n\n        return from(\n          this.storage.upload(name, this.value, {\n            contentType: this.value.type,\n            customMetadata: {\n              moduleId,\n              documentId,\n              ...(this.cData.generatedImages &&\n                formatGeneratedImages(this.cData.generatedImages))\n            }\n          })\n        ).pipe(\n          switchMap((res: any) => res.ref.getDownloadURL()),\n          tap(url => this.cData.control.setValue(url))\n        );\n      }\n    } else {\n      this.cData.control.setValue(this.imageUrl.value);\n      return of({});\n    }\n  }\n}\n","import {ChangeDetectionStrategy, Component, OnInit} from '@angular/core';\nimport {Observable} from 'rxjs';\nimport {FieldComponent} from '../../field/field.component';\nimport {FieldData} from '../../interfaces/field-data.interface';\nimport {getHsd, HSD} from '../../utils/get-hsd';\n\ninterface InputData extends FieldData {\n  type: 'text' | 'number' | 'email';\n  autocomplete?: string;\n  suffix?: HSD;\n  prefix?: HSD;\n}\n\n@Component({\n  selector: 'fb-input',\n  templateUrl: './input.component.html',\n  styleUrls: ['./input.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class InputComponent extends FieldComponent<InputData> implements OnInit {\n\n  prefix$: Observable<string>;\n  suffix$: Observable<string>;\n\n  ngOnInit() {\n    this.prefix$ = getHsd('prefix', this.cData);\n    this.suffix$ = getHsd('suffix', this.cData);\n  }\n}\n","import {ChangeDetectionStrategy, Component} from '@angular/core';\nimport {FieldComponent} from '../../field/field.component';\nimport {FieldData} from '../../interfaces/field-data.interface';\nimport {Option} from '../../interfaces/option.interface';\n\ninterface RadioData extends FieldData {\n  options: Option[];\n}\n\n@Component({\n  selector: 'fb-radio',\n  templateUrl: './radio.component.html',\n  styleUrls: ['./radio.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class RadioComponent extends FieldComponent<RadioData> {}\n","import {ChangeDetectorRef, Component, Inject, OnInit} from '@angular/core';\nimport {FormControl, Validators} from '@angular/forms';\nimport {of} from 'rxjs';\nimport {tap} from 'rxjs/operators';\nimport {FieldComponent} from '../../field/field.component';\nimport {FormBuilderService} from '../../form-builder.service';\nimport {FieldData} from '../../interfaces/field-data.interface';\nimport {cloneAbstractControl} from '../../utils/clone-abstract-control';\nimport {COMPONENT_DATA} from '../../utils/create-component-injector';\n\ninterface RangeData extends FieldData {\n  min?: number;\n  max?: number;\n}\n\n@Component({\n  selector: 'fb-range',\n  templateUrl: './range.component.html',\n  styleUrls: ['./range.component.css']\n})\nexport class RangeComponent extends FieldComponent<RangeData> implements OnInit {\n\n  entryControl: FormControl;\n  start: FormControl;\n  end: FormControl;\n  min: Date;\n  max: Date;\n\n  constructor(\n    @Inject(COMPONENT_DATA) public cData: RangeData,\n    private cdr: ChangeDetectorRef,\n    private formBuilderService: FormBuilderService\n  ) {\n    super(cData);\n  }\n\n  ngOnInit(): void {\n    this.formBuilderService.saveComponents.push(this);\n\n    this.min = new Date(this.cData.min || 0);\n    this.max = new Date(this.cData.max || Date.now() * 2);\n    this.entryControl = cloneAbstractControl(this.cData.control);\n\n    this.start = new FormControl(\n      {value: this.entryControl.value.start || '', disabled: this.cData.control.disabled},\n      [Validators.min(this.cData.min || 0)]\n    );\n\n    this.end = new FormControl(\n      {value: this.entryControl.value.end || '', disabled: this.cData.control.disabled},\n      [Validators.max(this.cData.max || Date.now() * 2)]\n    );\n  }\n\n  save() {\n    return of({}).pipe(\n      tap(() => {\n        const start = this.start.value;\n        const end = this.end.value;\n        this.cData.control.setValue({start, end});\n      })\n    );\n  }\n}\n","import {InjectionToken} from '@angular/core';\n\nexport const ADDITIONAL_CONTEXT = new InjectionToken<{}>('ADDITIONAL_CONTEXT');\n","export function parseTemplate(\n  value = '',\n  obj: any = {}\n) {\n\n  if (!value.includes('{{')) {\n    return obj[value];\n  } else {\n\n    const lookUp = new RegExp(`{{(.*?)}}`);\n\n    while (lookUp.test(value)) {\n      value = value.replace(\n        lookUp,\n        (RegExp.$1)\n          .split('.')\n          .reduce((acc, cur) =>\n              acc[cur],\n            obj\n          )\n      );\n    }\n\n    return value;\n  }\n}\n","import {InjectionToken} from '@angular/core';\n\nexport const ROLE = new InjectionToken<{}>('ROLE');\n","import {ChangeDetectionStrategy, Component, Inject, OnInit, Optional} from '@angular/core';\nimport {BehaviorSubject, Observable, of} from 'rxjs';\nimport {map, startWith, switchMap, tap} from 'rxjs/operators';\nimport {FieldComponent} from '../../field/field.component';\nimport {FieldData} from '../../interfaces/field-data.interface';\nimport {Option} from '../../interfaces/option.interface';\nimport {WhereFilter} from '../../interfaces/where-filter.interface';\nimport {DbService} from '../../services/db.service';\nimport {ADDITIONAL_CONTEXT} from '../../utils/additional-context';\nimport {COMPONENT_DATA} from '../../utils/create-component-injector';\nimport {parseTemplate} from '../../utils/parse-template';\nimport {ROLE} from '../../utils/role';\nimport {safeEval} from '../../utils/safe-eval';\n\ninterface Populate {\n  collection?: string;\n  nameKey?: string;\n  valueKey?: string;\n  orderBy?: string;\n\n  /**\n   * A method for mapping all of the results\n   * (items: T[]) => any[]\n   */\n  mapResults?: string;\n\n  /**\n   * If a filter is a string\n   * it represents the id of the document\n   */\n  filter?: WhereFilter | string;\n\n  /**\n   * A stringified function that receives\n   * an object with {fieldData: SelectData, value: form.getRawValue(), role: string, additionalContext?: any}\n   * and should return a WhereFilter.\n   * This doesn't work in combination with the dependency property\n   */\n  dynamicFilter?: string;\n\n  /**\n   * Use this property if the field depends on changes\n   * of a different field in the form\n   */\n  dependency?: {\n    key: string;\n\n    /**\n     * A method for defining query dynamically\n     * (value) => {collection: string; orderBy: string; filter: WhereFilter | string}\n     */\n    method: string;\n  };\n}\n\ninterface SelectData extends FieldData {\n  dataSet?: Option[];\n  multiple?: boolean;\n  populate?: Populate;\n  autocomplete?: string;\n}\n\n@Component({\n  selector: 'fb-select',\n  templateUrl: './select.component.html',\n  styleUrls: ['./select.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SelectComponent extends FieldComponent<SelectData>\n  implements OnInit {\n  dataSet$: Observable<Option[]>;\n  loading$ = new BehaviorSubject(true);\n\n  constructor(\n    @Inject(COMPONENT_DATA) public cData: SelectData,\n    private dbService: DbService,\n    @Inject(ROLE)\n    private role: string,\n    @Optional()\n    @Inject(ADDITIONAL_CONTEXT)\n    private additionalContext: any\n  ) {\n    super(cData);\n  }\n\n  ngOnInit() {\n    if (this.cData.populate) {\n\n      const populate = this.cData.populate as Populate;\n\n      const mapResults = populate.mapResults ? safeEval(populate.mapResults) : null;\n      const documentsMethod = (\n        query?: {\n          collection: string,\n          orderBy: string,\n          filter: WhereFilter | string\n        }\n      ) => {\n\n        this.loading$.next(true);\n\n        if (!query) {\n          this.loading$.next(false);\n          return of([]);\n        }\n\n        if (query.filter && typeof query.filter === 'string') {\n          return this.dbService.getDocument(\n            query.collection,\n            query.filter\n          )\n            .pipe(\n              map(it => {\n                return (mapResults ? mapResults(it) : [it]).map((doc: any) => ({\n                  value: doc[populate.valueKey || 'id'],\n                  name: parseTemplate(\n                    populate.nameKey || 'name',\n                    doc\n                  )\n                }));\n              }),\n              tap(() => this.loading$.next(false))\n            );\n        }\n\n        return this.dbService\n          .getDocumentsSimple(\n            query.collection,\n            query.orderBy,\n            query.filter as WhereFilter\n          )\n          .pipe(\n            map(docs => {\n              if (mapResults) {\n                docs = mapResults(docs, {\n                  fieldData: this.cData,\n                  value: this.cData.form.getRawValue(),\n                  role: this.role,\n                  additionalContext: this.additionalContext\n                });\n              }\n\n              return docs.map(doc => ({\n                value: doc[populate.valueKey || 'id'],\n                name: parseTemplate(\n                  populate.nameKey || 'name',\n                  doc\n                )\n              }));\n            }),\n            tap(() => this.loading$.next(false))\n          );\n      };\n\n      if (populate.dependency) {\n\n        const pointer = this.cData.pointers[populate.dependency.key];\n        const gm = safeEval(populate.dependency.method);\n\n        this.dataSet$ = pointer.control.valueChanges\n          .pipe(\n            startWith(\n              pointer.control.value\n            ),\n            switchMap(value =>\n              documentsMethod(\n                gm(value, {\n                  fieldData: this.cData,\n                  value: this.cData.form.getRawValue(),\n                  role: this.role,\n                  additionalContext: this.additionalContext\n                })\n              )\n            )\n          );\n      } else {\n\n        let filter: WhereFilter = populate.filter as WhereFilter;\n\n        if (populate.dynamicFilter) {\n          filter = safeEval(populate.dynamicFilter)({\n            fieldData: this.cData,\n            value: this.cData.form.getRawValue(),\n            role: this.role,\n            additionalContext: this.additionalContext\n          });\n        }\n\n        this.dataSet$ = documentsMethod({\n          collection: populate.collection,\n          orderBy: populate.orderBy,\n          filter\n        } as any);\n      }\n    } else {\n      this.dataSet$ = of(this.cData.dataSet as any);\n    }\n  }\n}\n","import {ChangeDetectionStrategy, Component, OnInit} from '@angular/core';\nimport {FieldComponent} from '../../field/field.component';\nimport {FieldData} from '../../interfaces/field-data.interface';\n\ninterface SliderData extends FieldData {\n  validation: {\n    minimum: number;\n    maximum: number;\n  };\n  thumbLabel: boolean;\n  tickInterval: number;\n  starAt: number;\n  endAt: number;\n}\n\n@Component({\n  selector: 'fb-slider',\n  templateUrl: './slider.component.html',\n  styleUrls: ['./slider.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SliderComponent extends FieldComponent<SliderData>\n  implements OnInit {\n  startAt: number;\n  endAt: number;\n\n  ngOnInit() {\n    this.startAt = this.cData.starAt\n      ? this.cData.starAt\n      : this.cData.validation.minimum\n      ? this.cData.validation.minimum\n      : 0;\n    this.endAt = this.cData.endAt\n      ? this.cData.endAt\n      : this.cData.validation.maximum\n      ? this.cData.validation.maximum\n      : 100;\n  }\n}\n","import {Component, ChangeDetectionStrategy, OnInit} from '@angular/core';\nimport {Observable} from 'rxjs';\nimport {FieldComponent} from '../../field/field.component';\nimport {FieldData} from '../../interfaces/field-data.interface';\nimport {getHsd, HSD} from '../../utils/get-hsd';\n\ninterface TextareaData extends FieldData {\n  rows?: number;\n  cols?: number;\n  autocomplete?: string;\n  suffix?: HSD;\n  prefix?: HSD;\n}\n\n@Component({\n  selector: 'fb-textarea',\n  templateUrl: './textarea.component.html',\n  styleUrls: ['./textarea.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TextareaComponent extends FieldComponent<TextareaData> implements OnInit {\n\n  prefix$: Observable<string>;\n  suffix$: Observable<string>;\n\n  ngOnInit() {\n    this.prefix$ = getHsd('prefix', this.cData);\n    this.suffix$ = getHsd('suffix', this.cData);\n  }\n}\n","import {ChangeDetectionStrategy, Component} from '@angular/core';\nimport {FieldComponent} from '../../field/field.component';\nimport {FieldData} from '../../interfaces/field-data.interface';\n\n@Component({\n  selector: 'fb-toggle',\n  templateUrl: './toggle.component.html',\n  styleUrls: ['./toggle.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ToggleComponent extends FieldComponent<FieldData> {}\n","import {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  Component,\n  ElementRef,\n  Inject,\n  OnInit,\n  TemplateRef,\n  ViewChild\n} from '@angular/core';\nimport {FormBuilder, FormGroup, Validators} from '@angular/forms';\nimport {MatDialog} from '@angular/material/dialog';\nimport {filter, take} from 'rxjs/operators';\nimport {FieldComponent} from '../../field/field.component';\nimport 'tinymce/plugins/code';\nimport 'tinymce/plugins/print';\nimport 'tinymce/plugins/wordcount';\nimport 'tinymce/plugins/link';\nimport 'tinymce/plugins/image';\nimport 'tinymce/plugins/imagetools';\nimport 'tinymce/plugins/fullscreen';\nimport 'tinymce/plugins/lists';\nimport 'tinymce/plugins/autolink';\nimport 'tinymce/plugins/advlist';\nimport 'tinymce/plugins/table';\nimport {FormBuilderComponent} from '../../form-builder.component';\nimport {FieldData} from '../../interfaces/field-data.interface';\nimport {StorageService} from '../../services/storage.service';\nimport {COMPONENT_DATA} from '../../utils/create-component-injector';\n\ndeclare const tinymce: any;\n\nexport interface WysiwygData extends FieldData {\n  menubar?: string;\n  toolbar?: string;\n  height?: number;\n}\n\n@Component({\n  selector: 'fb-wysiwyg',\n  templateUrl: './wysiwyg.component.html',\n  styleUrls: ['./wysiwyg.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WysiwygComponent extends FieldComponent<WysiwygData>\n  implements OnInit, AfterViewInit {\n  constructor(\n    @Inject(COMPONENT_DATA) public cData: WysiwygData,\n    private fb: FormBuilder,\n    private dialog: MatDialog,\n    private storage: StorageService,\n    private formBuilderComponent: FormBuilderComponent\n  ) {\n    super(cData);\n  }\n\n  @ViewChild('textarea', {static: true})\n  textarea: ElementRef;\n\n  @ViewChild('youTubeDialog', {static: true})\n  youTubeDialogTemplate: TemplateRef<any>;\n\n  editor: any;\n  ytForm: FormGroup;\n  ytDefault = {\n    fullWidth: true,\n    showPlayerControls: true,\n    privacyEnhancedMode: false,\n    align: 'left'\n  };\n\n  ngOnInit() {\n    this.ytForm = this.fb.group({\n      value: ['', Validators.required],\n      ...this.ytDefault\n    });\n\n    this.cData.control.statusChanges.subscribe(value => {\n      if (value === 'DISABLED') {\n        tinymce.activeEditor.getBody().setAttribute('readonly', true);\n      } else if (this.cData.control.disabled) {\n        tinymce.activeEditor.getBody().setAttribute('readonly', false);\n      }\n    });\n  }\n\n  ngAfterViewInit() {\n    this.registerTiny();\n  }\n\n  private registerTiny() {\n    tinymce.init({\n      target: this.textarea.nativeElement,\n      branding: false,\n      height: this.cData.height || 420,\n      plugins: [\n        'code',\n        'print',\n        'wordcount',\n        'link',\n        'lists',\n        'advlist',\n        'autolink',\n        'image',\n        'imagetools',\n        'fullscreen',\n        'table'\n      ],\n      menubar: this.cData.menubar || 'edit insert view format table tools help',\n      image_advtab: true,\n\n      /**\n       * Link settings\n       */\n      default_link_target: '_blank',\n      readonly: this.cData.control.disabled,\n      toolbar: this.cData.toolbar || [\n        'undo redo',\n        'insert',\n        'styleselect',\n        'bold italic',\n        'forecolor backcolor',\n        'alignleft aligncenter alignright alignjustify',\n        'bullist numlist outdent indent',\n        'link',\n        'image',\n        'youTube',\n        'fullscreen',\n      ].join(' | '),\n\n      images_upload_handler: (blobInfo: any, success: any, failure: any) => {\n        this.storage\n          .upload(\n            blobInfo.filename(),\n            blobInfo.blob(),\n            this.formBuilderComponent.id ? {\n              customMetadata: {\n                collection: this.formBuilderComponent.id\n              }\n            } : {}\n          )\n          .then((data: any) => data.ref.getDownloadURL())\n          .then((url: any) => success(url))\n          .catch((error: any) => failure(error.toString()));\n      },\n\n      setup: (editor: any) => {\n        this.editor = editor;\n\n        editor.on('keyup change', () => {\n          const tinyContent = editor.getContent();\n          this.cData.control.setValue(tinyContent);\n        });\n\n        editor.ui.registry.addButton('youTube', {\n          type: 'button',\n          icon: 'embed',\n          tooltip: 'Embed youtube video',\n          onAction: () => {\n            this.ytForm.reset(this.ytDefault);\n            this.dialog\n              .open(this.youTubeDialogTemplate, {width: '500px'})\n              .afterClosed()\n              .pipe(\n                filter(value => !!value),\n                take(1)\n              )\n              .subscribe(() => {\n                const data = this.ytForm.getRawValue();\n                let url = data.privacyEnhancedMode\n                  ? 'https://www.youtube-nocookie.com/embed/'\n                  : 'https://www.youtube.com/embed/';\n\n                url = url + data.value;\n\n                if (!data.showPlayerControls) {\n                  data.value += '?controls=0';\n                }\n\n                const iframe = `<iframe width=\"560\" height=\"315\" src=\"${url}\" frameborder=\"0\"\n                    allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>`;\n\n                editor.insertContent(\n                  data.fullWidth\n                    ? `<div class=\"evw-full\" style=\"text-align: ${data.align}\">${iframe}</div>`\n                    : `<div style=\"text-align: ${data.align}\">${iframe}</div>`\n                );\n              });\n          }\n        });\n      }\n    });\n  }\n}\n","import {ComponentType} from '../enums/component-type.enum';\nimport {AutocompleteComponent} from '../fields/autocomplete/autocomplete.component';\nimport {CheckboxComponent} from '../fields/checkbox/checkbox.component';\nimport {ChipsComponent} from '../fields/chips/chips.component';\nimport {DateFieldComponent} from '../fields/date-field/date-field.component';\nimport {DraggableListComponent} from '../fields/draggable-list/draggable-list.component';\nimport {FileComponent} from '../fields/file/file.component';\nimport {GalleryComponent} from '../fields/gallery/gallery.component';\nimport {ImageComponent} from '../fields/image/image.component';\nimport {InputComponent} from '../fields/input/input.component';\nimport {RadioComponent} from '../fields/radio/radio.component';\nimport {RangeComponent} from '../fields/range/range.component';\nimport {SelectComponent} from '../fields/select/select.component';\nimport {SliderComponent} from '../fields/slider/slider.component';\nimport {TextareaComponent} from '../fields/textarea/textarea.component';\nimport {ToggleComponent} from '../fields/toggle/toggle.component';\nimport {WysiwygComponent} from '../fields/wysiwyg/wysiwyg.component';\n\n\nexport const COMPONENT_TYPE_COMPONENT_MAP = {\n  [ComponentType.Input]: InputComponent,\n  [ComponentType.Toggle]: ToggleComponent,\n  [ComponentType.Select]: SelectComponent,\n  [ComponentType.File]: FileComponent,\n  [ComponentType.Image]: ImageComponent,\n  [ComponentType.Gallery]: GalleryComponent,\n  [ComponentType.Checkbox]: CheckboxComponent,\n  [ComponentType.Autocomplete]: AutocompleteComponent,\n  [ComponentType.Date]: DateFieldComponent,\n  [ComponentType.Range]: RangeComponent,\n  [ComponentType.Slider]: SliderComponent,\n  [ComponentType.Wysiwyg]: WysiwygComponent,\n  [ComponentType.Draggable]: DraggableListComponent,\n  [ComponentType.Radio]: RadioComponent,\n  [ComponentType.Chips]: ChipsComponent,\n  [ComponentType.Textarea]: TextareaComponent\n};\n","export enum SchemaType {\n  Object = 'object',\n  Array = 'array',\n\n  // Simple\n  String = 'string',\n  Number = 'number',\n  Integer = 'integer',\n  Boolean = 'boolean',\n  Null = 'null'\n}\n","import {AbstractControl} from '@angular/forms';\n\n// @dynamic\nexport class SchemaValidators {\n  static multipleOf(num: number) {\n    return (control: AbstractControl) => {\n      return control.value % num === 0 ? null : {multipleOf: num};\n    };\n  }\n}\n","import {ComponentType} from '../enums/component-type.enum';\nimport {SchemaType} from '../enums/schema-type.enum';\n\nexport function schemaToComponent(schemaType: SchemaType) {\n  switch (schemaType) {\n    case SchemaType.String:\n      return {\n        type: ComponentType.Input,\n        configuration: {\n          type: 'text'\n        }\n      };\n\n    case SchemaType.Number:\n    case SchemaType.Integer:\n      return {\n        type: ComponentType.Input,\n        configuration: {\n          type: 'number'\n        }\n      };\n\n    case SchemaType.Boolean:\n      return {\n        type: ComponentType.Checkbox\n      };\n\n    case SchemaType.Array:\n      return {\n        type: ComponentType.Chips\n      };\n  }\n}\n","import {moveItemInArray} from '@angular/cdk/drag-drop';\nimport {ComponentPortal} from '@angular/cdk/portal';\nimport {Injector} from '@angular/core';\nimport {FormArray, FormControl, FormGroup, Validators} from '@angular/forms';\nimport {COMPONENT_TYPE_COMPONENT_MAP} from '../consts/component-type-component-map.const';\nimport {SchemaType} from '../enums/schema-type.enum';\nimport {State} from '../enums/state.enum';\nimport {FieldComponent} from '../field/field.component';\nimport {CompiledField} from '../interfaces/compiled-field.interface';\nimport {Control} from '../interfaces/control.type';\nimport {Definitions} from '../interfaces/definitions.interface';\nimport {SchemaValidators} from '../validators/schema-validators.class';\nimport {createComponentInjector} from './create-component-injector';\nimport {CustomFields} from './custom-fields';\nimport {safeEval} from './safe-eval';\nimport {schemaToComponent} from './schema-to-component';\n\nexport interface PropertyDefinition {\n  type: SchemaType;\n  description?: string;\n  default?: any;\n}\n\nexport interface StringPropertyDefinition extends PropertyDefinition {\n  type: SchemaType.String;\n  default?: string;\n\n  pattern?: string;\n  minLength?: number;\n  maxLength?: number;\n}\n\nexport interface NumberPropertyDefinition extends PropertyDefinition {\n  type: SchemaType.Number | SchemaType.Integer;\n  default?: number;\n\n  minimum?: number;\n  maximum?: number;\n  exclusiveMinimum?: boolean;\n  exclusiveMaximum?: boolean;\n  multipleOf?: number;\n}\n\nexport interface BooleanPropertyDefinition extends PropertyDefinition {\n  type: SchemaType.Boolean;\n  default?: boolean;\n}\n\nexport interface ArrayPropertyDefinition extends PropertyDefinition {\n  type: SchemaType.Array;\n  items?: any;\n  contains?: any;\n}\n\nexport interface Pointer {\n  key: string;\n  type: SchemaType;\n  control: Control;\n  validation: any;\n\n  formatOnSave?: (item: any, dataSet?: any) => any;\n  formatOnLoad?: (item: any) => any;\n  formatOnCreate?: (item: any, dataSet?: any) => any;\n  formatOnEdit?: (item: any, dataSet?: any) => any;\n\n  /**\n   * Arrays can have these properties\n   */\n  arrayType?: SchemaType;\n  properties?: any;\n  required?: string[];\n  arrayPointers?: Pointers[];\n}\n\nexport interface Pointers {\n  [key: string]: Pointer;\n}\n\n// @dynamic\nexport class Parser {\n  constructor(\n    public schema: any,\n    public injector: Injector,\n    public state: State,\n    public role: string,\n    public definitions: Definitions = {},\n    public customFields: CustomFields = {}\n  ) {}\n\n  form: FormGroup;\n  pointers: Pointers = {};\n\n  static standardizeKey(key: string) {\n    if (key[0] === '/') {\n      key = key.slice(1, key.length);\n    }\n\n    return key;\n  }\n\n  static stringControl(\n    definition: StringPropertyDefinition,\n    required: boolean\n  ) {\n    const controlValidation: any[] = [];\n    const validation: any = {};\n\n    if (required) {\n      controlValidation.push(Validators.required);\n      validation.required = true;\n    }\n\n    if (definition.maxLength) {\n      controlValidation.push(Validators.maxLength(definition.maxLength));\n      validation.maxLength = definition.maxLength;\n    }\n\n    if (definition.minLength) {\n      controlValidation.push(Validators.minLength(definition.minLength));\n      validation.minLength = definition.minLength;\n    }\n\n    if (definition.pattern) {\n      controlValidation.push(Validators.pattern(definition.pattern));\n      validation.patter = definition.pattern;\n    }\n\n    return {\n      control: new FormControl(definition.default || '', controlValidation),\n      validation\n    };\n  }\n\n  static numberControl(\n    definition: NumberPropertyDefinition,\n    required: boolean\n  ) {\n    const validation: any = {};\n    const controlValidation: any[] = [];\n\n    if (required) {\n      controlValidation.push(Validators.required);\n      validation.required = true;\n    }\n\n    if (definition.minimum) {\n      const minimum =\n        definition.minimum + (definition.exclusiveMinimum ? 1 : 0);\n      controlValidation.push(Validators.min(minimum));\n      validation.minimum = minimum;\n    }\n\n    if (definition.maximum) {\n      const maximum =\n        definition.maximum - (definition.exclusiveMaximum ? 1 : 0);\n      controlValidation.push(Validators.max(maximum));\n      validation.maximum = maximum;\n    }\n\n    if (definition.multipleOf) {\n      controlValidation.push(\n        SchemaValidators.multipleOf(definition.multipleOf)\n      );\n      validation.multipleOf = definition.multipleOf;\n    }\n\n    return {\n      control: new FormControl(definition.default || null, controlValidation),\n      validation\n    };\n  }\n\n  static booleanControl(\n    definition: BooleanPropertyDefinition,\n    required: boolean\n  ) {\n    const controlValidation: any[] = [];\n    const validation: any = {};\n\n    if (required) {\n      controlValidation.push(Validators.required);\n      validation.required = true;\n    }\n\n    return {\n      control: new FormControl(definition.default || false, controlValidation),\n      validation\n    };\n  }\n\n  buildForm(\n    value?: any,\n    required: string[] = [],\n    base = '/',\n    addId = true\n  ) {\n    const properties = this.buildProperties(\n      this.schema.properties || {},\n      required,\n      base,\n      addId\n    );\n\n    this.form = properties.form;\n    this.pointers = properties.pointers;\n\n    if (value) {\n      this.form.patchValue(value);\n    }\n\n    return this.form;\n  }\n\n  buildProperties(\n    properties: object,\n    required: string[] = [],\n    base = '/',\n    addId = true\n  ) {\n    const {form, pointers} = [\n      ...Object.entries(properties),\n      /**\n       * Add the id field as a property so that\n       * it can be added to the form if needed\n       */\n      ...(addId\n        ? [\n            [\n              'id',\n              {\n                type: 'string'\n              }\n            ]\n          ]\n        : [])\n    ].reduce(\n      (group, [key, value]: [string, any]) => {\n        const isRequired = required.includes(key);\n\n        let parsed: {\n          control: any;\n          validation: any;\n          arrayType?: SchemaType;\n          properties?: any;\n          required?: string[];\n        };\n\n        switch (value.type) {\n          case SchemaType.String:\n            parsed = Parser.stringControl(value, isRequired);\n            break;\n\n          case SchemaType.Number:\n          case SchemaType.Integer:\n            parsed = Parser.numberControl(value, isRequired);\n            break;\n\n          case SchemaType.Boolean:\n            parsed = Parser.booleanControl(value, isRequired);\n            break;\n\n          case SchemaType.Object:\n            const objectProperties = this.buildProperties(\n              /**\n               * Supporting both {type: 'object', properties: {}} and\n               * {type: 'object', items: {properties: {}}}\n               */\n              value.properties || (value.items && value.items.properties ? value.items.properties : {}),\n              value.required || value.items && value.items.required ? value.items.required : [],\n              base + key + '/',\n              false\n            );\n\n            for (const added in objectProperties.pointers) {\n              if (objectProperties.pointers.hasOwnProperty(added)) {\n                // @ts-ignore\n                group.pointers[added] = objectProperties.pointers[added];\n              }\n            }\n\n            parsed = {\n              control: objectProperties.form,\n              validation: {}\n            };\n            break;\n\n          case SchemaType.Array:\n            parsed = this.buildArray(base, value);\n            break;\n        }\n\n        const pointerKey = base + key;\n        const definition = this.getFromDefinitions(pointerKey) || {};\n\n        // @ts-ignore\n        group.form[key] = parsed.control;\n        // @ts-ignore\n        group.pointers[pointerKey] = {\n          key,\n          type: value.type,\n          ...definition.formatOnLoad\n            && {formatOnLoad: safeEval(definition.formatOnLoad)},\n          ...definition.formatOnSave\n            && {formatOnSave: safeEval(definition.formatOnSave)},\n          ...definition.formatOnCreate\n            && {formatOnCreate: safeEval(definition.formatOnCreate)},\n          ...definition.formatOnEdit\n            && {formatOnEdit: safeEval(definition.formatOnEdit)},\n          // @ts-ignore\n          ...parsed\n        };\n\n        return group;\n      },\n      {\n        form: {},\n        pointers: {}\n      }\n    );\n\n    return {\n      pointers,\n      form: new FormGroup(form)\n    };\n  }\n\n  /**\n   * @param pointerKey Lookup key for the pointer\n   * @param pointer Entire pointer object that should be used\n   * @param definitions Entire definitions object that should be used\n   * @param single Defines if the field shown in the form or in the table\n   * @param arrayRoot If the field is in an array what root lookup to use\n   */\n  field(\n    pointerKey: string,\n    pointer: Pointer,\n    definitions: Definitions = {},\n    single = true,\n    arrayRoot?: string\n  ): CompiledField {\n\n    if (!pointer) {\n      console.log('Pointers: ', this.pointers);\n      throw new Error(`Couldn't find pointer for ${pointerKey}.`);\n    }\n\n    const {key, type, control, validation} = pointer;\n    const definition = {\n      label: key,\n      ...this.getFromDefinitions(pointerKey, definitions)\n    };\n\n    if (\n      (\n        definition.disableOn &&\n        (\n          Array.isArray(definition.disableOn) ?\n            definition.disableOn.includes(this.state)\n            : definition.disableOn === this.state\n        )\n      ) ||\n      (\n        definition.disableForRoles &&\n        (\n          Array.isArray(definition.disableForRoles) ?\n            definition.disableForRoles.includes(this.role)\n            : definition.disableForRoles === this.role\n        )\n      )\n    ) {\n      control.disable();\n    }\n\n    /**\n     * We don't show labels in the table\n     */\n    if (!single) {\n      definition.label = '';\n    }\n\n    if (!definition.component) {\n      definition.component = schemaToComponent(type);\n    }\n\n    // @ts-ignore\n    const component = COMPONENT_TYPE_COMPONENT_MAP[definition.component.type] || this.customFields[definition.component.type];\n\n    if (!component) {\n      // @ts-ignore\n      throw new Error(`Couldn't find a component defined for type: ${definition.component.type}`);\n    }\n\n    const portal = new ComponentPortal<FieldComponent<any>>(\n      component,\n      null,\n      createComponentInjector(this.injector, {\n        control,\n        validation,\n        single,\n        pointers: this.pointers,\n        form: this.form,\n        ...definition,\n        // @ts-ignore\n        ...(definition.component.configuration || {})\n      })\n    );\n\n    return {\n      pointer: pointerKey,\n      control,\n      portal,\n      validation,\n      placeholder: definition.placeholder || '',\n      label: definition.label,\n      onlyOn: definition.onlyOn\n    };\n  }\n\n  addArrayItem(\n    pointer: string,\n    loadHooks = false,\n    parentArray?: {\n      index: number,\n      pointer: string\n    }\n  ) {\n    const pointers = parentArray ? (this.pointers[parentArray.pointer] as any).arrayPointers[parentArray.index] : this.pointers;\n    const target = pointers[pointer];\n    const control = pointers[pointer].control as FormArray;\n\n    if (\n      target.arrayType === SchemaType.Array ||\n      target.arrayType === SchemaType.Object\n    ) {\n      const properties = this.buildProperties(\n        target.properties,\n        target.required,\n        pointer + '/',\n        false\n      );\n\n      if (loadHooks) {\n        this.loadHooks(properties.pointers);\n      }\n      // @ts-ignore\n      target.arrayPointers.unshift(properties.pointers);\n      control.controls.unshift(properties.form);\n\n      return properties.pointers;\n    } else {\n      const cont = new FormControl('');\n      control.controls.unshift(cont);\n      return cont;\n    }\n  }\n\n  moveArrayItem(\n    pointer: string,\n    fromIndex: number,\n    toIndex: number,\n    parentArray?: {\n      index: number,\n      pointer: string\n    }\n  ) {\n    const pointers = parentArray ? (this.pointers[parentArray.pointer] as any).arrayPointers[parentArray.index] : this.pointers;\n    const target = pointers[pointer];\n    const control = pointers[pointer].control as FormArray;\n\n    if (\n      target.arrayType === SchemaType.Array ||\n      target.arrayType === SchemaType.Object\n    ) {\n      moveItemInArray(\n        target.arrayPointers as any[],\n        fromIndex,\n        toIndex\n      );\n    }\n\n    moveItemInArray(\n      control.controls,\n      fromIndex,\n      toIndex\n    );\n  }\n\n  removeArrayItem(\n    pointer: string,\n    index: number,\n    parentArray?: {\n      index: number,\n      pointer: string\n    }\n  ) {\n    const pointers = parentArray ? (this.pointers[parentArray.pointer] as any).arrayPointers[parentArray.index] : this.pointers;\n    pointers[pointer].arrayPointers.splice(index, 1);\n    (pointers[pointer].control as FormArray).removeAt(index);\n  }\n\n  loadHooks(pointers = this.pointers) {\n    Object.values(pointers).forEach(entry => {\n      /**\n       * TODO:\n       * For the moment formatOn methods are\n       * only supported on FormControls.\n       * We might want to expand on this later on.\n       */\n      if (entry.control instanceof FormControl && entry.formatOnLoad) {\n        const adjustedValue = entry.formatOnLoad(entry.control.value);\n\n        if (adjustedValue !== entry.control.value) {\n          entry.control.setValue(adjustedValue);\n        }\n      }\n    });\n  }\n\n  preSaveHooks(\n    currentState: State,\n    statesToProcess = [State.Create, State.Edit],\n    pointers = this.pointers\n  ) {\n\n    const preSaveData = this.form.getRawValue();\n\n    Object.values(pointers).forEach(entry => {\n      /**\n       * TODO:\n       * For the moment formatOn methods are\n       * only supported on FormControls.\n       * We might want to expand on this later on.\n       */\n      if (entry.control instanceof FormControl) {\n        let value = entry.control.value;\n\n        if (entry.formatOnSave) {\n          value = entry.formatOnSave(value, preSaveData);\n        }\n\n        if (statesToProcess.includes(currentState)) {\n          if (currentState === State.Edit && entry.formatOnEdit) {\n            value = entry.formatOnEdit(value, preSaveData);\n          } else if (entry.formatOnCreate) {\n            value = entry.formatOnCreate(value, preSaveData);\n          }\n        }\n\n        if (value !== entry.control.value) {\n          entry.control.setValue(value);\n        }\n      }\n\n      if (entry.arrayPointers) {\n        entry.arrayPointers.forEach(arrayPointers =>\n          this.preSaveHooks(currentState, statesToProcess, arrayPointers)\n        );\n      }\n    });\n  }\n\n  getFromDefinitions(\n    key: string,\n    definitions: Definitions = this.definitions\n  ) {\n    return definitions[Parser.standardizeKey(key)];\n  }\n\n  /**\n   * TODO:\n   * - Handle contains case\n   * - Handle items or contains as array not object\n   */\n  private buildArray(base: string, definition: ArrayPropertyDefinition) {\n    if (!definition.items) {\n      return {\n        control: new FormControl([]),\n        ...(definition.items\n          ? {\n              arrayType: definition.items.type,\n              properties: definition.items.properties,\n              required: definition.items.required,\n              validation: {}\n            }\n          : {\n              arrayType: SchemaType.String,\n              validation: {}\n            })\n      };\n    } else {\n      return {\n        arrayType: definition.items.type,\n        properties: definition.items.properties,\n        required: definition.items.required,\n        validation: {},\n        control: new FormArray([]),\n        arrayPointers: []\n      };\n    }\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Inject,\n  Injector,\n  Input,\n  OnChanges,\n  OnDestroy,\n  Optional,\n  Output,\n  SimpleChanges\n} from '@angular/core';\nimport {FormGroup} from '@angular/forms';\nimport {forkJoin, of, Subscription} from 'rxjs';\nimport {SegmentType} from './enums/segment-type.enum';\nimport {State} from './enums/state.enum';\nimport {FormBuilderService} from './form-builder.service';\nimport {CompiledSegment} from './interfaces/compiled-segment.interface';\nimport {FormBuilderData} from './interfaces/form-builder-data.interface';\nimport {CUSTOM_FIELDS, CustomFields} from './utils/custom-fields';\nimport {filterAndCompileSegments} from './utils/filter-and-compile-segments';\nimport {Parser} from './utils/parser';\nimport {ROLE} from './utils/role';\n\n@Component({\n  selector: 'fb-form-builder',\n  templateUrl: './form-builder.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [FormBuilderService]\n})\nexport class FormBuilderComponent implements OnChanges, OnDestroy {\n  constructor(\n    private injector: Injector,\n    @Optional()\n    @Inject(ROLE)\n    private role: string,\n    @Optional()\n    @Inject(CUSTOM_FIELDS)\n    private customFields: CustomFields,\n    private cdr: ChangeDetectorRef,\n    private service: FormBuilderService\n  ) { }\n\n  @Input()\n  data: FormBuilderData;\n\n  @Input()\n  value: any;\n\n  @Input()\n  id: string;\n\n  @Output()\n  valueChanges = new EventEmitter<any>();\n\n  @Output()\n  validityChanges = new EventEmitter<boolean>();\n\n  form: FormGroup;\n  parser: Parser;\n  segments: CompiledSegment[];\n\n  @Input()\n  state: State = State.Create;\n\n  private changeSubscription: Subscription;\n  private statusSubscription: Subscription;\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data) {\n      this.render();\n    }\n\n    if (changes.value && this.form) {\n      this.form.patchValue(changes.value.currentValue);\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.changeSubscription) {\n      this.changeSubscription.unsubscribe();\n    }\n\n    if (this.statusSubscription) {\n      this.statusSubscription.unsubscribe();\n    }\n  }\n\n  process() {\n    this.parser.preSaveHooks(\n      this.state\n    );\n\n    return this.form.getRawValue();\n  }\n\n  save(\n    collectionId: string,\n    documentId: string\n  ) {\n\n    const toExec = this.service.saveComponents.map(comp =>\n      comp.save(collectionId, documentId)\n    );\n\n    return toExec.length ? forkJoin(toExec) : of({});\n  }\n\n  saveAndProcess(\n    collectionId: string,\n    documentId: string\n  ) {\n    this.process();\n\n    return this.save(\n      collectionId,\n      documentId\n    );\n  }\n\n  private render() {\n    const value = this.data.value || {};\n    const definitions = this.data.definitions || {};\n\n    this.parser = new Parser(\n      this.data.schema,\n      this.injector,\n      this.state,\n      this.role,\n      definitions,\n      this.customFields\n    );\n\n    this.form = this.parser.buildForm(\n      value,\n      [],\n      '/',\n      false\n    );\n\n    this.parser.loadHooks();\n\n    this.segments = filterAndCompileSegments(\n      this.data.segments ||\n      [{\n        title: '',\n        fields: Object.keys(this.parser.pointers),\n        columnsDesktop: 12,\n        type: SegmentType.Empty\n      }],\n      this.parser,\n      definitions,\n      this.injector,\n      value\n    );\n\n    if (this.changeSubscription) {\n      this.changeSubscription.unsubscribe();\n    }\n\n    if (this.statusSubscription) {\n      this.statusSubscription.unsubscribe();\n    }\n\n    this.changeSubscription = this.form.valueChanges\n      .subscribe(val => {\n        this.valueChanges.emit(val);\n      });\n\n    this.statusSubscription = this.form.statusChanges\n      .subscribe(val => {\n        this.validityChanges.emit(val === 'VALID');\n      });\n\n    this.cdr.markForCheck();\n  }\n}\n","import {Directive, ElementRef, EventEmitter, HostListener, Input, Output, Renderer2} from '@angular/core';\n\n@Directive({\n  selector: '[fbDropzone]'\n})\nexport class DropzoneDirective {\n  constructor(\n    private el: ElementRef,\n    private renderer: Renderer2\n  ) {}\n\n  @Input() hoverClass = 'active';\n  @Output() dropped = new EventEmitter<FileList>();\n  @Output() hovered = new EventEmitter<boolean>();\n\n  @HostListener('drop', ['$event'])\n  onDrop($event: any) {\n    $event.preventDefault();\n    this.dropped.emit($event.dataTransfer.files);\n    this.renderer.removeClass(this.el.nativeElement, this.hoverClass);\n    this.hovered.emit(false);\n  }\n\n  @HostListener('dragover', ['$event'])\n  onDragOver($event: Event) {\n    $event.preventDefault();\n    this.renderer.addClass(this.el.nativeElement, this.hoverClass);\n    this.hovered.emit(true);\n  }\n\n  @HostListener('dragleave', ['$event'])\n  onDragLeave($event: Event) {\n    $event.preventDefault();\n    this.renderer.removeClass(this.el.nativeElement, this.hoverClass);\n    this.hovered.emit(false);\n  }\n}\n","import {Pipe, PipeTransform} from '@angular/core';\nimport {CompiledField} from '../../interfaces/compiled-field.interface';\nimport {Parser} from '../../utils/parser';\n\n@Pipe({\n  name: 'showField'\n})\nexport class ShowFieldPipe implements PipeTransform {\n  transform(fields: CompiledField[], parser: Parser): CompiledField[] {\n    return fields.filter(\n      field =>\n        !field.onlyOn ||\n        (\n          Array.isArray(field.onlyOn) ?\n            field.onlyOn.includes(parser.state) :\n            field.onlyOn === parser.state\n        )\n    );\n  }\n}\n","import {DragDropModule} from '@angular/cdk/drag-drop';\nimport {PortalModule} from '@angular/cdk/portal';\nimport {CommonModule} from '@angular/common';\nimport {NgModule} from '@angular/core';\nimport {ReactiveFormsModule} from '@angular/forms';\nimport {MatAutocompleteModule} from '@angular/material/autocomplete';\nimport {MatButtonModule} from '@angular/material/button';\nimport {MatCardModule} from '@angular/material/card';\nimport {MatCheckboxModule} from '@angular/material/checkbox';\nimport {MatChipsModule} from '@angular/material/chips';\nimport {MatNativeDateModule} from '@angular/material/core';\nimport {MatDatepickerModule} from '@angular/material/datepicker';\nimport {MatDialogModule} from '@angular/material/dialog';\nimport {MatDividerModule} from '@angular/material/divider';\nimport {MatExpansionModule} from '@angular/material/expansion';\nimport {MatFormFieldModule} from '@angular/material/form-field';\nimport {MatIconModule} from '@angular/material/icon';\nimport {MatInputModule} from '@angular/material/input';\nimport {MatProgressSpinnerModule} from '@angular/material/progress-spinner';\nimport {MatRadioModule} from '@angular/material/radio';\nimport {MatSelectModule} from '@angular/material/select';\nimport {MatSlideToggleModule} from '@angular/material/slide-toggle';\nimport {MatSliderModule} from '@angular/material/slider';\nimport {MatTabsModule} from '@angular/material/tabs';\nimport {MatTooltipModule} from '@angular/material/tooltip';\nimport {SanitizeModule} from '@jaspero/ng-helpers';\nimport {TranslocoModule} from '@ngneat/transloco';\nimport {DropzoneDirective} from './directives/dropzone/dropzone.directive';\nimport {FieldComponent} from './field/field.component';\nimport {AutocompleteComponent} from './fields/autocomplete/autocomplete.component';\nimport {CheckboxComponent} from './fields/checkbox/checkbox.component';\nimport {ChipsComponent} from './fields/chips/chips.component';\nimport {DateFieldComponent} from './fields/date-field/date-field.component';\nimport {DraggableListComponent} from './fields/draggable-list/draggable-list.component';\nimport {FileComponent} from './fields/file/file.component';\nimport {GalleryComponent} from './fields/gallery/gallery.component';\nimport {ImageComponent} from './fields/image/image.component';\nimport {InputComponent} from './fields/input/input.component';\nimport {RadioComponent} from './fields/radio/radio.component';\nimport {RangeComponent} from './fields/range/range.component';\nimport {SelectComponent} from './fields/select/select.component';\nimport {SliderComponent} from './fields/slider/slider.component';\nimport {TextareaComponent} from './fields/textarea/textarea.component';\nimport {ToggleComponent} from './fields/toggle/toggle.component';\nimport {WysiwygComponent} from './fields/wysiwyg/wysiwyg.component';\nimport {FormBuilderComponent} from './form-builder.component';\nimport {ShowFieldPipe} from './pipes/show-field/show-field.pipe';\nimport {SegmentComponent} from './segment/segment.component';\nimport {AccordionComponent} from './segments/accordion/accordion.component';\nimport {CardComponent} from './segments/card/card.component';\nimport {EmptyComponent} from './segments/empty/empty.component';\nimport {StepperComponent} from './segments/stepper/stepper.component';\nimport {TabsComponent} from './segments/tabs/tabs.component';\n\n@NgModule({\n  declarations: [\n\n    /**\n     * Fields\n     */\n    FieldComponent,\n\n    AutocompleteComponent,\n    CheckboxComponent,\n    ChipsComponent,\n    DateFieldComponent,\n    RangeComponent,\n    DraggableListComponent,\n    FileComponent,\n    GalleryComponent,\n    ImageComponent,\n    InputComponent,\n    RadioComponent,\n    SelectComponent,\n    SliderComponent,\n    TextareaComponent,\n    ToggleComponent,\n    WysiwygComponent,\n\n    /**\n     * Segments\n     */\n    SegmentComponent,\n\n    AccordionComponent,\n    CardComponent,\n    EmptyComponent,\n    StepperComponent,\n    TabsComponent,\n\n    /**\n     * Directives\n     */\n    DropzoneDirective,\n\n    /**\n     * Pipes\n     */\n    ShowFieldPipe,\n\n    FormBuilderComponent\n  ],\n  imports: [\n    CommonModule,\n    ReactiveFormsModule,\n\n    /**\n     * Material\n     */\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatAutocompleteModule,\n    MatSelectModule,\n    MatSliderModule,\n    MatSlideToggleModule,\n    MatCheckboxModule,\n    MatChipsModule,\n    MatIconModule,\n    MatDatepickerModule,\n    MatNativeDateModule,\n    DragDropModule,\n    MatDialogModule,\n    MatTooltipModule,\n    MatProgressSpinnerModule,\n    MatExpansionModule,\n    MatDividerModule,\n    PortalModule,\n    MatCardModule,\n    MatTabsModule,\n    MatRadioModule,\n\n    /**\n     * Jp Helpers\n     */\n    SanitizeModule,\n\n    /**\n     * Other\n     */\n    TranslocoModule\n  ],\n  exports: [FormBuilderComponent]\n})\nexport class FormBuilderModule {\n}\n"]}