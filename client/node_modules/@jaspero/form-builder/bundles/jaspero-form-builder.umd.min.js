!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("@angular/material/snack-bar"),require("@ngneat/transloco"),require("rxjs/operators"),require("@angular/cdk/portal"),require("@angular/cdk/drag-drop"),require("json-pointer"),require("@angular/forms"),require("@angular/common"),require("@angular/cdk/overlay"),require("@angular/common/http"),require("@angular/material/dialog"),require("@angular/platform-browser"),require("tinymce/plugins/code"),require("tinymce/plugins/print"),require("tinymce/plugins/wordcount"),require("tinymce/plugins/link"),require("tinymce/plugins/image"),require("tinymce/plugins/imagetools"),require("tinymce/plugins/fullscreen"),require("tinymce/plugins/lists"),require("tinymce/plugins/autolink"),require("tinymce/plugins/advlist"),require("tinymce/plugins/table"),require("@angular/material/autocomplete"),require("@angular/material/button"),require("@angular/material/card"),require("@angular/material/checkbox"),require("@angular/material/chips"),require("@angular/material/core"),require("@angular/material/datepicker"),require("@angular/material/divider"),require("@angular/material/expansion"),require("@angular/material/form-field"),require("@angular/material/icon"),require("@angular/material/input"),require("@angular/material/progress-spinner"),require("@angular/material/radio"),require("@angular/material/select"),require("@angular/material/slide-toggle"),require("@angular/material/slider"),require("@angular/material/tabs"),require("@angular/material/tooltip"),require("@jaspero/ng-helpers")):"function"==typeof define&&define.amd?define("@jaspero/form-builder",["exports","@angular/core","rxjs","@angular/material/snack-bar","@ngneat/transloco","rxjs/operators","@angular/cdk/portal","@angular/cdk/drag-drop","json-pointer","@angular/forms","@angular/common","@angular/cdk/overlay","@angular/common/http","@angular/material/dialog","@angular/platform-browser","tinymce/plugins/code","tinymce/plugins/print","tinymce/plugins/wordcount","tinymce/plugins/link","tinymce/plugins/image","tinymce/plugins/imagetools","tinymce/plugins/fullscreen","tinymce/plugins/lists","tinymce/plugins/autolink","tinymce/plugins/advlist","tinymce/plugins/table","@angular/material/autocomplete","@angular/material/button","@angular/material/card","@angular/material/checkbox","@angular/material/chips","@angular/material/core","@angular/material/datepicker","@angular/material/divider","@angular/material/expansion","@angular/material/form-field","@angular/material/icon","@angular/material/input","@angular/material/progress-spinner","@angular/material/radio","@angular/material/select","@angular/material/slide-toggle","@angular/material/slider","@angular/material/tabs","@angular/material/tooltip","@jaspero/ng-helpers"],t):t(((e=e||self).jaspero=e.jaspero||{},e.jaspero["form-builder"]={}),e.ng.core,e.rxjs,e.ng.material.snackBar,e.transloco,e.rxjs.operators,e.ng.cdk.portal,e.ng.cdk.dragDrop,e.jsonPointer,e.ng.forms,e.ng.common,e.ng.cdk.overlay,e.ng.common.http,e.ng.material.dialog,e.ng.platformBrowser,null,null,null,null,null,null,null,null,null,null,null,e.ng.material.autocomplete,e.ng.material.button,e.ng.material.card,e.ng.material.checkbox,e.ng.material.chips,e.ng.material.core,e.ng.material.datepicker,e.ng.material.divider,e.ng.material.expansion,e.ng.material.formField,e.ng.material.icon,e.ng.material.input,e.ng.material.progressSpinner,e.ng.material.radio,e.ng.material.select,e.ng.material.slideToggle,e.ng.material.slider,e.ng.material.tabs,e.ng.material.tooltip,e.ngHelpers)}(this,(function(exports,core,rxjs,snackBar,transloco,operators,portal,dragDrop,jsonPointer,forms,common,overlay,http,dialog,platformBrowser,code,print,wordcount,link,image,imagetools,fullscreen,lists,autolink,advlist,table,autocomplete,button,card,checkbox,chips,core$1,datepicker,divider,expansion,formField,icon,input,progressSpinner,radio,select,slideToggle,slider,tabs,tooltip,ngHelpers){"use strict";var SegmentType,State;SegmentType=exports.SegmentType||(exports.SegmentType={}),SegmentType.Empty="empty",SegmentType.Card="card",SegmentType.Accordion="accordion",SegmentType.Tabs="tabs",SegmentType.Stepper="stepper",State=exports.State||(exports.State={}),State.Create="create",State.Edit="edit";var FormBuilderService=function(){function e(e,t){this.transloco=e,this.snackBar=t,this.saveComponents=[]}return e.prototype.notify=function(e){var t=this;void 0===e&&(e={});var n=Object.assign({success:"GENERAL.OPERATION_COMPLETED",error:"GENERAL.OPERATION_FAILED"},e);return function(e){return e.pipe(operators.tap((function(){n.success&&t.snackBar.open(t.transloco.translate(n.success),t.transloco.translate("GENERAL.DISMISS"),{duration:5e3})})),operators.catchError((function(e){return n.error&&t.snackBar.open(t.transloco.translate(n.error),t.transloco.translate("GENERAL.DISMISS"),{panelClass:"snack-bar-error",duration:5e3}),console.error(e),rxjs.throwError(e)})))}},e}();FormBuilderService.decorators=[{type:core.Injectable}],FormBuilderService.ctorParameters=function(){return[{type:transloco.TranslocoService},{type:snackBar.MatSnackBar}]};var CUSTOM_FIELDS=new core.InjectionToken("CUSTOM_FIELDS"),extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function __extends(e,t){function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function __rest(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n}function __decorate(e,t,n,a){var o,r=arguments.length,i=r<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,a);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(r<3?o(i):r>3?o(t,n,i):o(t,n))||i);return r>3&&i&&Object.defineProperty(t,n,i),i}function __param(e,t){return function(n,a){t(n,a,e)}}function __metadata(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function __awaiter(e,t,n,a){return new(n||(n=Promise))((function(o,r){function i(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((a=a.apply(e,t||[])).next())}))}function __generator(e,t){var n,a,o,r,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,a&&(o=2&r[0]?a.return:r[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,r[1])).done)return o;switch(a=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return i.label++,{value:r[1],done:!1};case 5:i.label++,a=r[1],r=[0];continue;case 7:r=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){i=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){i.label=r[1];break}if(6===r[0]&&i.label<o[1]){i.label=o[1],o=r;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(r);break}o[2]&&i.ops.pop(),i.trys.pop();continue}r=t.call(e,i)}catch(e){r=[6,e],a=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}var __createBinding=Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]};function __exportStar(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||__createBinding(t,e,n)}function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],a=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,o,r=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(e){o={error:e}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return i}function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}function __spreadArrays(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),o=0;for(t=0;t<n;t++)for(var r=arguments[t],i=0,s=r.length;i<s;i++,o++)a[o]=r[i];return a}function __await(e){return this instanceof __await?(this.v=e,this):new __await(e)}function __asyncGenerator(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,o=n.apply(e,t||[]),r=[];return a={},i("next"),i("throw"),i("return"),a[Symbol.asyncIterator]=function(){return this},a;function i(e){o[e]&&(a[e]=function(t){return new Promise((function(n,a){r.push([e,t,n,a])>1||s(e,t)}))})}function s(e,t){try{(n=o[e](t)).value instanceof __await?Promise.resolve(n.value.v).then(l,c):p(r[0][2],n)}catch(e){p(r[0][3],e)}var n}function l(e){s("next",e)}function c(e){s("throw",e)}function p(e,t){e(t),r.shift(),r.length&&s(r[0][0],r[0][1])}}function __asyncDelegator(e){var t,n;return t={},a("next"),a("throw",(function(e){throw e})),a("return"),t[Symbol.iterator]=function(){return this},t;function a(a,o){t[a]=e[a]?function(t){return(n=!n)?{value:__await(e[a](t)),done:"return"===a}:o?o(t):t}:o}}function __asyncValues(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(n){t[n]=e[n]&&function(t){return new Promise((function(a,o){(function(e,t,n,a){Promise.resolve(a).then((function(t){e({value:t,done:n})}),t)})(a,o,(t=e[n](t)).done,t.value)}))}}}function __makeTemplateObject(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var __setModuleDefault=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function __importStar(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t}function __importDefault(e){return e&&e.__esModule?e:{default:e}}function __classPrivateFieldGet(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function __classPrivateFieldSet(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n}var SEGMENT_DATA=new core.InjectionToken("SEGMENT_DATA");function createSegmentInjector(e,t){var n=new WeakMap;return n.set(SEGMENT_DATA,t),new portal.PortalInjector(e,n)}var SegmentComponent=function(){function e(e,t){this.sData=e,this.injector=t,this.nestedArraySegments=[],this.arrayFields=[]}return e.prototype.ngOnInit=function(){var e=this;this.segment=this.sData.segment,this.classes=this.sData.segment.classes.join(" "),this.pointers=this.sData.parser.pointers,this.id=this.sData.segment.id||"",this.nestedSegments=filterAndCompileSegments(this.sData.segment.nestedSegments||[],this.sData.parser,this.sData.definitions,this.injector,this.segment.entryValue);var t=this.segment.array;if(t&&this.segment.entryValue){var n=void 0;try{n=jsonPointer.get(this.segment.entryValue,t)}catch(e){}if(n){n.forEach((function(){return e.addArrayItem(!1)})),this.pointers[t].control.patchValue(n);for(var a=0;a<n.length;a++)this.sData.parser.loadHooks(this.pointers[t].arrayPointers[a])}}},e.prototype.addArrayItem=function(e){var t=this;void 0===e&&(e=!0);var n,a=this.segment.array,o=this.sData.parser.addArrayItem((this.sData.parent||"")+a,e,this.sData.parent?{pointer:this.sData.parent,index:0}:void 0);n=this.segment.fields&&this.segment.fields.length?this.segment.fields.map((function(e){return e=(t.sData.parent||"")+e,t.sData.parser.field(e,o[e],t.sData.definitions,!0,a)})):[this.sData.parser.field(a,Object.assign(Object.assign({},this.pointers[a]),{control:o}),this.sData.definitions)],this.arrayFields.unshift(n),this.nestedArraySegments.unshift(this.nestedSegments=filterAndCompileSegments(this.sData.segment.nestedSegments||[],this.sData.parser,this.sData.definitions,this.injector,this.segment.entryValue,this.segment.array))},e.prototype.moveArray=function(e,t){var n;n=e?0===t?this.arrayFields.length-1:t-1:t===this.arrayFields.length-1?0:t+1,dragDrop.moveItemInArray(this.arrayFields,t,n),dragDrop.moveItemInArray(this.nestedArraySegments,t,n),this.sData.parser.moveArrayItem((this.sData.parent||"")+this.segment.array,t,n,this.sData.parent?{pointer:this.sData.parent,index:0}:void 0)},e.prototype.removeArrayItem=function(e){this.sData.parser.removeArrayItem((this.sData.parent||"")+this.segment.array,e,this.sData.parent?{pointer:this.sData.parent,index:0}:void 0),this.nestedArraySegments.splice(e,1),this.arrayFields.splice(e,1)},e}();SegmentComponent.decorators=[{type:core.Component,args:[{selector:"fb-segment",template:""}]}],SegmentComponent.ctorParameters=function(){return[{type:void 0,decorators:[{type:core.Inject,args:[SEGMENT_DATA]}]},{type:core.Injector}]},SegmentComponent.propDecorators={classes:[{type:core.HostBinding,args:["class"]}],id:[{type:core.HostBinding,args:["id"]}]};var AccordionComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.accordions=(this.sData.segment.configuration||[]).map((function(e){return{title:e.title,fields:(e.fields||[]).map((function(e){return t.sData.parser.field(e,t.pointers[e],t.sData.definitions)})),nestedSegments:filterAndCompileSegments(e.nestedSegments||[],t.sData.parser,t.sData.definitions,t.injector,t.segment.entryValue)}}))},t}(SegmentComponent);AccordionComponent.decorators=[{type:core.Component,args:[{selector:"fb-accordion",template:'<ng-container *ngIf="segment.title || segment.subTitle">\n  <h4 *ngIf="segment.title">{{segment.title}}</h4>\n  <h5 *ngIf="segment.subTitle">{{segment.subTitle}}</h5>\n  <div class="p-y-m">\n    <mat-divider></mat-divider>\n  </div>\n</ng-container>\n\n<p *ngIf="segment.description">{{segment.description}}</p>\n\n<mat-accordion>\n  <mat-expansion-panel *ngFor="let accord of accordions" [expanded]="accord.expanded || false">\n    <mat-expansion-panel-header>\n      <mat-panel-title *ngIf="accord.title">{{accord.title}}</mat-panel-title>\n      <mat-panel-description *ngIf="accord.description">\n        {{accord.description}}\n      </mat-panel-description>\n    </mat-expansion-panel-header>\n\n    <ng-container *ngFor="let field of accord.fields | showField:sData.parser">\n      <ng-template [cdkPortalOutlet]="field.portal"></ng-template>\n    </ng-container>\n\n    <ng-container *ngFor="let nested of accord.nestedSegments">\n      <ng-template [cdkPortalOutlet]="nested.component"></ng-template>\n    </ng-container>\n  </mat-expansion-panel>\n</mat-accordion>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[""]}]}];var CardComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"fields",{get:function(){return this.segment.fields},enumerable:!1,configurable:!0}),t}(SegmentComponent);CardComponent.decorators=[{type:core.Component,args:[{selector:"fb-card",template:'<mat-card>\n  <mat-card-header *ngIf="segment.title || segment.subTitle || segment.array">\n    <div>\n      <h1 *ngIf="segment.title">{{segment.title}}</h1>\n      <h2 class="fs-small" *ngIf="segment.subTitle">{{segment.subTitle}}</h2>\n    </div>\n    <div class="flex-1"></div>\n    <button *ngIf="segment.array" mat-icon-button (click)="addArrayItem()" [matTooltip]="\'GENERAL.ADD\' | transloco">\n      <mat-icon>add</mat-icon>\n    </button>\n  </mat-card-header>\n\n  <mat-card-content>\n    <div class="fb-fields">\n      <p class="mat-form-field-wrapper" *ngIf="segment.description">{{segment.description}}</p>\n\n      <ng-container *ngIf="segment.array; else regular">\n        <ng-container *ngFor="let fields of arrayFields; index as index; last as last">\n          <ng-container *ngFor="let field of fields | showField:sData.parser">\n            <ng-template [cdkPortalOutlet]="field.portal"></ng-template>\n          </ng-container>\n\n          <div class="fb-field-12" *ngFor="let nested of (nestedArraySegments[index] || [])">\n            <ng-template [cdkPortalOutlet]="nested.component"></ng-template>\n          </div>\n\n          <div class="ta-right fb-field-12">\n            <button mat-icon-button (click)="moveArray(true, index)">\n              <mat-icon>arrow_upward</mat-icon>\n            </button>\n            &nbsp;\n            <button mat-icon-button (click)="moveArray(false, index)">\n              <mat-icon>arrow_downward</mat-icon>\n            </button>\n            &nbsp;\n            <button mat-icon-button color="warn" (click)="removeArrayItem(index)">\n              <mat-icon>delete_forever</mat-icon>\n            </button>\n          </div>\n          <hr *ngIf="!last" class="fb-field-12 m-y-m nested-divider">\n        </ng-container>\n      </ng-container>\n\n      <ng-template #regular>\n        <ng-container *ngFor="let field of fields | showField:sData.parser">\n          <ng-template [cdkPortalOutlet]="field.portal"></ng-template>\n        </ng-container>\n\n        <ng-container *ngFor="let nested of nestedSegments">\n          <ng-template [cdkPortalOutlet]="nested.component"></ng-template>\n        </ng-container>\n      </ng-template>\n    </div>\n  </mat-card-content>\n</mat-card>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[".nested-divider{margin-left:-16px;margin-right:-16px}"]}]}];var EmptyComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"fields",{get:function(){return this.segment.fields},enumerable:!1,configurable:!0}),t}(SegmentComponent);EmptyComponent.decorators=[{type:core.Component,args:[{selector:"fb-empty",template:'<ng-container *ngIf="segment.title || segment.subTitle">\n  <div class="flex jc-between">\n    <div>\n      <h4 *ngIf="segment.title">{{segment.title}}</h4>\n      <h5 *ngIf="segment.subTitle">{{segment.subTitle}}</h5>\n    </div>\n    <button *ngIf="segment.array" mat-icon-button (click)="addArrayItem()" [matTooltip]="\'GENERAL.ADD\' | transloco">\n      <mat-icon>add</mat-icon>\n    </button>\n  </div>\n  <div class="p-y-m">\n    <mat-divider></mat-divider>\n  </div>\n</ng-container>\n\n<div class="fb-fields panel">\n  <p *ngIf="segment.description">{{segment.description}}</p>\n\n  <ng-container *ngIf="segment.array; else regular">\n    <ng-container *ngFor="let fields of arrayFields; index as index; last as last">\n      <ng-container *ngFor="let field of fields | showField:sData.parser">\n        <ng-template [cdkPortalOutlet]="field.portal"></ng-template>\n      </ng-container>\n\n      <div class="fb-field-12" *ngFor="let nested of (nestedArraySegments[index] || [])">\n        <ng-template [cdkPortalOutlet]="nested.component"></ng-template>\n      </div>\n\n      <div class="ta-right fb-field-12">\n        <button mat-icon-button (click)="moveArray(true, index)">\n          <mat-icon>arrow_upward</mat-icon>\n        </button>\n        &nbsp;\n        <button mat-icon-button (click)="moveArray(false, index)">\n          <mat-icon>arrow_downward</mat-icon>\n        </button>\n        &nbsp;\n        <button mat-icon-button color="warn" (click)="removeArrayItem(index)">\n          <mat-icon>delete_forever</mat-icon>\n        </button>\n      </div>\n      <hr *ngIf="!last" class="fb-field-12 m-y-m nested-divider">\n    </ng-container>\n  </ng-container>\n\n  <ng-template #regular>\n    <ng-container *ngFor="let field of fields | showField:sData.parser">\n      <ng-template [cdkPortalOutlet]="field.portal"></ng-template>\n    </ng-container>\n\n    <ng-container *ngFor="let nested of nestedSegments">\n      <ng-template [cdkPortalOutlet]="nested.component"></ng-template>\n    </ng-container>\n  </ng-template>\n</div>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[".nested-divider{margin-left:-16px;margin-right:-16px}"]}]}];var StepperComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(SegmentComponent);function safeEval(method){var final;try{final=eval(method)}catch(e){}return final}StepperComponent.decorators=[{type:core.Component,args:[{selector:"fb-stepper",template:"<p>\n  stepper works!\n</p>\n",changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[""]}]}];var TabsComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"configuration",{get:function(){return this.segment.configuration},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.configuration.selectedTabChange&&(this.selectedTabChange=safeEval(this.configuration.selectedTabChange)),this.tabs=this.configuration.tabs.map((function(e){return Object.assign(Object.assign({},e),{fields:(e.fields||[]).map((function(e){return t.sData.parser.field(e,t.pointers[e],t.sData.definitions)})),nestedSegments:filterAndCompileSegments(e.nestedSegments||[],t.sData.parser,t.sData.definitions,t.injector,t.segment.entryValue)})}))},t.prototype.tabChange=function(e){this.selectedTabChange&&this.selectedTabChange(e,this.sData)},t}(SegmentComponent),_a;TabsComponent.decorators=[{type:core.Component,args:[{selector:"fb-tabs",template:'<ng-container *ngIf="segment.title || segment.subTitle">\n  <h4 *ngIf="segment.title">{{segment.title}}</h4>\n  <h5 *ngIf="segment.subTitle">{{segment.subTitle}}</h5>\n  <div class="p-y-m">\n    <mat-divider></mat-divider>\n  </div>\n</ng-container>\n\n<p *ngIf="segment.description">{{segment.description}}</p>\n\n<mat-tab-group\n  [selectedIndex]="configuration.selectedIndex"\n  [dynamicHeight]="configuration.dynamicHeight"\n  [disableRipple]="configuration.disableRipple"\n  [attr.mat-align-tabs]="configuration.alignment"\n  (selectedTabChange)="tabChange($event)">\n\n  <mat-tab\n    *ngFor="let tab of tabs"\n    [label]="tab.title"\n    [disabled]="tab.disabled">\n\n    <div class="p-a-s">\n      <ng-container *ngFor="let field of tab.fields | showField:sData.parser">\n        <ng-template [cdkPortalOutlet]="field.portal"></ng-template>\n      </ng-container>\n    </div>\n\n    <ng-container *ngFor="let nested of tab.nestedSegments">\n      <ng-template [cdkPortalOutlet]="nested.component"></ng-template>\n    </ng-container>\n  </mat-tab>\n</mat-tab-group>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[""]}]}];var SEGMENT_TYPE_COMPONENT_MAP=(_a={},_a[exports.SegmentType.Empty]=EmptyComponent,_a[exports.SegmentType.Card]=CardComponent,_a[exports.SegmentType.Accordion]=AccordionComponent,_a[exports.SegmentType.Tabs]=TabsComponent,_a[exports.SegmentType.Stepper]=StepperComponent,_a),ConditionType,ConditionAction,ConditionEvaluate,ComponentType;function compileSegment(e,t,n,a,o,r){var i,s;void 0===r&&(r="");var l=[],c=[];e.columnsDesktop&&l.push("col-"+e.columnsDesktop),e.columnsTablet&&l.push("col-m-"+e.columnsTablet),e.columnsMobile&&l.push("col-s-"+e.columnsMobile),l.length||l.push("col-12"),e.classes&&l.push.apply(l,__spread(e.classes)),e.fields&&(c=e.array?(e.fields||[]).map((function(t){return e.array+t})):(e.fields||[]).reduce((function(e,a){var o=t.getFromDefinitions(a,n);return o&&o.roles&&!("string"==typeof o.roles?o.roles===t.role:o.roles.includes(t.role))||e.push(t.field(a,t.pointers[a],n)),e}),[]));var p=Object.assign(Object.assign({},e),{classes:l,fields:c,entryValue:o});if(e.conditions){p.conditions=[];var m=o||{};try{for(var u=__values(e.conditions),d=u.next();!d.done;d=u.next()){var f=d.value,g=void 0,h=f.type||ConditionType.Function,y=f.action||ConditionAction.Show,v=f.evaluateOn||ConditionEvaluate.OnLoad,b=f.evaluateStates||[0,1,2];if(f.condition&&(g=safeEval(f.condition)),g){if(v===ConditionEvaluate.OnLoad&&(y===ConditionAction.Show&&!g(m)||y===ConditionAction.Hide&&g(m)))return null;p.conditions.push(Object.assign({condition:g,type:h,action:y,evaluateStates:b,evaluateOn:v},f.data&&{data:f.data}))}}}catch(e){i={error:e}}finally{try{d&&!d.done&&(s=u.return)&&s.call(u)}finally{if(i)throw i.error}}}return Object.assign({component:new portal.ComponentPortal(SEGMENT_TYPE_COMPONENT_MAP[e.type||exports.SegmentType.Card],null,createSegmentInjector(a,Object.assign({segment:p,parser:t,definitions:n},r&&{parent:r})))},p)}function filterAndCompileSegments(e,t,n,a,o,r){return e.reduce((function(e,i){if(!i.authorization||i.authorization.includes(t.role)){var s=compileSegment(i,t,n,a,o,r);s&&e.push(s)}return e}),[])}!function(e){e.Function="function",e.Statement="statement"}(ConditionType||(ConditionType={})),function(e){e.Show="show",e.Hide="hide"}(ConditionAction||(ConditionAction={})),function(e){e.OnLoad="onLoad",e.OnChange="onChange"}(ConditionEvaluate||(ConditionEvaluate={})),ComponentType=exports.ComponentType||(exports.ComponentType={}),ComponentType.Input="input",ComponentType.Select="select",ComponentType.File="file",ComponentType.Image="image",ComponentType.Gallery="gallery",ComponentType.Toggle="toggle",ComponentType.Checkbox="checkbox",ComponentType.Date="date",ComponentType.Range="range",ComponentType.Radio="radio",ComponentType.Slider="slider",ComponentType.Autocomplete="autocomplete",ComponentType.Wysiwyg="wysiwyg",ComponentType.Chips="chips",ComponentType.Draggable="draggable",ComponentType.Textarea="textarea";var DbService=function(){function e(){}return e.prototype.getDocuments=function(e,t,n,a,o){return rxjs.of([])},e.prototype.getDocumentsSimple=function(e,t,n){return rxjs.of([])},e.prototype.getStateChanges=function(e,t,n,a,o){return rxjs.of([])},e.prototype.getDocument=function(e,t,n){return void 0===n&&(n=!1),rxjs.of()},e.prototype.setDocument=function(e,t,n,a){return rxjs.of()},e.prototype.removeDocument=function(e,t){return rxjs.of()},e.prototype.createUserAccount=function(e,t){return rxjs.of()},e.prototype.removeUserAccount=function(e){return rxjs.of()},e}(),COMPONENT_DATA=new core.InjectionToken("COMPONENT_DATA");function createComponentInjector(e,t){var n=new WeakMap;return n.set(COMPONENT_DATA,t),new portal.PortalInjector(e,n)}var FieldComponent=function(e){this.cData=e;var t=["fb-field-"+(this.cData.columnsDesktop||12)];this.cData.columnsTablet&&t.push("m-fb-field-"+this.cData.columnsTablet),this.cData.columnsMobile&&t.push("s-fb-field-"+this.cData.columnsMobile),this.cData.class&&t.push(this.cData.class),this.class=t.join(" ")};function getHsd(e,t){var n;if(t[e])switch(t[e].type){case"dynamic":if(n=safeEval(t[e].value))return t.form.valueChanges.pipe(operators.map((function(e){return n(t.control.value,e)})));break;case"static":if(n=safeEval(t[e].value))return rxjs.of(n(t.control.value,t.form.getRawValue()));break;case"html":default:return rxjs.of(t[e].value)}return rxjs.of("")}FieldComponent.decorators=[{type:core.Component,args:[{selector:"fb-field",template:""}]}],FieldComponent.ctorParameters=function(){return[{type:void 0,decorators:[{type:core.Inject,args:[COMPONENT_DATA]}]}]},FieldComponent.propDecorators={class:[{type:core.HostBinding,args:["class"]}]};var AutocompleteComponent=function(e){function t(t,n){var a=e.call(this,t)||this;return a.cData=t,a.dbService=n,a.loading$=new rxjs.BehaviorSubject(!0),a}return __extends(t,e),t.prototype.ngOnInit=function(){var e,t=this;if(this.prefix$=getHsd("prefix",this.cData),this.suffix$=getHsd("suffix",this.cData),this.cData.populate){var n=this.cData.populate;e=this.dbService.getDocumentsSimple(this.cData.populate.collection,this.cData.populate.orderBy,this.cData.populate.filter).pipe(operators.map((function(e){return e.map((function(e){return{value:e[n.valueKey||"id"],name:e[n.nameKey]}}))})),operators.tap((function(){return t.loading$.next(!1)})))}else e=rxjs.of(this.cData.dataSet);this.filteredSet$=e.pipe(operators.switchMap((function(e){return t.cData.control.valueChanges.pipe(operators.startWith(t.cData.control.value),operators.map((function(t){return t?(t=t.toLowerCase(),e.filter((function(e){return e.name.toLowerCase().includes(t)}))):e})))})))},t}(FieldComponent);AutocompleteComponent.decorators=[{type:core.Component,args:[{selector:"fb-autocomplete",template:'<mat-form-field appearance="outline" class="w-full">\n  <mat-label>{{(cData.label || \'\') | transloco}}</mat-label>\n  <input\n    matInput\n    [placeholder]="(cData.placeholder || \'\') | transloco"\n    [attr.autocomplete]="cData.autocomplete || \'on\'"\n    [formControl]="cData.control"\n    [matAutocomplete]="auto">\n  <mat-autocomplete #auto="matAutocomplete">\n    <mat-option *ngFor="let data of filteredSet$ | async" [value]="data.value">\n      {{data.name}}\n    </mat-option>\n  </mat-autocomplete>\n  <mat-hint *ngIf="cData.hint" [innerHTML]="cData.hint | jpSanitize"></mat-hint>\n  <span *ngIf="cData.suffix" matSuffix [innerHTML]="((suffix$ | async) || \'\') | jpSanitize"></span>\n  <span *ngIf="cData.prefix" matPrefix [innerHTML]="((prefix$ | async) || \'\') | jpSanitize"></span>\n</mat-form-field>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[""]}]}],AutocompleteComponent.ctorParameters=function(){return[{type:void 0,decorators:[{type:core.Inject,args:[COMPONENT_DATA]}]},{type:DbService}]};var CheckboxComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(FieldComponent);CheckboxComponent.decorators=[{type:core.Component,args:[{selector:"fb-checkbox",template:'<div class="mat-form-field-wrapper">\n  <mat-checkbox [formControl]="cData.control">\n    <mat-label>{{cData.label | transloco}}</mat-label>\n  </mat-checkbox>\n  <p class="fs-small fg-secondary" *ngIf="cData.hint">\n    {{cData.hint | transloco}}\n  </p>\n</div>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[""]}]}];var ChipsComponent=function(e){function t(){var t=e.apply(this,__spread(arguments))||this;return t.data=[],t}return __extends(t,e),t.prototype.ngOnInit=function(){this.data=this.cData.control.value,this.removable=!this.cData.hasOwnProperty("removable")||this.cData.removable,this.prefix$=getHsd("prefix",this.cData),this.suffix$=getHsd("suffix",this.cData)},t.prototype.add=function(e){var t=(e.value||"").trim(),n=e.input;!t||this.cData.unique&&this.data.includes(t)||(this.data.push(t),this.cData.control.setValue(this.data)),n&&(n.value="")},t.prototype.remove=function(e){var t=this.cData.control.value.indexOf(e);t>=0&&(this.data.splice(t,1),this.cData.control.setValue(this.data))},t}(FieldComponent);function cloneAbstractControl(e){var t;if(e instanceof forms.FormGroup){var n=new forms.FormGroup({},e.validator,e.asyncValidator),a=e.controls;Object.keys(a).forEach((function(e){n.addControl(e,cloneAbstractControl(a[e]))})),t=n}else if(e instanceof forms.FormArray){var o=new forms.FormArray([],e.validator,e.asyncValidator);e.controls.forEach((function(e){return o.push(cloneAbstractControl(e))})),t=o}else{if(!(e instanceof forms.FormControl))throw new Error("Error: unexpected control value");t=new forms.FormControl(e.value,e.validator,e.asyncValidator)}return e.disabled&&t.disable({emitEvent:!1}),t}ChipsComponent.decorators=[{type:core.Component,args:[{selector:"fb-chips",template:'<mat-form-field class="w-full" appearance="outline">\n  <mat-label>{{(cData.label || \'\') | transloco}}</mat-label>\n  <mat-chip-list #chipList>\n    <mat-chip\n      *ngFor="let chip of data"\n      [selectable]="cData.selectable"\n      [removable]="removable"\n      (removed)="remove(chip)">\n      {{chip}}\n      <mat-icon *ngIf="removable" matChipRemove>cancel</mat-icon>\n    </mat-chip>\n    <input\n      matInput\n      [attr.autocomplete]="cData.autocomplete || \'on\'"\n      [placeholder]="(cData.placeholder || \'\') | transloco"\n      (matChipInputTokenEnd)="add($event)"\n      [matChipInputFor]="chipList">\n  </mat-chip-list>\n  <span *ngIf="cData.suffix" matSuffix [innerHTML]="((suffix$ | async) || \'\') | jpSanitize"></span>\n  <span *ngIf="cData.prefix" matPrefix [innerHTML]="((prefix$ | async) || \'\') | jpSanitize"></span>\n  <mat-hint *ngIf="cData.hint" [innerHTML]="cData.hint | jpSanitize"></mat-hint>\n</mat-form-field>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[""]}]}];var DateFieldComponent=function(e){function t(t,n,a){var o=e.call(this,t)||this;return o.cData=t,o.cdr=n,o.formBuilderService=a,o}return __extends(t,e),t.prototype.ngOnInit=function(){this.formBuilderService.saveComponents.push(this),this.startDate=this.cData.startAt?new Date(this.cData.startAt):new Date;var e=new Date(this.cData.control.value);this.entryControl=cloneAbstractControl(this.cData.control),this.hoursControl=new forms.FormControl({value:e.getHours()||0,disabled:this.cData.control.disabled},[forms.Validators.min(0),forms.Validators.max(23)]),this.minutesControl=new forms.FormControl({value:e.getMinutes()||0,disabled:this.cData.control.disabled},[forms.Validators.min(0),forms.Validators.max(59)]),"number"!=typeof this.entryControl.value&&"string"!=typeof this.entryControl.value||this.entryControl.setValue(new Date(this.entryControl.value))},t.prototype.save=function(){var e=this;return rxjs.of({}).pipe(operators.tap((function(){var t=e.entryControl.value;t&&(e.cData.includeTime&&(t.setHours(e.hoursControl.value||0),t.setMinutes(e.minutesControl.value||0)),e.cData.format&&(t="number"===e.cData.format?t.getTime():new common.DatePipe("en").transform(t,e.cData.format)));e.cData.control.setValue(t)})))},t}(FieldComponent);DateFieldComponent.decorators=[{type:core.Component,args:[{selector:"fb-date-field",template:'<div class="grid">\n  <div class="p-l-0 {{!cData.includeTime ? \'col-12\' : \'col-8\'}}">\n    <mat-form-field class="w-full" appearance="outline">\n      <mat-label>\n        {{(cData.label || \'\') | transloco}}\n      </mat-label>\n      <input\n        matInput\n        [attr.autocomplete]="cData.autocomplete || \'off\'"\n        [matDatepicker]="picker"\n        [placeholder]="(cData.placeholder || \'\') | transloco"\n        [formControl]="entryControl">\n      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>\n      <mat-datepicker\n        #picker\n        [touchUi]="cData.touchUi || false"\n        [startView]="cData.startView || \'month\'"\n        [startAt]="startDate">\n      </mat-datepicker>\n      <mat-hint *ngIf="cData.hint" [innerHTML]="cData.hint | jpSanitize"></mat-hint>\n    </mat-form-field>\n  </div>\n  <ng-container *ngIf="cData.includeTime">\n    <div class="col-2">\n      <mat-form-field class="w-full" class="w-full" appearance="outline">\n        <mat-label>{{(cData.labelHours || \'HOURS\') | transloco}}</mat-label>\n        <input matInput type="number" [placeholder]="cData.placeholderHours || \'HH\'" [formControl]="hoursControl">\n      </mat-form-field>\n    </div>\n    <div class="col-2 p-r-0">\n      <mat-form-field class="w-full" appearance="outline">\n        <mat-label>{{(cData.labelMinutes || \'MINUTES\') | transloco}}</mat-label>\n        <input matInput type="number" [placeholder]="cData.placeholderMinutes || \'MM\'" [formControl]="minutesControl">\n      </mat-form-field>\n    </div>\n  </ng-container>\n</div>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[""]}]}],DateFieldComponent.ctorParameters=function(){return[{type:void 0,decorators:[{type:core.Inject,args:[COMPONENT_DATA]}]},{type:core.ChangeDetectorRef},{type:FormBuilderService}]};var DraggableListComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.ngOnInit=function(){var e=this;this.cData.control.value.length&&this.cData.options.sort((function(t,n){var a=e.cData.control.value.indexOf(t);return e.cData.control.value.indexOf(n)-a}))},t.prototype.drop=function(e){dragDrop.moveItemInArray(this.cData.options,e.previousIndex,e.currentIndex),this.cData.control.setValue(this.cData.options.map((function(e){return e.value})))},t}(FieldComponent);DraggableListComponent.decorators=[{type:core.Component,args:[{selector:"fb-draggable-list",template:'<div class="mat-form-field-wrapper">\n  <p class="fs-small fg-secondary" *ngIf="cData.label">{{cData.label | transloco}}</p>\n\n  <div\n    class="fb-draggable-list"\n    cdkDropList\n    (cdkDropListDropped)="drop($event)">\n    <div\n      class="fb-draggable-list-item"\n      *ngFor="let item of cData.options; index as index"\n      [cdkDragDisabled]="item.disabled"\n      cdkDrag>\n      {{index + 1}}. {{item.name}}\n    </div>\n  </div>\n</div>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[".fb-draggable-list{border:1px solid var(--panel-tertiary);border-radius:4px;overflow:hidden}.fb-draggable-list-item{align-items:center;background:var(--panel-theme);border-bottom:1px solid var(--panel-tertiary);cursor:move;display:flex;padding:20px 10px}.fb-draggable-list-item:last-child{border:none}.cdk-drag-preview{border-radius:4px;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.cdk-drag-placeholder{opacity:0}.cdk-drag-animating,.fb-draggable-list.cdk-drop-list-dragging .fb-draggable-list-item:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]}]}];var StorageService=function(){function e(){}return e.prototype.upload=function(e,t,n){},e}(),formatFileName=function(e){var t=e.slice(e.lastIndexOf("."));return(e=((e=e.slice(0,e.lastIndexOf("."))).match(/[a-zA-Z\d.]/g)||[]).join("")).length?e+t:"file-"+(Math.floor(Math.random()*Math.pow(10,5))+1)+t},parseSize=function(e){if("number"==typeof e)return e;var t=Math.pow(1024,2),n=parseFloat(e);switch(e.replace(/[0-9]/g,"").toLowerCase()){case"kb":return 1024*n;case"mb":return n*t;default:return 0}},FileComponent=function(e){function t(t,n,a,o,r,i){var s=e.call(this,t)||this;return s.cData=t,s.storage=n,s.cdr=a,s.formBuilderService=o,s.transloco=r,s.snackBar=i,s}return __extends(t,e),t.prototype.ngOnInit=function(){this.cData.control.value&&(this.name=this.cData.control.value),this.emptyLabel=this.cData.hasOwnProperty("emptyLabel")?this.cData.emptyLabel:"FIELDS.FILE.EMPTY",this.formBuilderService.saveComponents.push(this),this.allowedFileTypes=this.cData.allowedFileTypes||[],this.forbiddenFileTypes=this.cData.forbiddenFileTypes||[],this.minSizeBytes=this.cData.minSize?parseSize(this.cData.minSize):0,this.maxSizeBytes=this.cData.maxSize?parseSize(this.cData.maxSize):0},t.prototype.errorSnack=function(e,t){void 0===e&&(e="GENERAL.ERROR"),void 0===t&&(t="GENERAL.DISMISS"),this.snackBar.open(this.transloco.translate(e),this.transloco.translate(t),{panelClass:"snack-bar-error",duration:5e3})},t.prototype.fileChange=function(e){var t=e.target,n=Array.from(t.files)[0];return Object.defineProperty(n,"name",{writable:!0,value:formatFileName(n.name)}),!this.allowedFileTypes.includes(n.type)&&this.allowedFileTypes.length?(this.errorSnack("FIELDS.FILE.INVALID_FILE_FORMAT"),rxjs.throwError("Invalid File Format")):this.forbiddenFileTypes.includes(n.type)?(this.errorSnack("FIELDS.FILE.FORBIDDEN_FILE_FORMAT"),rxjs.throwError("Forbidden File Format")):n.size<this.minSizeBytes?(this.errorSnack("FIELDS.FILE.BELOW_SIZE"),rxjs.throwError("File below minimal allowed size")):n.size>this.maxSizeBytes&&this.maxSizeBytes?(this.errorSnack("FIELDS.FILE.EXCEED_SIZE"),rxjs.throwError("File exceeding allowed size")):(this.value=n,this.value&&(this.name=this.value.name),void(t.value=""))},t.prototype.clear=function(){this.name="",this.cData.control.setValue("")},t.prototype.save=function(e,t){var n=this;if(this.value){var a=[e,t,this.value.name].join("-");return rxjs.from(this.storage.upload(a,this.value,{contentType:this.value.type,customMetadata:{moduleId:e,documentId:t}})).pipe(operators.switchMap((function(e){return e.ref.getDownloadURL()})),operators.tap((function(e){return n.cData.control.setValue(e)})))}return rxjs.of({})},t}(FieldComponent);function formatGeneratedImages(e){return e.reduce((function(e,t,n){return e["generate_"+(n+1)]=Object.entries(t).reduce((function(e,t){var n=__read(t,2);return e+="----"+n[0]+":"+n[1]}),""),e}),{})}FileComponent.decorators=[{type:core.Component,args:[{selector:"fb-file",template:'<div class="mat-form-field-wrapper">\n  <fieldset class="fb-file">\n    <input #file type="file" hidden (change)="fileChange($event)">\n\n    <legend class="fb-file-legend">{{(cData.label || \'\') | transloco}}</legend>\n\n    <div class="fb-file-field">\n      <span class="fb-file-field-name">{{name || (emptyLabel | transloco)}}</span>\n\n      <div class="fb-file-field-actions">\n        <ng-container *ngIf="!cData.preventClear && name">\n          <button mat-button (click)="clear()">{{\'REMOVE\' | transloco}}</button>|\n        </ng-container>\n        <button mat-button (click)="file.click()">{{\'ADD\' | transloco}}</button>\n      </div>\n    </div>\n  </fieldset>\n</div>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[".fb-file{border:1px solid var(--panel-tertiary);border-radius:4px;overflow:hidden;transition:.2s}.fb-file:hover{border:1px solid var(--panel-primary);box-shadow:0 0 0 1px var(--panel-primary)}.fb-file:focus-within{border:1px solid var(--primary-theme);box-shadow:0 0 0 1px var(--primary-theme)}.fb-file-legend{background:var(--panel-theme);color:var(--panel-secondary);font-size:.8em;margin-left:-8px;padding:0 4px}.fb-file-field{align-items:center;display:flex}.fb-file-field-name{color:var(--panel-secondary);flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:1px}.fb-file-field-actions{margin-left:auto;white-space:nowrap}"]}]}],FileComponent.ctorParameters=function(){return[{type:void 0,decorators:[{type:core.Inject,args:[COMPONENT_DATA]}]},{type:StorageService},{type:core.ChangeDetectorRef},{type:FormBuilderService},{type:transloco.TranslocoService},{type:snackBar.MatSnackBar}]},FileComponent.propDecorators={fileEl:[{type:core.ViewChild,args:["file",{static:!0}]}]};var STORAGE_URL=new core.InjectionToken("STORAGE_URL");function switchItemLocations(e,t,n){var a=e[t],o=e[n];e[n]=a,e[t]=o}function readFile(e){return new rxjs.Observable((function(t){if(e instanceof Blob){var n=new FileReader;return n.onerror=function(e){return t.error(e)},n.onabort=function(e){return t.error(e)},n.onload=function(){return t.next(n.result)},n.onloadend=function(){return t.complete()},n.readAsDataURL(e)}t.error(new Error("`blob` must be an instance of File or Blob."))}))}var GalleryComponent=function(e){function t(t,n,a,o,r,i,s,l,c,p){var m=e.call(this,t)||this;return m.cData=t,m.storageUrl=n,m.dialog=a,m.cdr=o,m.http=r,m.storage=i,m.formBuilderService=s,m.viewportRuler=l,m.transloco=c,m.snackBar=p,m.files=[],m.toRemove=[],m}return __extends(t,e),t.prototype.ngOnInit=function(){this.formBuilderService.saveComponents.push(this),this.allowedImageTypes=this.cData.allowedImageTypes||[],this.forbiddenImageTypes=this.cData.forbiddenImageTypes||[],this.minSizeBytes=this.cData.minSize?parseSize(this.cData.minSize):0,this.maxSizeBytes=this.cData.maxSize?parseSize(this.cData.maxSize):0},t.prototype.ngAfterViewInit=function(){var e=this.placeholder.element.nativeElement,t=e.parentElement;e.style.display="none",t.removeChild(e)},t.prototype.openUploadDialog=function(){this.dialog.open(this.modalTemplate,{width:"420px"})},t.prototype.addImage=function(e){var t=this;this.http.get(e,{withCredentials:!1,responseType:"blob"}).pipe(operators.switchMap((function(e){var n=e.type.split("/")[1].toLowerCase();return!t.allowedImageTypes.includes(n)&&t.allowedImageTypes.length?rxjs.throwError("Invalid Image Format"):t.forbiddenImageTypes.includes(n)?rxjs.throwError("Forbidden Image Format"):e.size<t.minSizeBytes?rxjs.throwError("Image below minimal allowed size"):e.size>t.maxSizeBytes&&t.maxSizeBytes?rxjs.throwError("Image exceeding allowed size"):rxjs.of(e)})),this.formBuilderService.notify({error:"FIELDS.GALLERY.UPLOAD_ERROR",success:null})).subscribe((function(e){var n=window.URL||window.webkitURL,a=t.cData.control.value;a.push({data:n.createObjectURL(e),live:!0}),t.cData.control.setValue(a),t.cdr.detectChanges()}))},t.prototype.openFileUpload=function(){this.fileEl.nativeElement.click()},t.prototype.openSortImages=function(){this.dialog.open(this.imagesSort,{width:"800px"})},t.prototype.drop=function(e){var t=this.cData.control.value;switchItemLocations(t,e.previousIndex,e.currentIndex),this.cData.control.setValue(t),this.cdr.detectChanges()},t.prototype.move=function(e,t){void 0===e&&(e=!1);var n=e?t-1:t+1,a=this.cData.control.value;dragDrop.moveItemInArray(a,t,n),this.cData.control.setValue(a),this.cdr.detectChanges()},t.prototype.errorSnack=function(e,t){void 0===e&&(e="GENERAL.ERROR"),void 0===t&&(t="GENERAL.DISMISS"),this.snackBar.open(this.transloco.translate(e),this.transloco.translate(t),{panelClass:"snack-bar-error",duration:5e3})},t.prototype.filesUploaded=function(e){var t,n,a=this,o=Array.from(e instanceof FileList?e:e.files);try{for(var r=__values(o),i=r.next();!i.done;i=r.next()){var s=i.value;Object.defineProperty(s,"name",{writable:!0,value:formatFileName(s.name)});var l=s.type.split("/")[1].toLowerCase();if(!this.allowedImageTypes.includes(l)&&this.allowedImageTypes.length)return this.errorSnack("FIELDS.GALLERY.INVALID_IMAGE_FORMAT"),rxjs.throwError("Invalid Image Format");if(this.forbiddenImageTypes.includes(l))return this.errorSnack("FIELDS.GALLERY.FORBIDDEN_IMAGE_FORMAT"),rxjs.throwError("Forbidden Image Format");if(s.size<this.minSizeBytes)return this.errorSnack("FIELDS.GALLERY.BELOW_SIZE"),rxjs.throwError("Image below minimal allowed size");if(s.size>this.maxSizeBytes&&this.maxSizeBytes)return this.errorSnack("FIELDS.GALLERY.EXCEED_SIZE"),rxjs.throwError("Image exceeding allowed size")}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}rxjs.forkJoin(o.map((function(e){return readFile(e).pipe(operators.map((function(t){return{data:t,pushToLive:e,live:!1}})))}))).subscribe((function(t){var n=a.cData.control.value;n.push.apply(n,__spread(t)),a.cData.control.setValue(n),e instanceof FileList||(e.value=""),a.cdr.detectChanges()}),(function(){e instanceof FileList||(e.value="")}))},t.prototype.removeImage=function(e,t){t.live&&t.data.includes(this.storageUrl)&&this.toRemove.push(t.data),this.cData.control.value.splice(e,1)},t.prototype.sortDrop=function(e){var t=this.cData.control.value;dragDrop.moveItemInArray(t,e.previousIndex,e.currentIndex),this.cData.control.setValue(t)},t.prototype.dragMoved=function(e){var t=this,n=this.getPointerPositionOnPage(e.event);this.listGroup._items.forEach((function(e){__isInsideDropListClientRect(e,n.x,n.y)&&(t.activeContainer=e)}))},t.prototype.dropListDropped=function(){if(this.target){var e=this.placeholder.element.nativeElement,t=e.parentElement;e.style.display="none";var n=this.source.element;if(t.removeChild(e),t.appendChild(e),t.insertBefore(n.nativeElement,t.children[this.sourceIndex]),this.target=null,this.source=null,this.sourceIndex!==this.targetIndex){var a=this.cData.control.value;dragDrop.moveItemInArray(a,this.sourceIndex,this.targetIndex),this.cData.control.setValue(a)}}},t.prototype.getPointerPositionOnPage=function(e){var t=__isTouchEvent(e)?e.touches[0]||e.changedTouches[0]:e,n=this.viewportRuler.getViewportScrollPosition();return{x:t.pageX-n.left,y:t.pageY-n.top}},t.prototype.save=function(e,t){var n=this;return(this.toRemove.length||this.cData.control.value)&&this.cData.control.value.find((function(e){return!e.live}))?rxjs.forkJoin(__spread(this.toRemove.map((function(e){return rxjs.from(n.storage.storage.refFromURL(e).delete()).pipe(operators.catchError((function(){return rxjs.of([])})))})),this.cData.control.value.reduce((function(a,o){if(void 0===o.live||o.live)a.push(o);else{var r=[e,t,o.pushToLive.name].join("-");a.push(rxjs.from(n.storage.upload(r,o.pushToLive,{contentType:o.pushToLive.type,customMetadata:Object.assign({moduleId:e,documentId:t},n.cData.generatedImages&&formatGeneratedImages(n.cData.generatedImages))})).pipe(operators.switchMap((function(e){return e.ref.getDownloadURL()})),operators.tap((function(e){o.data=e}))))}return a}),[]))).pipe(operators.tap((function(){return n.cData.control.setValue(n.cData.control.value.map((function(e){return e.data?e.data:e})))}))):rxjs.of([])},t}(FieldComponent);function __indexOf(e,t){return Array.prototype.indexOf.call(e,t)}function __isTouchEvent(e){return e.type.startsWith("touch")}function __isInsideDropListClientRect(e,t,n){var a=e.element.nativeElement.getBoundingClientRect(),o=a.top,r=a.bottom,i=a.left,s=a.right;return n>=o&&n<=r&&t>=i&&t<=s}GalleryComponent.decorators=[{type:core.Component,args:[{selector:"fb-gallery",template:'<p class="fs-small fg-secondary" *ngIf="cData.label">{{(cData.label || \'\') | transloco}}</p>\n\n<div class="fb-gallery" fbDropzone (dropped)="filesUploaded($event)">\n  <div class="ta-center p-y-l">\n    <button mat-button *ngIf="cData.allowUrl" (click)="openUploadDialog()">{{\'FIELDS.GALLERY.ENTER_URL\' | transloco}}</button>\n    <button mat-button *ngIf="cData.allowServerUpload" (click)="openFileUpload()">{{\'FIELDS.GALLERY.CHOOSE_FILES\' | transloco}}</button>\n    <button mat-button *ngIf="cData.allowServerUpload" (click)="openSortImages()">{{\'FIELDS.GALLERY.SORT_IMAGES\' | transloco}}</button>\n  </div>\n\n  \x3c!--Upload from disk--\x3e\n  <input #file type="file" multiple hidden (change)="filesUploaded($event.target)">\n\n  \x3c!--Uploaded images list--\x3e\n  <ng-container>\n    <div class="fb-gallery-list" cdkDropListGroup>\n\n      <div class="fb-gallery-list-placeholder" cdkDropList (cdkDropListDropped)="dropListDropped()"></div>\n\n      <div\n        cdkDropList\n        class="fb-gallery-list-image"\n        (cdkDropListDropped)="dropListDropped()"\n        *ngFor="let val of cData.control.value; index as index">\n\n        <div cdkDrag (cdkDragMoved)="dragMoved($event);">\n          <img class="fb-gallery-list-image-inner" [src]="(val.data || val) | jpSanitize:\'resourceUrl\'">\n          <button class="fb-gallery-list-image-remove" type="button" mat-icon-button [matTooltip]="\'GENERAL.REMOVE\' | transloco" (click)="removeImage(index, val)">\n            <mat-icon>close</mat-icon>\n          </button>\n        </div>\n\n      </div>\n    </div>\n  </ng-container>\n</div>\n\n\x3c!--Uplaod from URL--\x3e\n<ng-template #modal>\n  <mat-dialog-content>\n    <mat-form-field class="w-full" appearance="outline">\n      <mat-label>{{\'FIELDS.GALLERY.IMAGE_URL\' | transloco}}</mat-label>\n      <input matInput #url>\n    </mat-form-field>\n  </mat-dialog-content>\n\n  <mat-dialog-actions class="jc-end">\n    <button mat-button mat-dialog-close>{{\'GENERAL.CANCEL\' | transloco}}</button>&nbsp;\n    <button mat-flat-button color="primary" [disabled]="!url.value" (click)="addImage(url.value)" mat-dialog-close>{{\'FIELDS.GALLERY.ADD_IMAGE\' | transloco}}</button>\n  </mat-dialog-actions>\n</ng-template>\n\n\x3c!--Image sort--\x3e\n<ng-template #imagesSort>\n  <h1 mat-dialog-title>{{\'FIELDS.GALLERY.SORT_IMAGES\' | transloco}}</h1>\n\n  <mat-dialog-content>\n\n    <div\n      class="sort-wrapper"\n      cdkDropList\n      (cdkDropListDropped)="sortDrop($event)">\n\n      <div class="sort-box" *ngFor="let val of cData.control.value; index as index; first as first; last as last;" cdkDrag>\n        <img class="sort-image" [src]="(val.data || val) | jpSanitize:\'resourceUrl\'">\n        <div class="flex-1"></div>\n        <div>\n          <button mat-icon-button [disabled]="first" (click)="move(true, index)">\n            <mat-icon>arrow_upward</mat-icon>\n          </button>\n          <button mat-icon-button [disabled]="last" (click)="move(false, index)">\n            <mat-icon>arrow_downward</mat-icon>\n          </button>\n          <button mat-icon-button cdkDragHandle>\n            <mat-icon>drag_indicator</mat-icon>\n          </button>\n        </div>\n      </div>\n\n    </div>\n  </mat-dialog-content>\n</ng-template>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:['.fb-gallery{border:1px dashed var(--tertiary);margin-bottom:1.25em;position:relative}.fb-gallery-list{cursor:-webkit-grab;cursor:grab;display:flex;flex-wrap:wrap}.fb-gallery-list-placeholder{border:2px dashed var(--tertiary)}.fb-gallery-list-image,.fb-gallery-list-placeholder{flex-basis:33.33333%;padding-bottom:33.33333%;position:relative;width:33.33333%}.fb-gallery-list-image{background:#eee;border:2px solid #fff}.fb-gallery-list-image-inner,.fb-gallery-list-image>div{height:100%;position:absolute;width:100%}.fb-gallery-list-image-inner{-o-object-fit:contain;left:0;object-fit:contain;top:0}.fb-gallery-list-image-remove{background:#fff;border:1px solid #222;line-height:24px;opacity:0;position:absolute;right:0;top:0;transition:.2s;visibility:hidden}.fb-gallery-list-image:hover .fb-gallery-list-image-remove{opacity:1;visibility:visible}.fb-gallery:before{bottom:0;content:"Drop To Upload";display:none;font-size:20px;left:0;margin:auto;position:absolute;right:0;text-align:center;top:0}.fb-gallery.active{background:#ccc;border:3px dashed var(--tertiary)}.fb-gallery.active:before{display:block}.sort-wrapper{background:#fff;border:1px solid #ccc;border-radius:4px;display:block;max-width:100%;min-height:60px;overflow:hidden}.sort-image{-o-object-fit:cover;height:40px;object-fit:cover;width:40px}.sort-box{align-items:center;background:#fff;border-bottom:1px solid #ccc;box-sizing:border-box;color:rgba(0,0,0,.87);display:flex;flex-direction:row;font-size:14px;justify-content:space-between;padding:20px 10px}.sort-box:last-child{border:none}.cdk-drag-preview{border-radius:4px;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12);box-sizing:border-box}.cdk-drag-placeholder{opacity:.3}.cdk-drag-animating,.cdk-drop-list-dragging .sort-box:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}']}]}],GalleryComponent.ctorParameters=function(){return[{type:void 0,decorators:[{type:core.Inject,args:[COMPONENT_DATA]}]},{type:String,decorators:[{type:core.Optional},{type:core.Inject,args:[STORAGE_URL]}]},{type:dialog.MatDialog},{type:core.ChangeDetectorRef},{type:http.HttpClient},{type:StorageService},{type:FormBuilderService},{type:overlay.ViewportRuler},{type:transloco.TranslocoService},{type:snackBar.MatSnackBar}]},GalleryComponent.propDecorators={listGroup:[{type:core.ViewChild,args:[dragDrop.CdkDropListGroup,{static:!0}]}],placeholder:[{type:core.ViewChild,args:[dragDrop.CdkDropList,{static:!0}]}],modalTemplate:[{type:core.ViewChild,args:["modal",{static:!0}]}],imagesSort:[{type:core.ViewChild,args:["imagesSort",{static:!0}]}],fileEl:[{type:core.ViewChild,args:["file",{static:!0}]}]};var ImageComponent=function(e){function t(t,n,a,o,r,i,s){var l=e.call(this,t)||this;return l.cData=t,l.storage=n,l.cdr=a,l.formBuilderService=o,l.transloco=r,l.snackBar=i,l.domSanitizer=s,l.disInput=!1,l}return __extends(t,e),t.prototype.ngOnInit=function(){this.imageUrl=new forms.FormControl(this.cData.control.value),this.formBuilderService.saveComponents.push(this),this.allowedImageTypes=this.cData.allowedImageTypes||[],this.forbiddenImageTypes=this.cData.forbiddenImageTypes||[],this.minSizeBytes=this.cData.minSize?parseSize(this.cData.minSize):0,this.maxSizeBytes=this.cData.maxSize?parseSize(this.cData.maxSize):0},t.prototype.errorSnack=function(e,t){void 0===e&&(e="GENERAL.ERROR"),void 0===t&&(t="GENERAL.DISMISS"),this.snackBar.open(this.transloco.translate(e),this.transloco.translate(t),{panelClass:"snack-bar-error",duration:5e3})},t.prototype.openFileUpload=function(){this.fileEl.nativeElement.click()},t.prototype.filesImage=function(e){var t=this,n=e.target,a=Array.from(n.files)[0];if(Object.defineProperty(a,"name",{writable:!0,value:formatFileName(a.name)}),!this.allowedImageTypes.includes(a.type)&&this.allowedImageTypes.length)return this.errorSnack("FIELDS.GALLERY.INVALID_IMAGE_FORMAT"),rxjs.throwError("Invalid Image Format");if(this.forbiddenImageTypes.includes(a.type))return this.errorSnack("FIELDS.GALLERY.FORBIDDEN_IMAGE_FORMAT"),rxjs.throwError("Forbidden Image Format");if(a.size<this.minSizeBytes)return this.errorSnack("FIELDS.GALLERY.BELOW_SIZE"),rxjs.throwError("Image below minimal allowed size");if(a.size>this.maxSizeBytes&&this.maxSizeBytes)return this.errorSnack("FIELDS.GALLERY.EXCEED_SIZE"),rxjs.throwError("Image exceeding allowed size");this.value=a,this.disInput=!0,this.imageUrl.setValue(this.value.name);var o=new FileReader;o.onload=function(){t.imageSrc=t.domSanitizer.bypassSecurityTrustResourceUrl(o.result),t.cdr.detectChanges()},o.readAsDataURL(this.value),n.value=""},t.prototype.remove=function(){this.imageUrl.setValue(""),this.value=null,this.disInput=!1,this.cdr.detectChanges()},t.prototype.save=function(e,t){var n=this;if(this.value){if(this.imageUrl.value&&this.imageUrl.value!==this.value.name)return rxjs.of(this.imageUrl.value).pipe(operators.tap((function(){return n.cData.control.setValue(n.imageUrl.value)})));var a=[e,t,this.value.name].join("-");return rxjs.from(this.storage.upload(a,this.value,{contentType:this.value.type,customMetadata:Object.assign({moduleId:e,documentId:t},this.cData.generatedImages&&formatGeneratedImages(this.cData.generatedImages))})).pipe(operators.switchMap((function(e){return e.ref.getDownloadURL()})),operators.tap((function(e){return n.cData.control.setValue(e)})))}return this.cData.control.setValue(this.imageUrl.value),rxjs.of({})},t}(FieldComponent);ImageComponent.decorators=[{type:core.Component,args:[{selector:"fb-image",template:'<mat-form-field appearance="outline" class="w-full">\n  <mat-label>{{(cData.label || \'\') | transloco}}</mat-label>\n  <input\n    matInput\n    type="url"\n    [placeholder]="(cData.placeholder || \'\') | transloco"\n    [class.disabled]="disInput"\n    [formControl]="imageUrl">\n  <div matSuffix class="fb-image-suffix">\n    <ng-container *ngIf="imageUrl.value">\n      <div class="fb-image-suffix-preview">\n        <button class="fb-image-suffix-preview-button" mat-icon-button>\n          <mat-icon>visibility</mat-icon>\n        </button>\n        <img class="fb-image-suffix-preview-image" [attr.src]="imageSrc || imageUrl.value || value" [alt]="\'FIELDS.IMAGE.PREVIEW\' | transloco">\n      </div>\n    </ng-container>\n    <button mat-icon-button *ngIf="!imageUrl.value && !cData.preventServerUpload">\n      <mat-icon (click)="openFileUpload()">perm_media</mat-icon>\n    </button>\n    <button mat-icon-button *ngIf="imageUrl.value">\n      <mat-icon (click)="remove()">highlight_off</mat-icon>\n    </button>\n  </div>\n  <mat-hint *ngIf="cData.hint" [innerHTML]="cData.hint | jpSanitize"></mat-hint>\n</mat-form-field>\n\n<input #file type="file" hidden (change)="filesImage($event)">\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[".fb-image-suffix{display:flex}.fb-image-suffix-preview{display:inline-block;position:relative}.fb-image-suffix-preview-image{-o-object-fit:contain;background:#fff;box-shadow:0 2px 5px 0 rgba(0,0,0,.4);height:200px;max-width:unset;object-fit:contain;opacity:0;position:absolute;right:0;top:100%;transition:.2s;visibility:hidden;width:200px;z-index:2}.fb-image-suffix-preview-button:hover+.fb-image-suffix-preview-image{opacity:1;visibility:visible}"]}]}],ImageComponent.ctorParameters=function(){return[{type:void 0,decorators:[{type:core.Inject,args:[COMPONENT_DATA]}]},{type:StorageService},{type:core.ChangeDetectorRef},{type:FormBuilderService},{type:transloco.TranslocoService},{type:snackBar.MatSnackBar},{type:platformBrowser.DomSanitizer}]},ImageComponent.propDecorators={fileEl:[{type:core.ViewChild,args:["file",{static:!0}]}]};var InputComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.ngOnInit=function(){this.prefix$=getHsd("prefix",this.cData),this.suffix$=getHsd("suffix",this.cData)},t}(FieldComponent);InputComponent.decorators=[{type:core.Component,args:[{selector:"fb-input",template:'\x3c!--TODO: Format this when fixed. For some reason if the type is passed through a variable angular doesn\'t properly parse--\x3e\n<ng-container [ngSwitch]="cData.type">\n  <mat-form-field *ngSwitchCase="\'number\'" class="w-full" appearance="outline" [class.mat-form-field-has-hint]="cData.hint">\n    <mat-label>{{(cData.label || \'\') | transloco}}</mat-label>\n    <span *ngIf="cData.prefix" matPrefix [innerHTML]="((prefix$ | async) || \'\') | jpSanitize"></span>\n    <input\n      matInput\n      type="number"\n      [attr.autocomplete]="cData.autocomplete || \'on\'"\n      [placeholder]="(cData.placeholder || \'\') | transloco"\n      [formControl]="cData.control">\n    <span *ngIf="cData.suffix" matSuffix [innerHTML]="((suffix$ | async) || \'\') | jpSanitize"></span>\n    <mat-hint *ngIf="cData.hint" [innerHTML]="cData.hint | jpSanitize"></mat-hint>\n  </mat-form-field>\n\n  <mat-form-field *ngSwitchDefault class="w-full" appearance="outline" [class.mat-form-field-has-hint]="cData.hint">\n    <mat-label>{{(cData.label || \'\') | transloco}}</mat-label>\n    <span *ngIf="cData.prefix" matPrefix [innerHTML]="((prefix$ | async) || \'\') | jpSanitize"></span>\n    <input\n        matInput\n        [attr.autocomplete]="cData.autocomplete || \'on\'"\n        [attr.type]="cData.type"\n        [placeholder]="(cData.placeholder || \'\') | transloco"\n        [formControl]="cData.control">\n    <span *ngIf="cData.suffix" matSuffix [innerHTML]="((suffix$ | async) || \'\') | jpSanitize"></span>\n    <mat-hint *ngIf="cData.hint" [innerHTML]="cData.hint | jpSanitize"></mat-hint>\n  </mat-form-field>\n</ng-container>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[""]}]}];var RadioComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(FieldComponent);RadioComponent.decorators=[{type:core.Component,args:[{selector:"fb-radio",template:'<div class="mat-form-field-wrapper">\n  <p class="fs-small fg-secondary" *ngIf="cData.label">{{(cData.label || \'\') | transloco}}</p>\n  <mat-radio-group [formControl]="cData.control">\n    <mat-radio-button\n      *ngFor="let option of cData.options"\n      [disabled]="option.disabled"\n      [value]="option.value">\n      {{option.name}}\n    </mat-radio-button>\n  </mat-radio-group>\n  <p class="fs-small fg-secondary" *ngIf="cData.hint">\n    {{(cData.hint | transloco) | transloco}}\n  </p>\n</div>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[""]}]}];var RangeComponent=function(e){function t(t,n,a){var o=e.call(this,t)||this;return o.cData=t,o.cdr=n,o.formBuilderService=a,o}return __extends(t,e),t.prototype.ngOnInit=function(){this.formBuilderService.saveComponents.push(this),this.min=new Date(this.cData.min||0),this.max=new Date(this.cData.max||2*Date.now()),this.entryControl=cloneAbstractControl(this.cData.control),this.start=new forms.FormControl({value:this.entryControl.value.start||"",disabled:this.cData.control.disabled},[forms.Validators.min(this.cData.min||0)]),this.end=new forms.FormControl({value:this.entryControl.value.end||"",disabled:this.cData.control.disabled},[forms.Validators.max(this.cData.max||2*Date.now())])},t.prototype.save=function(){var e=this;return rxjs.of({}).pipe(operators.tap((function(){var t=e.start.value,n=e.end.value;e.cData.control.setValue({start:t,end:n})})))},t}(FieldComponent);RangeComponent.decorators=[{type:core.Component,args:[{selector:"fb-range",template:'<div class="mat-form-field-wrapper">\n  <p class="fs-small fg-secondary" *ngIf="cData.label">{{(cData.label || \'\') | transloco}}</p>\n\n  <mat-form-field appearance="outline" class="w-full">\n    <mat-label>Enter a date range</mat-label>\n    <mat-date-range-input [rangePicker]="picker">\n      <input matStartDate placeholder="Start date" [formControl]="start" [min]="min">\n      <input matEndDate placeholder="End date" [formControl]="end" [max]="max">\n    </mat-date-range-input>\n    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>\n    <mat-date-range-picker #picker></mat-date-range-picker>\n  </mat-form-field>\n\n  <p class="fs-small fg-secondary" *ngIf="cData.hint">\n    {{(cData.hint | transloco) | transloco}}\n  </p>\n</div>\n',styles:[""]}]}],RangeComponent.ctorParameters=function(){return[{type:void 0,decorators:[{type:core.Inject,args:[COMPONENT_DATA]}]},{type:core.ChangeDetectorRef},{type:FormBuilderService}]};var ADDITIONAL_CONTEXT=new core.InjectionToken("ADDITIONAL_CONTEXT");function parseTemplate(e,t){if(void 0===e&&(e=""),void 0===t&&(t={}),e.includes("{{")){for(var n=new RegExp("{{(.*?)}}");n.test(e);)e=e.replace(n,RegExp.$1.split(".").reduce((function(e,t){return e[t]}),t));return e}return t[e]}var ROLE=new core.InjectionToken("ROLE"),SelectComponent=function(e){function t(t,n,a,o){var r=e.call(this,t)||this;return r.cData=t,r.dbService=n,r.role=a,r.additionalContext=o,r.loading$=new rxjs.BehaviorSubject(!0),r}return __extends(t,e),t.prototype.ngOnInit=function(){var e=this;if(this.cData.populate){var t=this.cData.populate,n=t.mapResults?safeEval(t.mapResults):null,a=function(a){return e.loading$.next(!0),a?a.filter&&"string"==typeof a.filter?e.dbService.getDocument(a.collection,a.filter).pipe(operators.map((function(e){return(n?n(e):[e]).map((function(e){return{value:e[t.valueKey||"id"],name:parseTemplate(t.nameKey||"name",e)}}))})),operators.tap((function(){return e.loading$.next(!1)}))):e.dbService.getDocumentsSimple(a.collection,a.orderBy,a.filter).pipe(operators.map((function(a){return n&&(a=n(a,{fieldData:e.cData,value:e.cData.form.getRawValue(),role:e.role,additionalContext:e.additionalContext})),a.map((function(e){return{value:e[t.valueKey||"id"],name:parseTemplate(t.nameKey||"name",e)}}))})),operators.tap((function(){return e.loading$.next(!1)}))):(e.loading$.next(!1),rxjs.of([]))};if(t.dependency){var o=this.cData.pointers[t.dependency.key],r=safeEval(t.dependency.method);this.dataSet$=o.control.valueChanges.pipe(operators.startWith(o.control.value),operators.switchMap((function(t){return a(r(t,{fieldData:e.cData,value:e.cData.form.getRawValue(),role:e.role,additionalContext:e.additionalContext}))})))}else{var i=t.filter;t.dynamicFilter&&(i=safeEval(t.dynamicFilter)({fieldData:this.cData,value:this.cData.form.getRawValue(),role:this.role,additionalContext:this.additionalContext})),this.dataSet$=a({collection:t.collection,orderBy:t.orderBy,filter:i})}}else this.dataSet$=rxjs.of(this.cData.dataSet)},t}(FieldComponent);SelectComponent.decorators=[{type:core.Component,args:[{selector:"fb-select",template:'<mat-form-field class="w-full" appearance="outline" [class.mat-form-field-has-hint]="cData.hint">\n  <mat-label>{{(cData.label || \'\') | transloco}}</mat-label>\n  <mat-select\n    [placeholder]="(cData.placeholder || \'\') | transloco"\n    [formControl]="cData.control"\n    [multiple]="cData.multiple"\n    [attr.autocomplite]="cData.autocomplete || \'off\'">\n    <mat-option *ngFor="let data of dataSet$ | async" [value]="data.value" [disabled]="data.disabled">\n      {{data.name}}\n    </mat-option>\n  </mat-select>\n  <mat-spinner\n    matSuffix\n    *ngIf="cData.populate && (loading$ | async)"\n    [diameter]="20"></mat-spinner>\n  <mat-hint *ngIf="cData.hint" [innerHTML]="cData.hint | jpSanitize"></mat-hint>\n</mat-form-field>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[""]}]}],SelectComponent.ctorParameters=function(){return[{type:void 0,decorators:[{type:core.Inject,args:[COMPONENT_DATA]}]},{type:DbService},{type:String,decorators:[{type:core.Inject,args:[ROLE]}]},{type:void 0,decorators:[{type:core.Optional},{type:core.Inject,args:[ADDITIONAL_CONTEXT]}]}]};var SliderComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.ngOnInit=function(){this.startAt=this.cData.starAt?this.cData.starAt:this.cData.validation.minimum?this.cData.validation.minimum:0,this.endAt=this.cData.endAt?this.cData.endAt:this.cData.validation.maximum?this.cData.validation.maximum:100},t}(FieldComponent);SliderComponent.decorators=[{type:core.Component,args:[{selector:"fb-slider",template:'<div class="mat-form-field-wrapper">\n  <p class="fs-small fg-secondary" *ngIf="cData.label">{{(cData.label || \'\') | transloco}}</p>\n  <mat-slider\n    [formControl]="cData.control"\n    [thumbLabel]="cData.thumbLabel"\n    [tickInterval]="cData.tickInterval"\n    [min]="startAt"\n    [max]="endAt">\n  </mat-slider>\n  <p class="fs-small fg-secondary" *ngIf="cData.hint">\n    {{(cData.hint || \'\') | transloco}}\n  </p>\n</div>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[""]}]}];var TextareaComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.ngOnInit=function(){this.prefix$=getHsd("prefix",this.cData),this.suffix$=getHsd("suffix",this.cData)},t}(FieldComponent);TextareaComponent.decorators=[{type:core.Component,args:[{selector:"fb-textarea",template:'<mat-form-field class="w-full" appearance="outline">\n  <mat-label>{{(cData.label || \'\') | transloco}}</mat-label>\n  <textarea\n    matInput\n    [placeholder]="(cData.placeholder || \'\') | transloco"\n    [attr.autocomplete]="cData.autocomplete || \'on\'"\n    [rows]="cData.rows"\n    [cols]="cData.cols"\n    [formControl]="cData.control">\n  </textarea>\n  <mat-hint *ngIf="cData.hint" [innerHTML]="cData.hint | jpSanitize"></mat-hint>\n  <span *ngIf="cData.suffix" matSuffix [innerHTML]="((suffix$ | async) || \'\') | jpSanitize"></span>\n  <span *ngIf="cData.prefix" matPrefix [innerHTML]="((prefix$ | async) || \'\') | jpSanitize"></span>\n</mat-form-field>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[""]}]}];var ToggleComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(FieldComponent);ToggleComponent.decorators=[{type:core.Component,args:[{selector:"fb-toggle",template:'<div class="mat-form-field-wrapper">\n  <p class="fs-small fg-secondary" *ngIf="cData.label">{{(cData.label || \'\') | transloco}}</p>\n  <mat-slide-toggle [formControl]="cData.control"></mat-slide-toggle>\n  <p class="fs-small fg-secondary" *ngIf="cData.hint">\n    {{(cData.hint || \'\') | transloco}}\n  </p>\n</div>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[""]}]}];var WysiwygComponent=function(e){function t(t,n,a,o,r){var i=e.call(this,t)||this;return i.cData=t,i.fb=n,i.dialog=a,i.storage=o,i.formBuilderComponent=r,i.ytDefault={fullWidth:!0,showPlayerControls:!0,privacyEnhancedMode:!1,align:"left"},i}return __extends(t,e),t.prototype.ngOnInit=function(){var e=this;this.ytForm=this.fb.group(Object.assign({value:["",forms.Validators.required]},this.ytDefault)),this.cData.control.statusChanges.subscribe((function(t){"DISABLED"===t?tinymce.activeEditor.getBody().setAttribute("readonly",!0):e.cData.control.disabled&&tinymce.activeEditor.getBody().setAttribute("readonly",!1)}))},t.prototype.ngAfterViewInit=function(){this.registerTiny()},t.prototype.registerTiny=function(){var e=this;tinymce.init({target:this.textarea.nativeElement,branding:!1,height:this.cData.height||420,plugins:["code","print","wordcount","link","lists","advlist","autolink","image","imagetools","fullscreen","table"],menubar:this.cData.menubar||"edit insert view format table tools help",image_advtab:!0,default_link_target:"_blank",readonly:this.cData.control.disabled,toolbar:this.cData.toolbar||["undo redo","insert","styleselect","bold italic","forecolor backcolor","alignleft aligncenter alignright alignjustify","bullist numlist outdent indent","link","image","youTube","fullscreen"].join(" | "),images_upload_handler:function(t,n,a){e.storage.upload(t.filename(),t.blob(),e.formBuilderComponent.id?{customMetadata:{collection:e.formBuilderComponent.id}}:{}).then((function(e){return e.ref.getDownloadURL()})).then((function(e){return n(e)})).catch((function(e){return a(e.toString())}))},setup:function(t){e.editor=t,t.on("keyup change",(function(){var n=t.getContent();e.cData.control.setValue(n)})),t.ui.registry.addButton("youTube",{type:"button",icon:"embed",tooltip:"Embed youtube video",onAction:function(){e.ytForm.reset(e.ytDefault),e.dialog.open(e.youTubeDialogTemplate,{width:"500px"}).afterClosed().pipe(operators.filter((function(e){return!!e})),operators.take(1)).subscribe((function(){var n=e.ytForm.getRawValue(),a=n.privacyEnhancedMode?"https://www.youtube-nocookie.com/embed/":"https://www.youtube.com/embed/";a+=n.value,n.showPlayerControls||(n.value+="?controls=0");var o='<iframe width="560" height="315" src="'+a+'" frameborder="0"\n                    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';t.insertContent(n.fullWidth?'<div class="evw-full" style="text-align: '+n.align+'">'+o+"</div>":'<div style="text-align: '+n.align+'">'+o+"</div>")}))}})}})},t}(FieldComponent),_a$1;WysiwygComponent.decorators=[{type:core.Component,args:[{selector:"fb-wysiwyg",template:'<div class="mat-form-field-wrapper">\n  <p class="fs-small fg-secondary" *ngIf="cData.label">{{(cData.label || \'\') | transloco}}</p>\n  <textarea #textarea role="textarea">{{cData.control.value}}</textarea>\n</div>\n\n<ng-template #youTubeDialog>\n  <h1 mat-dialog-title>{{\'FIELDS.WYSIWYG.EMBED_YOUTUBE\' | transloco}}</h1>\n\n  <form [formGroup]="ytForm">\n    <mat-dialog-content>\n      <mat-form-field class="w-full">\n        <mat-label>{{\'FIELDS.WYSIWYG.VIDEO_ID\' | transloco}}</mat-label>\n        <input matInput formControlName="value">\n      </mat-form-field>\n\n      <label class="mat-form-field-wrapper flex jc-between">\n        <span>{{\'FIELDS.WYSIWYG.FULL_WIDTH\' | transloco}}</span>\n        <mat-slide-toggle formControlName="fullWidth"></mat-slide-toggle>\n      </label>\n\n      <label class="mat-form-field-wrapper flex jc-between">\n        <span>{{\'FIELDS.WYSIWYG.SHOW_PLAYER_CONTROLS\' | transloco}}</span>\n        <mat-slide-toggle formControlName="showPlayerControls"></mat-slide-toggle>\n      </label>\n\n      <label class="mat-form-field-wrapper flex jc-between">\n        <span>{{\'FIELDS.WYSIWYG.PRIVACY_ENHANCED_MODE\' | transloco}}</span>\n        <mat-slide-toggle formControlName="privacyEnhancedMode"></mat-slide-toggle>\n      </label>\n\n      <mat-form-field class="w-full">\n        <mat-label>{{\'FIELDS.WYSIWYG.ALIGNMENT\' | transloco}}</mat-label>\n        <mat-select formControlName="align">\n          <mat-option value="left">{{\'FIELDS.WYSIWYG.LEFT\' | transloco}}</mat-option>\n          <mat-option value="center">{{\'FIELDS.WYSIWYG.CENTER\' | transloco}}</mat-option>\n          <mat-option value="right">{{\'FIELDS.WYSIWYG.RIGHT\' | transloco}}</mat-option>\n        </mat-select>\n      </mat-form-field>\n    </mat-dialog-content>\n\n    <mat-dialog-actions class="jc-end">\n      <button mat-button mat-dialog-close>{{\'GENERAL.CLOSE\' | transloco}}</button>\n      <button mat-raised-button color="primary" [mat-dialog-close]="true">{{\'GENERAL.SAVE\' | transloco}}</button>\n    </mat-dialog-actions>\n  </form>\n</ng-template>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[""]}]}],WysiwygComponent.ctorParameters=function(){return[{type:void 0,decorators:[{type:core.Inject,args:[COMPONENT_DATA]}]},{type:forms.FormBuilder},{type:dialog.MatDialog},{type:StorageService},{type:FormBuilderComponent}]},WysiwygComponent.propDecorators={textarea:[{type:core.ViewChild,args:["textarea",{static:!0}]}],youTubeDialogTemplate:[{type:core.ViewChild,args:["youTubeDialog",{static:!0}]}]};var COMPONENT_TYPE_COMPONENT_MAP=(_a$1={},_a$1[exports.ComponentType.Input]=InputComponent,_a$1[exports.ComponentType.Toggle]=ToggleComponent,_a$1[exports.ComponentType.Select]=SelectComponent,_a$1[exports.ComponentType.File]=FileComponent,_a$1[exports.ComponentType.Image]=ImageComponent,_a$1[exports.ComponentType.Gallery]=GalleryComponent,_a$1[exports.ComponentType.Checkbox]=CheckboxComponent,_a$1[exports.ComponentType.Autocomplete]=AutocompleteComponent,_a$1[exports.ComponentType.Date]=DateFieldComponent,_a$1[exports.ComponentType.Range]=RangeComponent,_a$1[exports.ComponentType.Slider]=SliderComponent,_a$1[exports.ComponentType.Wysiwyg]=WysiwygComponent,_a$1[exports.ComponentType.Draggable]=DraggableListComponent,_a$1[exports.ComponentType.Radio]=RadioComponent,_a$1[exports.ComponentType.Chips]=ChipsComponent,_a$1[exports.ComponentType.Textarea]=TextareaComponent,_a$1),SchemaType;SchemaType=exports.SchemaType||(exports.SchemaType={}),SchemaType.Object="object",SchemaType.Array="array",SchemaType.String="string",SchemaType.Number="number",SchemaType.Integer="integer",SchemaType.Boolean="boolean",SchemaType.Null="null";var SchemaValidators=function(){function e(){}return e.multipleOf=function(e){return function(t){return t.value%e==0?null:{multipleOf:e}}},e}();function schemaToComponent(e){switch(e){case exports.SchemaType.String:return{type:exports.ComponentType.Input,configuration:{type:"text"}};case exports.SchemaType.Number:case exports.SchemaType.Integer:return{type:exports.ComponentType.Input,configuration:{type:"number"}};case exports.SchemaType.Boolean:return{type:exports.ComponentType.Checkbox};case exports.SchemaType.Array:return{type:exports.ComponentType.Chips}}}var Parser=function(){function e(e,t,n,a,o,r){void 0===o&&(o={}),void 0===r&&(r={}),this.schema=e,this.injector=t,this.state=n,this.role=a,this.definitions=o,this.customFields=r,this.pointers={}}return e.standardizeKey=function(e){return"/"===e[0]&&(e=e.slice(1,e.length)),e},e.stringControl=function(e,t){var n=[],a={};return t&&(n.push(forms.Validators.required),a.required=!0),e.maxLength&&(n.push(forms.Validators.maxLength(e.maxLength)),a.maxLength=e.maxLength),e.minLength&&(n.push(forms.Validators.minLength(e.minLength)),a.minLength=e.minLength),e.pattern&&(n.push(forms.Validators.pattern(e.pattern)),a.patter=e.pattern),{control:new forms.FormControl(e.default||"",n),validation:a}},e.numberControl=function(e,t){var n={},a=[];if(t&&(a.push(forms.Validators.required),n.required=!0),e.minimum){var o=e.minimum+(e.exclusiveMinimum?1:0);a.push(forms.Validators.min(o)),n.minimum=o}if(e.maximum){var r=e.maximum-(e.exclusiveMaximum?1:0);a.push(forms.Validators.max(r)),n.maximum=r}return e.multipleOf&&(a.push(SchemaValidators.multipleOf(e.multipleOf)),n.multipleOf=e.multipleOf),{control:new forms.FormControl(e.default||null,a),validation:n}},e.booleanControl=function(e,t){var n=[],a={};return t&&(n.push(forms.Validators.required),a.required=!0),{control:new forms.FormControl(e.default||!1,n),validation:a}},e.prototype.buildForm=function(e,t,n,a){void 0===t&&(t=[]),void 0===n&&(n="/"),void 0===a&&(a=!0);var o=this.buildProperties(this.schema.properties||{},t,n,a);return this.form=o.form,this.pointers=o.pointers,e&&this.form.patchValue(e),this.form},e.prototype.buildProperties=function(t,n,a,o){var r=this;void 0===n&&(n=[]),void 0===a&&(a="/"),void 0===o&&(o=!0);var i=__spread(Object.entries(t),o?[["id",{type:"string"}]]:[]).reduce((function(t,o){var i,s=__read(o,2),l=s[0],c=s[1],p=n.includes(l);switch(c.type){case exports.SchemaType.String:i=e.stringControl(c,p);break;case exports.SchemaType.Number:case exports.SchemaType.Integer:i=e.numberControl(c,p);break;case exports.SchemaType.Boolean:i=e.booleanControl(c,p);break;case exports.SchemaType.Object:var m=r.buildProperties(c.properties||(c.items&&c.items.properties?c.items.properties:{}),c.required||c.items&&c.items.required?c.items.required:[],a+l+"/",!1);for(var u in m.pointers)m.pointers.hasOwnProperty(u)&&(t.pointers[u]=m.pointers[u]);i={control:m.form,validation:{}};break;case exports.SchemaType.Array:i=r.buildArray(a,c)}var d=a+l,f=r.getFromDefinitions(d)||{};return t.form[l]=i.control,t.pointers[d]=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({key:l,type:c.type},f.formatOnLoad&&{formatOnLoad:safeEval(f.formatOnLoad)}),f.formatOnSave&&{formatOnSave:safeEval(f.formatOnSave)}),f.formatOnCreate&&{formatOnCreate:safeEval(f.formatOnCreate)}),f.formatOnEdit&&{formatOnEdit:safeEval(f.formatOnEdit)}),i),t}),{form:{},pointers:{}}),s=i.form;return{pointers:i.pointers,form:new forms.FormGroup(s)}},e.prototype.field=function(e,t,n,a,o){if(void 0===n&&(n={}),void 0===a&&(a=!0),!t)throw console.log("Pointers: ",this.pointers),new Error("Couldn't find pointer for "+e+".");var r=t.key,i=t.type,s=t.control,l=t.validation,c=Object.assign({label:r},this.getFromDefinitions(e,n));(c.disableOn&&(Array.isArray(c.disableOn)?c.disableOn.includes(this.state):c.disableOn===this.state)||c.disableForRoles&&(Array.isArray(c.disableForRoles)?c.disableForRoles.includes(this.role):c.disableForRoles===this.role))&&s.disable(),a||(c.label=""),c.component||(c.component=schemaToComponent(i));var p=COMPONENT_TYPE_COMPONENT_MAP[c.component.type]||this.customFields[c.component.type];if(!p)throw new Error("Couldn't find a component defined for type: "+c.component.type);return{pointer:e,control:s,portal:new portal.ComponentPortal(p,null,createComponentInjector(this.injector,Object.assign(Object.assign({control:s,validation:l,single:a,pointers:this.pointers,form:this.form},c),c.component.configuration||{}))),validation:l,placeholder:c.placeholder||"",label:c.label,onlyOn:c.onlyOn}},e.prototype.addArrayItem=function(e,t,n){void 0===t&&(t=!1);var a=n?this.pointers[n.pointer].arrayPointers[n.index]:this.pointers,o=a[e],r=a[e].control;if(o.arrayType===exports.SchemaType.Array||o.arrayType===exports.SchemaType.Object){var i=this.buildProperties(o.properties,o.required,e+"/",!1);return t&&this.loadHooks(i.pointers),o.arrayPointers.unshift(i.pointers),r.controls.unshift(i.form),i.pointers}var s=new forms.FormControl("");return r.controls.unshift(s),s},e.prototype.moveArrayItem=function(e,t,n,a){var o=a?this.pointers[a.pointer].arrayPointers[a.index]:this.pointers,r=o[e],i=o[e].control;r.arrayType!==exports.SchemaType.Array&&r.arrayType!==exports.SchemaType.Object||dragDrop.moveItemInArray(r.arrayPointers,t,n),dragDrop.moveItemInArray(i.controls,t,n)},e.prototype.removeArrayItem=function(e,t,n){var a=n?this.pointers[n.pointer].arrayPointers[n.index]:this.pointers;a[e].arrayPointers.splice(t,1),a[e].control.removeAt(t)},e.prototype.loadHooks=function(e){void 0===e&&(e=this.pointers),Object.values(e).forEach((function(e){if(e.control instanceof forms.FormControl&&e.formatOnLoad){var t=e.formatOnLoad(e.control.value);t!==e.control.value&&e.control.setValue(t)}}))},e.prototype.preSaveHooks=function(e,t,n){var a=this;void 0===t&&(t=[exports.State.Create,exports.State.Edit]),void 0===n&&(n=this.pointers);var o=this.form.getRawValue();Object.values(n).forEach((function(n){if(n.control instanceof forms.FormControl){var r=n.control.value;n.formatOnSave&&(r=n.formatOnSave(r,o)),t.includes(e)&&(e===exports.State.Edit&&n.formatOnEdit?r=n.formatOnEdit(r,o):n.formatOnCreate&&(r=n.formatOnCreate(r,o))),r!==n.control.value&&n.control.setValue(r)}n.arrayPointers&&n.arrayPointers.forEach((function(n){return a.preSaveHooks(e,t,n)}))}))},e.prototype.getFromDefinitions=function(t,n){return void 0===n&&(n=this.definitions),n[e.standardizeKey(t)]},e.prototype.buildArray=function(e,t){return t.items?{arrayType:t.items.type,properties:t.items.properties,required:t.items.required,validation:{},control:new forms.FormArray([]),arrayPointers:[]}:Object.assign({control:new forms.FormControl([])},t.items?{arrayType:t.items.type,properties:t.items.properties,required:t.items.required,validation:{}}:{arrayType:exports.SchemaType.String,validation:{}})},e}(),FormBuilderComponent=function(){function e(e,t,n,a,o){this.injector=e,this.role=t,this.customFields=n,this.cdr=a,this.service=o,this.valueChanges=new core.EventEmitter,this.validityChanges=new core.EventEmitter,this.state=exports.State.Create}return e.prototype.ngOnChanges=function(e){e.data&&this.render(),e.value&&this.form&&this.form.patchValue(e.value.currentValue)},e.prototype.ngOnDestroy=function(){this.changeSubscription&&this.changeSubscription.unsubscribe(),this.statusSubscription&&this.statusSubscription.unsubscribe()},e.prototype.process=function(){return this.parser.preSaveHooks(this.state),this.form.getRawValue()},e.prototype.save=function(e,t){var n=this.service.saveComponents.map((function(n){return n.save(e,t)}));return n.length?rxjs.forkJoin(n):rxjs.of({})},e.prototype.saveAndProcess=function(e,t){return this.process(),this.save(e,t)},e.prototype.render=function(){var e=this,t=this.data.value||{},n=this.data.definitions||{};this.parser=new Parser(this.data.schema,this.injector,this.state,this.role,n,this.customFields),this.form=this.parser.buildForm(t,[],"/",!1),this.parser.loadHooks(),this.segments=filterAndCompileSegments(this.data.segments||[{title:"",fields:Object.keys(this.parser.pointers),columnsDesktop:12,type:exports.SegmentType.Empty}],this.parser,n,this.injector,t),this.changeSubscription&&this.changeSubscription.unsubscribe(),this.statusSubscription&&this.statusSubscription.unsubscribe(),this.changeSubscription=this.form.valueChanges.subscribe((function(t){e.valueChanges.emit(t)})),this.statusSubscription=this.form.statusChanges.subscribe((function(t){e.validityChanges.emit("VALID"===t)})),this.cdr.markForCheck()},e}();FormBuilderComponent.decorators=[{type:core.Component,args:[{selector:"fb-form-builder",template:'<div class="grid">\n  <ng-container *ngFor="let segment of segments">\n    <ng-template [cdkPortalOutlet]="segment.component"></ng-template>\n  </ng-container>\n</div>\n',changeDetection:core.ChangeDetectionStrategy.OnPush,providers:[FormBuilderService]}]}],FormBuilderComponent.ctorParameters=function(){return[{type:core.Injector},{type:String,decorators:[{type:core.Optional},{type:core.Inject,args:[ROLE]}]},{type:void 0,decorators:[{type:core.Optional},{type:core.Inject,args:[CUSTOM_FIELDS]}]},{type:core.ChangeDetectorRef},{type:FormBuilderService}]},FormBuilderComponent.propDecorators={data:[{type:core.Input}],value:[{type:core.Input}],id:[{type:core.Input}],valueChanges:[{type:core.Output}],validityChanges:[{type:core.Output}],state:[{type:core.Input}]};var DropzoneDirective=function(){function e(e,t){this.el=e,this.renderer=t,this.hoverClass="active",this.dropped=new core.EventEmitter,this.hovered=new core.EventEmitter}return e.prototype.onDrop=function(e){e.preventDefault(),this.dropped.emit(e.dataTransfer.files),this.renderer.removeClass(this.el.nativeElement,this.hoverClass),this.hovered.emit(!1)},e.prototype.onDragOver=function(e){e.preventDefault(),this.renderer.addClass(this.el.nativeElement,this.hoverClass),this.hovered.emit(!0)},e.prototype.onDragLeave=function(e){e.preventDefault(),this.renderer.removeClass(this.el.nativeElement,this.hoverClass),this.hovered.emit(!1)},e}();DropzoneDirective.decorators=[{type:core.Directive,args:[{selector:"[fbDropzone]"}]}],DropzoneDirective.ctorParameters=function(){return[{type:core.ElementRef},{type:core.Renderer2}]},DropzoneDirective.propDecorators={hoverClass:[{type:core.Input}],dropped:[{type:core.Output}],hovered:[{type:core.Output}],onDrop:[{type:core.HostListener,args:["drop",["$event"]]}],onDragOver:[{type:core.HostListener,args:["dragover",["$event"]]}],onDragLeave:[{type:core.HostListener,args:["dragleave",["$event"]]}]};var ShowFieldPipe=function(){function e(){}return e.prototype.transform=function(e,t){return e.filter((function(e){return!e.onlyOn||(Array.isArray(e.onlyOn)?e.onlyOn.includes(t.state):e.onlyOn===t.state)}))},e}();ShowFieldPipe.decorators=[{type:core.Pipe,args:[{name:"showField"}]}];var FormBuilderModule=function(){};FormBuilderModule.decorators=[{type:core.NgModule,args:[{declarations:[FieldComponent,AutocompleteComponent,CheckboxComponent,ChipsComponent,DateFieldComponent,RangeComponent,DraggableListComponent,FileComponent,GalleryComponent,ImageComponent,InputComponent,RadioComponent,SelectComponent,SliderComponent,TextareaComponent,ToggleComponent,WysiwygComponent,SegmentComponent,AccordionComponent,CardComponent,EmptyComponent,StepperComponent,TabsComponent,DropzoneDirective,ShowFieldPipe,FormBuilderComponent],imports:[common.CommonModule,forms.ReactiveFormsModule,formField.MatFormFieldModule,input.MatInputModule,button.MatButtonModule,autocomplete.MatAutocompleteModule,select.MatSelectModule,slider.MatSliderModule,slideToggle.MatSlideToggleModule,checkbox.MatCheckboxModule,chips.MatChipsModule,icon.MatIconModule,datepicker.MatDatepickerModule,core$1.MatNativeDateModule,dragDrop.DragDropModule,dialog.MatDialogModule,tooltip.MatTooltipModule,progressSpinner.MatProgressSpinnerModule,expansion.MatExpansionModule,divider.MatDividerModule,portal.PortalModule,card.MatCardModule,tabs.MatTabsModule,radio.MatRadioModule,ngHelpers.SanitizeModule,transloco.TranslocoModule],exports:[FormBuilderComponent]}]}],exports.ADDITIONAL_CONTEXT=ADDITIONAL_CONTEXT,exports.COMPONENT_DATA=COMPONENT_DATA,exports.CUSTOM_FIELDS=CUSTOM_FIELDS,exports.DbService=DbService,exports.FieldComponent=FieldComponent,exports.FormBuilderComponent=FormBuilderComponent,exports.FormBuilderModule=FormBuilderModule,exports.FormBuilderService=FormBuilderService,exports.Parser=Parser,exports.ROLE=ROLE,exports.STORAGE_URL=STORAGE_URL,exports.StorageService=StorageService,exports.cloneAbstractControl=cloneAbstractControl,exports.formatFileName=formatFileName,exports.formatGeneratedImages=formatGeneratedImages,exports.parseTemplate=parseTemplate,exports.safeEval=safeEval,exports.switchItemLocations=switchItemLocations,exports.a=AutocompleteComponent,exports.b=CheckboxComponent,exports.c=ChipsComponent,exports.d=DateFieldComponent,exports.e=RangeComponent,exports.f=DraggableListComponent,exports.g=FileComponent,exports.h=GalleryComponent,exports.i=ImageComponent,exports.j=InputComponent,exports.k=RadioComponent,exports.l=SelectComponent,exports.m=SliderComponent,exports.n=TextareaComponent,exports.o=ToggleComponent,exports.p=WysiwygComponent,exports.q=SegmentComponent,exports.r=SEGMENT_DATA,exports.s=AccordionComponent,exports.t=CardComponent,exports.u=EmptyComponent,exports.v=StepperComponent,exports.w=TabsComponent,exports.x=DropzoneDirective,exports.y=ShowFieldPipe,Object.defineProperty(exports,"__esModule",{value:!0})}));
//# sourceMappingURL=jaspero-form-builder.umd.min.js.map